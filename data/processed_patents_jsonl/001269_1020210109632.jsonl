{"patent_id": "10-2021-0109632", "section": "특허_기본정보", "subsection": "특허정보", "content": {"공개번호": "10-2023-0027630", "출원번호": "10-2021-0109632", "발명의 명칭": "AI 기반 의약품 비전 검수를 위한 데이터 확장 및 학습 방법과 이를 적용한 검수 시스템", "출원인": "한국전자통신연구원", "발명자": "김휘강"}}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_1", "content": "알약 각각의 영상데이터 및 의약품 검수 모델 학습용 영상데이터를 저장하고, 상기 알약 각각의 영상데이터를조합하여 상기 학습용 영상데이터를 생성하는 데이터관리부;상기 데이터관리부에서 상기 학습용 영상데이터를 추출하고, 초기 검수 모델을 학습시켜 검수 모델을 생성하는학습부;상기 검수 모델을 실행시켜 실제 조제 포장된 의약품 영상 내에서 각각의 알약을 검출하고 인식한 후, 오조제여부를 판단하는 검수부; 및처방이 접수되면 상기 데이터관리부, 상기 학습부 및 상기 검수부의 동작을 제어하는 제어부;를 포함하는 AI 기반 의약품 비전 검수 시스템."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_2", "content": "제1항에 있어서,상기 데이터관리부는검수 대상이 될 수 있는 각 알약의 영상데이터를 저장하는 의약품 영상 DB;상기 검수 모델 학습용 영상데이터를 저장하는 학습용 데이터 DB; 및상기 알약 각각의 영상데이터를 조합하여 상기 학습용 영상데이터를 생성하여 상기 학습용 데이터 DB에 전달하는 학습용 데이터 생성부;를 포함하는 것인AI 기반 의약품 비전 검수 시스템."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_3", "content": "제1항에 있어서,상기 데이터관리부는검수 대상이 될 수 있는 각 알약이 가질 수 있는 면 중 적어도 한 면의 영상데이터를 저장하는 것인AI 기반 의약품 비전 검수 시스템."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_4", "content": "제1항에 있어서,상기 데이터관리부는상기 처방에 포함되는 각 알약에 대한 영상데이터를 추출하고, 추출한 상기 영상데이터별로 임의의 각도로 회전하여 배경영상의 임의의 위치에 배치하는 방식으로 상기 영상데이터와 상기 배경영상을 조합하여 학습용 영상데이터를 생성하는 것인AI 기반 의약품 비전 검수 시스템."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_5", "content": "제1항에 있어서,상기 데이터관리부는학습용 영상데이터 생성 시 상기 처방에 포함되는 각 알약의 이름과 위치를 자동 레이블링하는 것인공개특허 10-2023-0027630-3-AI 기반 의약품 비전 검수 시스템."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_6", "content": "제1항에 있어서,상기 데이터관리부는설정파일이나 사용자 정책 중 적어도 하나에 따라 처방별 학습용 영상데이터의 생성 개수를 제한하는 것인AI 기반 의약품 비전 검수 시스템."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_7", "content": "제1항에 있어서,상기 학습부는 상기 검수 모델을 해당하는 처방에 매칭시켜 함께 내부저장소에 저장하는 것인AI 기반 의약품 비전 검수 시스템."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_8", "content": "제1항에 있어서,상기 제어부는 특정한 처방에 대하여 상기 학습부에 동일한 처방에 대해 이미 검수 모델이 존재하는 경우, 학습용 영상데이터생성이나 초기 검수 모델의 학습 과정을 거치지 않고, 상기 검수부로 하여금 상기 검수 모델의 실행을 통해 상기 특정한 처방에 따라 조제 포장된 의약품 영상 내에서 각각의 알약을 검출하고 인식함으로써 오조제 여부를판단하도록 하는 것인AI 기반 의약품 비전 검수 시스템."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_9", "content": "제1항에 있어서,상기 검수부는 상기 인식된 알약의 품목별로 개수를 산출하여 상기 처방과 일치하는지 여부를 확인함으로써 오조제 여부를 판단하는 것인AI 기반 의약품 비전 검수 시스템."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_10", "content": "제1항에 있어서,상기 검수부는 상기 의약품 영상 내에서 각각의 알약에 대한 검출 및 인식 중 적어도 하나가 불가능하여 오조제 여부를 판단할수 없는 경우 육안 검수가 필요하다는 내용을 출력하는 것인AI 기반 의약품 비전 검수 시스템."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_11", "content": "처방에 포함되는 각 알약에 대한 영상데이터를 의약품 영상 DB로부터 추출하는 단계;상기 각 알약에 대한 영상데이터를 조합하여 학습용 영상데이터를 생성하는 단계; 및상기 생성한 학습용 영상데이터를 학습용 데이터 DB에 저장하는 단계;를 포함하는 AI 기반 의약품 비전 검수를 위한 데이터 확장 방법.공개특허 10-2023-0027630-4-청구항 12 제11항에 있어서,상기 각 알약에 대한 영상데이터는상기 처방에 포함되는 각 알약이 가질 수 있는 면 중 적어도 한 면을 촬영한 영상데이터인 것인 AI 기반 의약품 비전 검수를 위한 데이터 확장 방법."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_13", "content": "제11항에 있어서,상기 각 알약에 대한 영상데이터의 조합은상기 각 알약에 대한 영상데이터를 임의의 각도로 회전하여 배경영상의 임의의 위치에 배치하는 방식으로 조합하는 것인AI 기반 의약품 비전 검수를 위한 데이터 확장 방법."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_14", "content": "제11항에 있어서,상기 학습용 영상데이터 생성 단계 이후에학습용 영상데이터에 포함된 각 알약의 이름과 위치를 상기 학습용 영상데이터에 자동으로 레이블링하는 단계;를 더 포함하는 AI 기반 의약품 비전 검수를 위한 데이터 확장 방법."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_15", "content": "처방에 포함되는 각 알약의 일면의 영상데이터가 하나의 배경영상에 조합된 형태로서, 각 알약의 이름과 위치가레이블링되어 있는 학습용 영상데이터를 학습용 데이터 DB로부터 추출하는 단계;상기 추출한 학습용 영상데이터로 초기 검수 모델을 학습시켜 검수 모델을 생성하는 단계; 및상기 검수 모델을 저장하는 단계;를 포함하는 AI 기반 의약품 비전 검수를 위한 학습 방법."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_16", "content": "제15항에 있어서,상기 검수 모델을 저장하는 단계는상기 검수 모델을 해당하는 처방에 매칭시켜 함께 저장하는 것인AI 기반 의약품 비전 검수를 위한 학습 방법."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_17", "content": "처방에 대한 검수 모델이 존재하는지 판단하는 단계;상기 처방에 대한 검수 모델이 존재하는 경우, 상기 검수 모델을 실행하여 실제 조제 포장된 의약품 영상 내에서 각각의 알약을 검출하고 인식하는 단계;상기 인식 결과를 바탕으로 의약품 품목별 개수를 산출하는 단계; 및상기 산출된 의약품 품목별 개수와 처방을 비교하여 오조제 여부를 판단하는 단계;를 포함하는 AI 기반 의약품 비전 검수 방법."}
{"patent_id": "10-2021-0109632", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_18", "content": "공개특허 10-2023-0027630-5-제17항에 있어서,상기 판단 결과 처방에 대한 검수 모델이 존재하지 않는 경우, 상기 처방에 포함되는 각 알약에 대한 영상데이터를 의약품 영상 DB로부터 추출하는 단계;상기 각 알약에 대한 영상데이터를 조합하여 학습용 영상데이터를 생성하는 단계; 및상기 생성한 학습용 영상데이터로 초기 검수 모델을 학습시켜 검수 모델을 생성하는 단계; 를 더 포함하는 AI 기반 의약품 비전 검수 방법."}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "요약", "paragraph": 1, "content": "본 발명은 AI 기반 의약품 비전 검수를 위한 데이터 확장 및 학습 방법과 이를 적용한 검수 시스템에 관한 것이다. 본 발명에 따른 AI 기반 의약품 비전 검수 시스템은 알약 각각의 영상데이터 및 의약품 검수 모델 학습용 영 상데이터를 저장하고, 상기 알약 각각의 영상데이터를 조합하여 상기 학습용 영상데이터를 생성하는 데이터관리 부; 상기 데이터관리부에서 상기 학습용 영상데이터를 추출하고, 초기 검수 모델을 학습시켜 검수 모델을 생성하 는 학습부; 상기 검수 모델을 실행시켜 실제 조제 포장된 의약품 영상 내에서 각각의 알약을 검출하고 인식한 후, 오조제 여부를 판단하는 검수부; 및 처방이 접수되면 상기 데이터관리부, 상기 학습부 및 상기 검수부의 동 작을 제어하는 제어부;를 포함한다."}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "기술분야", "paragraph": 1, "content": "본 발명은 AI 기반 의약품 비전 검수를 위한 데이터 확장 및 학습 방법과 이를 적용한 검수 시스템에 관한 것으 로, 더욱 상세하게는 AI 기반의 의약품 비전 검수를 위하여 단일 알약 영상을 조합하여 학습용 영상 데이터를 확장하는 방법, 학습용 영상 데이터를 확보하는 과정에서 자동으로 알약의 정보를 레이블링하는 방법 및 이러한 학습용 영상 데이터를 이용하여 학습을 통해 검수 모델을 생성하는 방법, 그리고 상기 검수 모델을 적용하여 조 제 포장된 의약품과 처방의 일치 여부를 판단하는 검수 시스템에 관한 것이다."}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "배경기술", "paragraph": 1, "content": "정제(tablet) 등 고형 의약품의 조제와 관련된 기업, 약국 및 병원 등에서는 조제 업무 자동화를 위한 전자동 정제 분배 및 포장 시스템을 사용하고 있다. 관련 의료진들은 이를 이용하여 처방에 따라 약품을 자동으로 분류 하고 포장한 뒤 환자에게 전달하게 된다. 이 때, 만일의 경우 발생할 수 있는 오조제를 방지하기 위해 환자에게 전달하기 전 관련 의료진들에 의한 약품 검수가 반드시 수행되어야 한다. 다만, 환자가 많거나 조제에 사용되는 취급 약품이 많은 대형병원 또는 약품의 장기 복용이 필요한 만성질환자를 대상으로 한 조제의 경우, 의료진들 에 의한 전량 직접 검수가 불가능한 상황이며 이에 따른 시간 및 인력의 낭비 역시 크다는 문제점이 있다. 약품 오조제로 인한 의료 사고는 환자의 생명과 직결될 수 있는 문제로 상당히 민감한 사안이다. 그러나 관련 기업, 약국 및 병원 등에선 수동으로 진행되는 직접 검수에 있어서 현재까지 많은 어려움을 겪고 있는 실정이다. 이와 관련하여 최근 포장이 완료된 약품에 대한 검수 장치 및 방법에 대한 연구 개발이 진행되고 있다. 또한, 포장 영상을 촬영한 뒤, 이를 바탕으로 한 비전 기반의 자동 검수 시스템이 현재 상용화되어 조제 자동화 시스 템과 함께 판매되고 있다. 그러나 기존 영상처리 기술들만을 활용하여 포장 내 알약들을 검출하고 인식하는데는 분명한 한계가 있다. 기존 영상처리 기술들을 활용하는 경우, 알약의 영역을 분할하고 영상 내 알약들로부터 특 징을 추출한 뒤 이를 매칭하여 인식하는 방법(규칙 기반 (Rule-based))으로 알약을 검출 및 인식해야 한다. 그 런데, 알약의 경우 비슷한 크기, 모양, 색상을 지닌 경우가 대부분이며 실제 특징 추출이 어려운 알약들(투명 연질 캡슐 등) 또한 존재할 수 있어 이를 분류하고 검출하는데 어려움이 있다. 또한 본 기술이 적용될 환경을 고려했을 때, 포장 내에는 여러 정의 알약이 다양한 형태로 위치할 수 있어 기존의 영상처리 기술만을 사용하여 영상 내 알약의 특징들을 추출하고 매칭하는데 어려움이 있다. 최근 많은 양의 데이터로부터 직접 특징을 추출하고 이를 학습해 영상 내 객체들을 검출 및 인식하는 인공지능 기술 기반의 딥러닝 모델들이 주목받고 있다. 이러한 딥러닝 기반 기술을 통하여 위 언급한 기존의 영상 처리 기술을 활용한 약품 검수 방법의 한계를 극복할 수 있을 것으로 판단된다. 다만, 현재 딥러닝 기반 기술의 사용을 위해서는 학습을 위한 아주 많은 양의 데이터의 획득(영상 촬영)과 획득 한 데이터 내의 알약들에 대한 정보(이름 및 위치 등)들의 라벨을 붙여주는 레이블링 작업이 필요한데, 이와 관 련하여 딥러닝 기반 기술의 현장 적용 시 다음과 같은 문제점이 예상된다. 조제 관련 기업, 약국 및 병원에서 취급하는 수많은 종의 알약들을 실제 조제 환경처럼 처방된 알약들의 조합으 로 모두 표현할 수 없을 뿐 아니라, 학습 데이터 획득만을 위하여 수많은 알약들을 포장하는 것 또한 불가능하 다. 설령 포장이 가능하다 해도 포장 내 각각의 알약들을 임의의 다양한 형태로 위치하게 하여 촬영하는 것 역 시 불가능하다. 또한, 수많은 영상에 대하여 각 영상 내 객체(알약)들의 정보를 수작업으로 레이블링 하는 것은"}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "배경기술", "paragraph": 2, "content": "시간과 작업 부하를 과도하게 요구한다는 문제점이 있다.발명의 내용"}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "해결하려는과제", "paragraph": 1, "content": "본 발명은 약품 조제 자동화 시스템을 통해 포장된 약품의 비전 검수에 딥러닝 기반의 영상 내 객체 검출 및 인 식 기술을 적용하는데 있어서, 많은 양의 데이터를 획득해야 하는 문제(촬영 및 레이블링 등) 및 실제 조제 환 경 적용을 위해 고려해야 할 문제(조합 및 포장, 포장 내 약품 위치 등)들로 인한 기술 적용의 어려움을 극복하 기 위하여 새로운 데이터 확보(확장) 및 학습 방법과 이를 적용한 검수 시스템을 제공하는데 목적이 있다. 본 발명은 실제 조제 환경 적용을 위한, i) 단일 알약 영상의 조합으로 학습 영상 및 레이블링 된 데이터를 확 보하는 방법, ii) 처방이 주어진 후 처방에 따라 i) 방법을 사용하여 학습 데이터 생성 및 이를 이용한 학습과 검수 방법을 제안하고자 한다. 본 발명에서 제공하고자 하는 데이터 확보(확장) 및 학습 방법은 한 영상 내 여러 알의 알약이 다양한 형태로 함께 존재할 때 이를 대상으로 알약 검출 및 인식을 수행하기 위한 것이다. 우선 상기 방법을 적용할 약품 비전 검수 장비 내 촬영 환경(배경, 조명 등)은 항상 동일하므로 도 1a와 같이 처방에 포함된 알약이 6개일 때, 포장 후는 도 1b와 같이 약품 6알이 다양한 형태로 위치하게 된다. 도 1a는 포장 전의 약품 영상의 예이며, 도 1b는 포장 후의 약품 영상의 예인데, 투명 포장인 경우를 가정하여 포장을 제외한 것이다. 이 때 조제 자동화 시스템 적용을 위한 실제 조제 환경 및 상황을 고려해보면, 도 1a와 같이 포장 전 한 알의 알약을 각각 촬영하고 데이터베이스화 하여 이를 대상으로 학습을 진행한 뒤, 도 1b와 같이 한 영상에 여러 개 의 알약이 다양한 형태로 위치한 포장 후 영상을 대상으로 영상 내 알약의 위치를 검출하고 약의 종류를 인식하 는 방식으로 검수를 수행하여야 한다. 일반적으로 딥러닝 기술을 활용하여 객체 검출 및 인식을 하기 위해서는 대량의 학습 데이터(영상)가 필요하며, 학습에는 최종 판별할 영상(도 1b)과 가장 유사한 형태의 영상이 많이 사용될수록 검수 모델의 성능이 좋아지게 된다. 그러나 실제 조제 환경에서는 도 1a와 같이 하나의 알약 정도를 확보하여 촬영할 수 있을 뿐 여러 개의 알약을 한 번에 임의의 다양한 형태로 위치시켜 촬영하는 것은 불가능하 다. 또한 이 때 각 알약에 대한 위치 및 이름 정보를 직접 레이블링하는 것 역시 불가능하다. 딥러닝 분야에서 이런 경우, 학습 데이터를 충분히 확보하기 위하여 다양한 방법으로 데이터를 확장(Data Augmentation)하여 학습에 사용하는데, 영상 데이터에 대한 확장 방법으로는 대표적으로 영상의 환경(해상도, 조명 등) 변경 또는 객체(색상, 크기, 회전, 위치 등) 변화 등을 들 수 있다. 조제 자동화 시스템을 사용한 포 장 약품 영상의 경우 영상의 촬영 환경이 고정되어 있으므로 데이터 확장 시 알약의 회전 및 위치 변화만 고려 하여 데이터를 확장하고 학습하면 된다. 따라서 도 2a, 도 2b와 같이 배경이 동일한 영상 내 알약의 위치(도 2a) 및 각도(도 2b)를 임의로 바꿔가며 영 상을 다양하게 원하는 만큼 확장할 수 있다. 이 때 변화의 범위는 알약 위치의 경우 배경 영상 내 임의의 픽셀 위치(알약이 배경을 벗어나는 모서리 영역 제외), 각도는 0~360°(도) 사이로 볼 수 있으며 두 조건의 조합에 따라 대량의 데이터를 만들어 낼 수 있다. 또한 이와 더불어 알약의 픽셀 위치를 알 수 있으므로 대량의 영상데 이터에 포함된 각각의 알약에 대해 그 이름과 위치에 대한 자동 레이블링(labeling)도 가능하다. 다만 도 2a, 도 2b를 참조한 설명과 같은 방법에 따라 단일 알약만을 대상으로 영상을 확장하여 학습한 모델을 검수에 적용한 경우 오인식의 소지가 있다. 도 3a, 도 3b는 실제 알약의 포장 영상 내 여러 알의 알약이 동시에 다양한 형태로 존재하는 경우, 알약 검출 및 인식 결과를 나타낸 것이다. 도 3a와 같이 알약이 서로 거리를 두 고 떨어져 있으면 각 알약을 제대로 검출하고 인식하지만, 도 3b와 같이 알약들이 서로 가깝게 위치하거나 접한 경우, 각각의 알약을 인식하지 못하고 하나의 알약으로 오인식하는 것을 볼 수 있다. 이는 위 설명한 것과 같이 실제 시험에 사용되는 영상과 유사한 형태의 영상이 학습에도 많이 사용되어야 하지 만 단일 알약만을 대상으로 영상을 확장하여 학습하는 경우 영상 내 알약들이 접하면서 생기는 다양한 형태들을 제대로 학습하지 못해 발생하는 현상으로 판단되며, 이를 위한 새로운 학습 데이터 확장 및 학습 방법이 필요하 다. 물론 검수 포장 내 알약이 하나만 존재하는 경우 본 방법으로도 충분한 성능을 보일 수 있지만, 대부분 실생활 중 처방에 따라 약국에서 받는 포장 및 포장 검수가 필요한 상황의 경우 한 포장 내 여러 알의 알약이 동시에 들어가 있는 형태일 것이므로, 하나의 알약만을 대상으로 한 데이터 확장 및 학습 방법에는 한계가 있으며, 본방법을 포함한 새로운 알약 데이터 확장 및 학습 방법이 필요하다."}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 1, "content": "상기 목적을 달성하기 위한 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수 시스템은 알약 각각의 영상 데이터 및 의약품 검수 모델 학습용 영상데이터를 저장하고, 상기 알약 각각의 영상데이터를 조합하여 상기 학 습용 영상데이터를 생성하는 데이터관리부; 상기 데이터관리부에서 상기 학습용 영상데이터를 추출하고, 초기 검수 모델을 학습시켜 검수 모델을 생성하는 학습부; 상기 검수 모델을 실행시켜 실제 조제 포장된 의약품 영상 내에서 각각의 알약을 검출하고 인식한 후, 오조제 여부를 판단하는 검수부; 및 처방이 접수되면 상기 데이터관 리부, 상기 학습부 및 상기 검수부의 동작을 제어하는 제어부;를 포함한다. 상기 데이터관리부는 검수 대상이 될 수 있는 각 알약의 영상데이터를 저장하는 의약품 영상 DB; 상기 검수 모 델 학습용 영상데이터를 저장하는 학습용 데이터 DB; 및 상기 알약 각각의 영상데이터를 조합하여 상기 학습용 영상데이터를 생성하여 상기 학습용 데이터 DB에 전달하는 학습용 데이터 생성부;를 포함할 수 있다. 상기 데이터관리부는 검수 대상이 될 수 있는 각 알약이 가질 수 있는 면 중 적어도 한 면의 영상데이터를 저장 할 수 있다. 상기 데이터관리부는 상기 처방에 포함되는 각 알약에 대한 영상데이터를 추출하고, 추출한 상기 영상데이터별 로 임의의 각도로 회전하여 배경영상의 임의의 위치에 배치하는 방식으로 상기 영상데이터와 상기 배경영상을 조합하여 학습용 영상데이터를 생성할 수 있다. 상기 데이터관리부는 학습용 영상데이터 생성 시 상기 처방에 포함되는 각 알약의 이름과 위치를 자동 레이블링 할 수 있다. 상기 데이터관리부는 설정파일이나 사용자 정책 중 적어도 하나에 따라 처방별 학습용 영상데이터의 생성 개수 를 제한할 수 있다. 상기 학습부는 상기 검수 모델을 해당하는 처방에 매칭시켜 함께 내부저장소에 저장할 수 있다. 상기 제어부는 특정한 처방에 대하여 상기 학습부에 동일한 처방에 대해 이미 검수 모델이 존재하는 경우, 학습 용 영상데이터 생성이나 초기 검수 모델의 학습 과정을 거치지 않고, 상기 검수부로 하여금 상기 검수 모델의 실행을 통해 상기 특정한 처방에 따라 조제 포장된 의약품 영상 내에서 각각의 알약을 검출하고 인식함으로써 오조제 여부를 판단하도록 할 수 있다. 상기 검수부는 상기 인식된 알약의 품목별로 개수를 산출하여 상기 처방과 일치하는지 여부를 확인함으로써 오 조제 여부를 판단할 수 있다. 상기 검수부는 상기 의약품 영상 내에서 각각의 알약에 대한 검출 및 인식 중 적어도 하나가 불가능하여 오조제 여부를 판단할 수 없는 경우 육안 검수가 필요하다는 내용을 출력할 수 있다. 또한, 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수를 위한 데이터 확장 방법은 처방에 포함되는 각 알약에 대한 영상데이터를 의약품 영상 DB로부터 추출하는 단계; 상기 각 알약에 대한 영상데이터를 조합하여 학습용 영상데이터를 생성하는 단계; 및 상기 생성한 학습용 영상데이터를 학습용 데이터 DB에 저장하는 단계; 를 포함한다. 상기 각 알약에 대한 영상데이터는 상기 처방에 포함되는 각 알약이 가질 수 있는 면 중 적어도 한 면을 촬영한 영상데이터일 수 있다. 상기 각 알약에 대한 영상데이터의 조합은 상기 각 알약에 대한 영상데이터를 임의의 각도로 회전하여 배경영상 의 임의의 위치에 배치하는 방식으로 조합한 것일 수 있다. 이 때, 본 발명은 상기 학습용 영상데이터 생성 단계 이후에 학습용 영상데이터에 포함된 각 알약의 이름과 위 치를 상기 학습용 영상데이터에 자동으로 레이블링하는 단계;를 더 포함할 수 있다. 또한, 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수를 위한 학습 방법은 처방에 포함되는 각 알약의 일면의 영상데이터가 하나의 배경영상에 조합된 형태로서, 각 알약의 이름과 위치가 레이블링되어 있는 학습용 영상데이터를 학습용 데이터 DB로부터 추출하는 단계; 상기 추출한 학습용 영상데이터로 초기 검수 모델을 학습 시켜 검수 모델을 생성하는 단계; 및 상기 검수 모델을 저장하는 단계;를 포함한다.상기 검수 모델을 저장하는 단계는 상기 검수 모델을 해당하는 처방에 매칭시켜 함께 저장하는 것일 수 있다. 또한, 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수 방법은 처방에 대한 검수 모델이 존재하는지 판단 하는 단계; 상기 처방에 대한 검수 모델이 존재하는 경우, 상기 검수 모델을 실행하여 실제 조제 포장된 의약품 영상 내에서 각각의 알약을 검출하고 인식하는 단계; 상기 인식 결과를 바탕으로 의약품 품목별 개수를 산출하 는 단계; 및 상기 산출된 의약품 품목별 개수와 처방을 비교하여 오조제 여부를 판단하는 단계를 포함한다. 이 때, 본 발명은 상기 판단 결과 처방에 대한 검수 모델이 존재하지 않는 경우, 상기 처방에 포함되는 각 알약 에 대한 영상데이터를 의약품 영상 DB로부터 추출하는 단계; 상기 각 알약에 대한 영상데이터를 조합하여 학습 용 영상데이터를 생성하는 단계; 및 상기 생성한 학습용 영상데이터로 초기 검수 모델을 학습시켜 검수 모델을 생성하는 단계; 를 더 포함할 수 있다."}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "발명의효과", "paragraph": 1, "content": "본 발명의 일 실시예에 따르면, 처방에 포함된 알약의 영상만을 조합하여 학습에 이용함으로써, 약국이 보유하 고 있는 모든 알약에 대한 영상을 조합하여 학습에 이용하는 경우에 비해 모델 학습 시간을 단축하면서도 목표 로 하는 검출 및 인식 성능을 확보할 수 있다. 또한 본 발명의 일 실시예에 따르면, 특정 처방에 대해 학습된 모델을 동일한 처방에 대해 재사용할 수 있어서 검수에 필요한 시간을 단축할 수 있다. 또한 본 발명의 일 실시예에 따르면 학습데이터 확장 시 배경 영상에 알약 영상을 합성할 때 특정 픽셀의 위치 를 알약의 위치로 사용하므로 알약의 이름과 함께 알약의 위치에 대한 자동 레이블링이 가능하여, 학습데이터를 준비하는 시간과 작업 부하를 줄일 수 있다. 또한 본 발명의 일 실시예에 따르면, 처방에 포함된 알약의 영상을 면(面), 각도, 위치를 달리하여 조합한 영상 을 학습에 이용한다. 이 방법을 통해 조제 환경의 특수성이 반영된 변수에 집중하여 다양한 경우의 수를 반영하 여 데이터를 확장할 수 있으므로, 딥러닝에 충분한 양의 학습데이터를 확보할 수 있다. 그리고 상기 조합 영상 을 학습에 이용한 결과, 영상 내 알약들 간의 다양한 위치 관계 및 알약의 형태(예를 들어, 전면/후면/측면)가 반영된, 실제 시험 영상과 유사한 형태의 학습데이터를 구성하여 모델을 학습할 수 있으므로, 단일 알약의 영상 만을 사용하여 학습한 경우에 비해 검출 및 인식 성능이 뛰어나며, 특히 시험 영상에서 알약들이 서로 접해 있 을 때 우수한 검출 및 인식 성능을 나타낸다."}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 1, "content": "본 발명의 이점 및 특징, 그리고 그것들을 달성하는 방법은 첨부되는 도면과 함께 상세하게 후술되어 있는 실시 예들을 참조하면 명확해질 것이다. 그러나 본 발명은 이하에서 개시되는 실시예들에 한정되는 것이 아니라 서로 다른 다양한 형태로 구현될 것이며, 단지 본 실시예들은 본 발명의 개시가 완전하도록 하며, 본 발명이 속하는"}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 2, "content": "기술분야에서 통상의 지식을 가진 자에게 발명의 범주를 완전하게 알려주기 위해 제공되는 것이며, 본 발명은 청구항의 범주에 의해 정의될 뿐이다. 한편, 본 명세서에서 사용된 용어는 실시예들을 설명하기 위한 것이며 본 발명을 제한하고자 하는 것은 아니다. 본 명세서에서, 단수형은 문구에서 특별히 언급하지 않는 한 복수형도 포 함한다. 명세서에서 사용되는 \"포함한다(comprises)\" 및/또는 \"포함하는(comprising)\"은 언급된 구성소자, 단계, 동작 및/또는 소자는 하나 이상의 다른 구성소자, 단계, 동작 및/또는 소자의 존재 또는 추가를 배제하지 않는다. 본 발명을 설명함에 있어서, 관련된 공지 기술에 대한 구체적인 설명이 본 발명의 요지를 불필요하게 흐릴 수 있다고 판단되는 경우 그 상세한 설명을 생략한다. 이하, 본 발명의 실시예를 첨부한 도면들을 참조하여 상세히 설명한다. 본 발명을 설명함에 있어 전체적인 이해 를 용이하게 하기 위하여 도면 번호에 상관없이 동일한 수단에 대해서는 동일한 참조 번호를 사용하기로 한다. 본 발명에서 제공하는 데이터 확장 및 학습 방법은 한 영상 내 여러 알의 알약이 다양한 형태로 함께 존재할 때 이를 대상으로 알약 검출 및 인식을 수행하기 위한 것이다. 도 4a와 도 4b는 본 발명의 데이터 확장 방법과 관련하여 준비하여야 할 영상의 예시이다. 도 4a는 준비 영상 중에서 6종의 약품에서 각 단일 약품에 대한 영상의 예이고, 도 4b는 준비 영상 중에서 배경 영상의 예이다. 도 4a와 같이 검수 대상에 해당하는 알약 각각에 대하여 앞/뒤(정제류 약품 두 면의 형상이 다르거나 인쇄 (imprint)가 다른 경우, 캡슐류 약품 내 인쇄의 유/무 면 등 경우), 측면(정제류 원형, 정방형 등 약품이 측면 으로 서 있을 수 있는 경우 등) 등 알약이 검수 영상 내 존재할 수 있는 형태의 모든 면을 한 장씩 촬영하고, 알약들이 위치하게 될 배경 영상(도 4b)을 촬영하여 준비한다. 도 5는 상기 단일 약품에 대한 영상과 배경 영상의 합성을 통해 학습 영상을 확장하는 예이다. 알약 2종의 앞 면 영상을 이용한 영상 확장의 예가 나타나 있다. 도 5와 같이 각 알약에 대하여 임의 면에 해당하는 영상을 선택하여 임의의 각도로 회전한 뒤 배경 영상 내 임 의의 픽셀 위치에 합성하여 원하는 장 수만큼의 영상을 만들어 학습 영상을 확장 생성하면 된다. 도 4의 예시와 같이 6종의 알약을 대상으로 처방에 각 알약을 1알씩을 포함하는 경우, 영상 확장을 위한 모든 경우는 아래 [수학식 1]과 같이 표현할 수 있다. 수학식 1"}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 3, "content": "[수학식 1]에서 A 내지 F는 6종의 알약에 대해 각 알약이 가질 수 있는 면의 집합을 의미한다. 각 알약에 대한 면을 a 내지 f로 표시하였다. 각 면의 아래 첨자로 표시된 f는 앞, b는 뒤, s는 옆을 의미한다. 6종의 알약이 가질 수 있는 면(본 예시에서는 앞/뒤/측면)의 영상의 집합을 A에서 F로 표현했을 때, 각 알약에 대한 면의 영상의 집합에서 하나씩을 선택하는 조합의 곱으로 경우의 수를 표현하고, 여기에 각도의 변화를 1° 로 설정했을 때 각도에 관한 경우의 수인 360을 곱하고, 영상의 픽셀 개수(가로 X 세로)를 곱하여 모든 경우를 표현할 수 있다. 단지 이렇게만 가정해도 대량의 영상 데이터를 생성할 수 있다. 또한, 본 방법의 경우 데이터 확장 시 배경 영상에 알약을 합성하기 위해 픽셀의 위치를 알약의 위치로 사용하므로 알약의 이름과 함께 무수 히 많이 생성한 영상 내 알약에 대한 자동 레이블링이 가능하다. 최종적으로 이런 방법으로 확장하여 만든 영상 들을 학습에 사용했을 때 최종 약품 검수에 있어 앞서 설명한 단일 알약의 영상을 이용하여 학습한 경우보다 현 저히 좋은 성능을 기대할 수 있다. 도 6은 도 4에 도시된 6종의 알약의 앞면 영상만을 이용하여 영상을 확장한 예이다. 알약 간 인접한 경우도 있 으며, 일정한 거리를 두고 떨어져 있는 경우도 있어서 알약 간 다양한 위치 관계를 학습용 데이터에 포함시킬 수 있다. 도 7a와 도 7b는 단일 알약의 영상을 확장한 영상으로 학습한 경우의 시험 결과와 복수 개의 알약 영상의 조합 을 통해 확장한 영상으로 학습한 경우의 시험 결과를 비교한 것이다. 도 7a은 단일 알약의 영상만을 확장한 영상 데이터로 모델이 학습한 후의 시험 결과이며, 도 7b는 복수 개 알약 영상의 조합을 이용하여 영상 데이터를 확장하여 모델이 이를 학습한 후의 시험 결과인데, 도 7b와 같이 본 발 명에서 제안한 방법을 사용하였을 때 시험 영상에서 알약들이 서로 접해 있을 때 더 좋은 검출 및 인식 성능을 보이는 것을 확인할 수 있다. 위와 같이 딥러닝 기반 조제 포장 검수 시 학습용 데이터 생성을 위한 자동 데이터 확장 및 레이블링 방법을 제안했다면, 다음으로 이를 실제 조제 환경에 적용하기 위한 새로운 학습 방법이 필요하다. 검수 대상이 될 수 있는 모든 약품의 영상에서 복수 개의 영상을 추출한 뒤 이를 조합하여 학습용 영상 데이터를 확장하여 초기 검 수 모델을 학습시키는 방법은 대량의 데이터를 생성하여 학습에 이용할 수는 있으나, 실제 조제 환경에 적합한 방법이라 보기 어렵다. 예를 들어 한 약국에서 취급하는 약품이 총 100종이라고만 가정했을 때, 처방에 따라 포 장 내 포함할 수 있는 약품 수는 한 알부터 많게는 10알 이상일 수 있는데(nCk = 100Ck, k = 1 ~ 100), 처방에 포 함되는 약품이 서로 다른 품목의 총 5개의 알약이라고 가정하더라도 그 경우의 수는 위 [수학식 1]과 같이 각 알약의 면을 선택하는 수식에 100개 중 다섯 개를 선택하는 100C5에 대한 조제 패턴의 경우를 더 곱해주어야 하며, 실제 조제 패턴에는 일부 약품이 중복으로 포함될 수도 있어 환자에 따라 매번 다른 처방에 대비하여 모 든 약품 정보를 고려하여 학습용 데이터를 생성하고 검수 모델을 만들어 두는 것은 효율성이 낮아 현실적인 방 법이라고 하기 어렵다. 또한 약국에서 취급하는 알약이 시기에 따라 추가되거나 변경되는 경우가 있어, 이에 따 라 학습을 매번 새로 수행하는 것 또한 매우 번거로운 문제가 있다. 상기 문제들을 고려했을 때, 각 약국에서 취급하는 알약이 매우 다양하며, 처방에 따라 포장되는 알약 조합의 경우의 수도 너무 많은 환경에서, 모든 상 황을 고려하여 학습용 영상 데이터를 확장하고 검수 모델을 만드는 것은 바람직하지 않다. 일반적으로 딥러닝 기반의 영상 내 객체 검출 및 인식에 있어 많은 양의 데이터를 복잡한 네트워크를 통하여 긴 시간 학습하는 것은 다양한 객체(사람, 동물, 자동차 등)를 대상으로 다양한 환경에서 이를 인식하기 위함이 다. 그런데, 조제 자동화 시스템을 사용한 포장 약품 영상의 경우 촬영 환경이 항상 동일하고 영상 내 검출되는 객체의 대부분이 알약이라는 특수성이 있다. 따라서 이러한 특수성을 고려하여, 검수 대상이 되는 모든 알약에 대한 모든 조합의 경우의 수에 따른 학습용 데이터를 준비하고 이를 이용하여 초기 검수 모델을 학습시키기 보 다는, 처방을 전달받은 직후, 처방에 따라 초기 검수 모델을 학습시키는 것이 유리할 것으로 판단된다. 즉, 처 방에 나타난 조제 패턴을 반영한 학습용 영상 데이터를 생성한 후 이를 이용하여 초기 검수 모델을 학습시켜 검 수 모델을 생성하고, 이 검수 모델을 검수에 사용하는 것이다. 이 방법은 모든 알약에 대한 영상 데이터를 조합 하여 모델을 학습시키는 경우에 비해 학습용 데이터의 양을 줄여 학습용 영상데이터(학습용 데이터)의 생성 시 간과 초기 검수 모델의 학습 시간을 단축시킴과 동시에 조제 검수에 최적화되고 간소화된 검수 모델을 만들 수 있다. 한편, 다른 이물질이나 오조제로 인하여 처방하지 않은 알약이 약품 포장에 추가되어, 검수 결과 학습한 알약 중 하나로 인식되더라도, 상기 간소화된 모델로도 충분히 검수가 가능하다. 검수 시 오조제 판단의 첫번째 조건은 처방과 비교한 알약 개수의 일치 여부이기 때문이다. 예를 들어 위 도 4 및 [수학식 1]에 나와 있는 A 내지 F의 알약 중 A, B, D, E에 대해 처방이 주어졌다고 가정 하자. 처방으로 A가 2개, B가 1개, D가 1개, E가 3개(총 7개의 알약)가 주어졌을 때, 각 알약이 가질 수 있는면은 A가 3가지, B가 3가지, D가 1가지, E가 2가지이므로, 알약 영상을 선택할 수 있는 경우의 수는 [수학식 2]와 같다. 약국에서 취급하는 전 종의 알약 중 임의의 4종의 알약에 대해 7개의 영상을 선택할 경우, 선택할 수 있는 경우의 수의 계산, 데이터 확장 및 학습에 있어서 복잡하고 어려운 상황이 발생하는데, 본 발명에서 제 안한 방법을 따를 경우 이와 같은 상황을 고려하지 않아도 된다는 장점이 있다. 수학식 2"}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 4, "content": "본 발명은 [수학식 2]와 같이 처방에 포함된 약품 범위 내에서 각 알약의 면을 조합할 수 있는 모든 경우의 수 를 반영하여 데이터를 확장하고 모델을 학습할 수 있다. 또한, 본 발명이 적용되는 상황은 앞서 설명한 것과 같 이 영상 내 환경 변화가 없고 정해진 객체의 형태 및 이동만 있는 상황이므로, 설정 파일이나 사용자 정책에 따 라 학습이 가능한 최소 장수를 설정하여 학습용 영상데이터를 확장하고 모델을 학습할 수도 있다. 본 발명에서 제안한 데이터 확장 방법으로 학습이 가능한 최소 장수만을 확장하고, 최적화된 간소화 네트워크(예를 들면 신 경망)를 사용해 최단 시간 학습하는 방법으로 검수 모델을 만들면, 단일한 처방에 대해 최적화된 검수가 가능하 다. 더불어 이 경우 처방에 따라 데이터 확장과 모델 학습이 진행되므로, 약국 내에서 취급하는 약 종이 추가되 거나 제외되는 상황에도 영향을 받지 않을 수 있게 된다. 오조제는 약품 누락, 초과, 변경, 이물질 등의 경우가 있다. 오조제 여부 판단을 위한 약품 검수는 한 포장을 대상으로 인식된 약 종 및 각 종의 개수가 처방과 일치하는지 여부를 기준으로 진행된다. 본 발명에서 제안한 방법에 따를 때, 오조제 중에서 약품 누락이나 초과의 경우는 각 종의 개수가 처방과 불일치할 것이므로 오조제 로 판단할 수 있다. 또한, 오조제 중에서 변경이나 이물질이 포함되는 경우, 학습하지 못한 객체를 학습한 알약 과 유사한 것으로 검출/인식하더라도 최종적으로는 약종(품목)별 개수가 처방과 다르므로 이를 오조제로 판단할 수 있다. 결국 변경이나 이물질 포함의 경우도 본 발명의 최종 검수 성능에 영향을 미치지 않는다. 본 발명이 적용될 수 있는 경우에 대해 살펴본다. 병원 진료 후 며칠 분의 약만 처방받아 근처 약국에서 바로 약을 받아가는 상황에서는 경우에 따라 처방 후 약을 포장하고 받기 전까지 처방에 대한 데이터를 생성하여 학 습하는 시간이 부족할 수 있다. 소량의 조제 포장에서는 약사의 직접 육안 검수가 우선된다. 본 발명에서 제안한 방법은 위와 달리 조제 자동화 시스템 적용에 적합한 방법으로, 환자가 많은 대형 병원, 노인요양시설 또는 약의 장기 복용이 필요한 만성 질환자를 대상으로 한 번의 진료에 약품 복용 기간이 길어 많 은 양의 조제 및 검수가 필요한 경우 활용 가치가 높은 방법이다. 왜냐하면 처방 및 포장 후 약품이 환자에게 전달되기까지의 시간 간격이 소량 포장의 경우보다 길어서 충분한 학습시간을 확보할 수 있을 뿐만 아니라, 각 환자에 대한 처방이 거의 일정하므로 각 처방에 대하여 한 번 학습한 모델을 환자와 매칭해 두면 다음 처방 시 약이 바뀌지 않으면 다시 모델을 학습하지 않아도 된다는 장점이 있기 때문이다. 다만 본 발명은 약사나 관련 의료진의 조제 후 약품 검수를 지원하기 위한 것으로 검수 후 결과에 대하여 비전 기반의 판단이 불가능한 경우 (알약이 완전히 포개져 영상 내 확인이 불가능한 경우 등) 최종적인 직접 육안 검 수가 동반되어야 한다."}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 5, "content": "이하, 본 발명이 속하는 기술분야에서 통상의 지식을 가진 자가 본 발명의 기술적 사상을 용이하게 실시할 수 있도록 본 발명의 실시 예를 도면을 참조하여 설명할 것이다. 도 8은 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수 시스템(비전 검수 시스템으로 약칭, 10)의 구성 을 나타낸 블록도이다. 도 8에 도시된 바와 같이, 본 발명의 일 실시예에 따른 비전 검수 시스템은 데이터 관리부, 학습부, 검수부 및 제어부를 포함한다. 데이터관리부는 검수 대상이 될 수 있는 알약 각각의 영상데이터 및 조제 포장된 의약품의 검수에 사용되 는 모델(검수 모델)의 학습용 영상데이터(학습용 데이터)를 저장하고, 알약 각각의 영상데이터를 조합하여 학습 용 영상데이터를 생성한다. 알약 각각의 영상데이터란 검수 대상이 될 수 있는 각 알약이 가질 수 있는 면 중 적어도 한 면의 영상데이터를 말한다. 예를 들어 알약이 구 형상을 가진다면 그 알약이 가질 수 있는 면은 1개 의 면이 되며, 그 1개의 면에 대한 영상데이터를 저장한다. 다른 예를 들어 알약이 정제이고 앞면과 뒷면의 음 각이나 인쇄가 다르며, 측면으로도 서 있을 수 있는 경우 해당 알약이 가질 수 있는 면은 앞면/뒷면/측면의 3개 의 면이 되며, 그 3개의 면에 대한 영상데이터를 저장한다. 학습부는 데이터관리부에서 학습용 영상데이터를 추출하여 초기 검수 모델을 학습시킨 후 검수 모델 을 생성하여 저장한다. 이 때 학습부는 검수 모델을 해당하는 처방(약종별 개수)에 매칭시켜 함께 내부저 장소에 저장한다. 또한 학습부는 내부저장소에 해당 처방을 받은 환자의 ID나 이름을 함께 저장할 수 있다. 검수 모델을 저장한 이후에 동일한 처방이 접수되는 경우, 기존 검수 모델을 재사용하기 위함이다. 기존 검수 모델을 다시 사용하는 경우 학습용 데이터 생성 시간과 초기 검수 모델의 학습 시간이 필요하지 않게 되므 로 다른 새로운 처방에 대한 학습용 데이터 생성 및 학습 시간을 추가로 확보하거나 검수에 신속히 착수할 수 있다. 검수부는 검수 모델을 실행시켜 실제 조제 포장된 의약품 영상 내에서 각각의 알약을 검출하고 인식한 후, 오조제 여부를 판단한다. 검수부는 인식된 알약의 품목별로 개수를 산출하여 처방과 일치하는지 여부 를 확인함으로써 오조제 여부를 판단한다. 선택적으로, 검수부는 의약품 영상 내에서 각각의 알약에 대한 검출이 되지 않거나 검출이 되더라도 인식이 되지 않아 오조제 여부를 판단할 수 없는 경우 육안 검수가 필요하 다는 내용을 화면이나 소리를 이용하여 출력함으로써 최종적인 직접 육안 검수가 이루어지도록 할 수 있다. 제어부는 처방이 접수되면 데이터관리부가 처방에 포함된 알약의 범위에서 학습용 데이터를 생성하 도록 하고, 학습부가 생성된 학습용 데이터를 이용하여 초기 검수 모델을 학습시키도록 하며, 검수부(30 0)가 검수 모델을 실행시켜 오조제 여부를 판단하도록 한다. 제어부는 접수된 특정한 처방에 대해 과거에 이와 동일한 처방이 존재하여 학습부에 그 처방에 대해 이미 검수 모델이 존재하는 경우, 학습데이터 생성 이나 초기 검수 모델의 학습 과정을 거치지 않고, 검수부로 하여금 검수 모델의 실행을 통해 상기 특정한 처방에 따라 조제 포장된 의약품 영상 내에서 각각의 알약을 검출하고 인식함으로써 오조제 여부를 판단하도록 한다. 제어부는 특정 환자의 처방에 대해 검수 모델이 존재하는지 판단할 수도 있다. 이 경우 해당 환자에 대한 처방이 동일하면 검수 모델을 상기와 같이 재사용할 수 있다. 도 9는 본 발명의 일 실시예에 따른 비전 검수 시스템의 데이터관리부의 구성을 나타낸 블록도이다. 본 발명의 일 실시예에 따른 비전 검수 시스템의 데이터관리부는 의약품 영상 DB, 학습용 데이터 DB 및 학습용 데이터 생성부를 포함한다. 의약품 영상 DB는 검수 대상이 될 수 있는 알약 각각의 영상데이터와 영상 조합에 사용될 배경영상을 저 장한다. 또한, 의약품 영상 DB는 알약의 이름, 식별 코드 등 알약에 관한 기본 정보를 저장한다. 알약 각 각의 영상데이터란 검수 대상이 될 수 있는 각 알약이 가질 수 있는 면 중 적어도 한 면의 영상데이터를 말한다. 예를 들어, 의약품 영상 DB는 검수 대상에 해당하는 알약 각각에 대하여 앞/뒤(정제류 약품 두 면 의 형상이 다르거나 인쇄(imprint)가 다른 경우, 캡슐류 약품 내 인쇄의 유/무 면 등 경우), 측면(정제류 원형, 정방형 등 약품이 측면으로 서 있을 수 있는 경우 등) 등 알약이 검수 영상 내 존재할 수 있는 형태의 모든 면 에 대한 영상을 저장할 수 있다. 한편 의약품 영상 DB가 저장하는 알약의 식별 코드는 의약품 표준코드 (Korea Drug Code)나 의약품 표준코드의 일부(예를 들면 제약사 코드 4자리와 포장을 제외한 품목코드 4자리의 조합)일 수 있다. 학습용 데이터 DB는 초기 검수 모델의 학습에 이용되는 영상데이터를 저장한다. 본 발명에서 이용되는 학 습용 영상데이터는 배경 영상에 처방에 포함된 각 알약의 일면의 영상이 조합된 형태이다. 학습용 데이터 DB는 학습용 영상데이터에 레이블링된 각 알약에 관한 데이터(위치, 이름, 식별코드)를 해당하는 학습용 영상데이터와 매칭하여 함께 저장한다. 학습용 데이터 생성부는 알약 각각의 영상데이터를 조합하여 학습용 영상데이터를 생성하여 학습용 데이 터 DB에 전달한다. 학습용 데이터 생성부는 처방에 포함되는 각 알약에 대한 임의의 면에 대한 영상 데이터와 배경영상을 의약품 영상 DB로부터 추출하고, 각 알약에 대한 임의의 면에 대한 영상데이터별로 임의의 각도로 회전하여 배경영상의 임의의 위치에 합성하여 배치하는 방식으로 영상데이터와 배경영상을 조합 하여 학습용 영상데이터를 확장 생성한다. 학습용 영상데이터의 장 수는 원하는 만큼 생성할 수 있으며, 후술하 는 설정파일이나 사용자 정책으로 설정할 수 있다. 검수 시스템의 처리 속도, 학습에 사용할 수 있는 시간, 조 제 환경, 검수 모델의 목표 성능 또는 처방에 포함된 약종별 개수에 따라 학습용 영상데이터의 생성 개수를 증 가시킬 수 있고, 최대 개수를 생성하여 이를 이용하여 초기 검수 모델을 학습할 수도 있을 것이다. 처방되는 약 종(품목)이 정해졌다고 할 때, 합성할 수 있는 학습용 데이터의 최대 개수는 각 알약이 가질 수 있는 면 중 하 나를 선택하는 조합(한 품목의 알약이 복수 개인 경우 중복 조합)의 곱([수학식 1]의 예시를 참조)에 각 단일 알약 영상의 회전 각도의 경우의 수(예를 들어 1도씩 변화시킨다면 360가지) 및 각 단일 알약 영상의 위치의 경 우의 수를 곱한 것이다. 이 때 각 단일 알약 영상의 위치의 경우의 수는 배경 영상의 픽셀 개수(가로와 세로의곱)에서 각 알약의 영상데이터를 회전하여 배경영상에 배치할 때 모서리 근처에 배치되어 알약의 영상이 배경을 벗어나는 경우를 제외한 것이 된다. 이 때 학습용 데이터 생성부는 학습용 영상데이터에 알약의 이름과 배 치된 위치(즉, 알약의 위치)를 자동으로 레이블링하여 학습용 데이터 DB에 함께 전달하여, 학습용 데이터 DB가 학습용 영상데이터에 알약의 이름과 알약의 위치를 매칭하여 저장하도록 할 수 있다. 다른 실시예로 서, 알약의 식별 코드를 학습용 영상데이터에 레이블링하여 함께 학습용 데이터 DB에 전달하거나, 알약의 식별 코드를 알약의 이름 대신 전달할 수 있다. 이 경우 학습용 데이터 DB는 학습용 영상데이터에 알약의 위치와 알약의 이름 또는 알약의 식별코드를 매칭하여 저장한다. 한편, 본 발명의 검수 시스템의 사용자는 설정 파일이나 사용자 정책을 통해 처방별 학습용 영상데이터의 생성 개수를 제한 설정할 수 있는데, 이 경우 학습용 데이터 생성부는 설정된 생성 개수까지만 학습용 영상데이터를 생성하여 학습용 데이터 DB에 전달한 다. 학습용 데이터 DB는 생성된 학습용 영상데이터를 저장한다. 처방별 학습용 영상데이터의 생성 개수는 앞서 언급한 대로 학습에 사용할 수 있는 시간, 검수 모델의 목표 성능, 처방 등에 따라 달라질 수 있다. 도 10은 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수의 전체 과정을 나타낸 흐름도이다. S10 단계는 처방이 있을 경우, 처방에 대한 검수 모델이 존재하는지 판단하는 단계이다. 동일한 처방에 대해 기존 검수 모델이 있을 경우, 이를 재사용함으로써 데이터 확장과 학습 과정을 생략하여 검수에 필요한 시간을 단축하기 위함이다. 또는 해당 환자의 과거 실적이 있을 경우, S10 단계에서 해당 환자의 처방에 대해 검수 모 델이 존재하는지 판단할 수 있다. 각 처방에 대하여 한 번 학습한 모델을 환자와 매칭해 둔 경우 다음 처방 시 해당 환자에 대해 처방이 동일하면 검수 모델을 재사용할 수 있기 때문이다. S100 단계는 처방에 대한 처방에 대한 검수 모델이 존재하지 않는 경우, 단일 알약에 대한 영상 데이터를 조합 하여 학습용 데이터를 확장 생성하는 단계이다. 이 단계는 처방에 포함되는 각 알약에 대한 영상데이터를 의약 품 영상 DB로부터 추출하는 단계, 각 알약에 대한 영상데이터를 조합하여 학습용 영상데이터를 생성하는 단계를 포함한다. 상세한 내용은 후술한다. S200 단계는 생성한 학습용 영상데이터로 초기 검수 모델을 학습시키는 단계이다. 학습 이후, 검수 모델을 해당 하는 처방(약 종별 개수)에 매칭시켜 함께 내부저장소에 저장한다. 검수 모델을 저장한 이후 동일한 처방이 접 수되는 경우, 기존 검수 모델을 재사용하기 위함이다. 이 때 내부저장소에 해당 처방을 받은 환자의 ID나 이름 을 함께 저장할 수 있다. 이 경우 동일한 환자에 대해 동일한 처방이 접수되는 경우, 기존 검수 모델을 재사용 할 수 있게 된다. 상세한 내용은 후술한다. S300 단계는 처방에 대한 기존 검수 모델이 존재하거나, S200 단계를 통해 검수 모델이 준비된 경우 진행되는 단계로서, 검수 모델을 실행시켜 실제 조제 포장된 의약품 영상 내에서 각각의 알약을 검출하고 인식한 후, 오 조제 여부를 판단하는 단계이다. 상세한 내용은 후술한다. 도 11은 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수를 위한 데이터 확장 방법(S100)을 설명하기 위 한 흐름도이다. S110 단계는 변수 i를 1로 초기화하는 단계이다. i는 학습용 영상데이터의 생성 개수를 점검하기 위한 변수이 다. 검수 시스템의 사용자는 설정 파일이나 사용자 정책을 통해 처방별 학습용 영상데이터의 생성 개수를 제한 설정할 수 있는데, 학습용 영상데이터를 생성할 때 마다 i를 1만큼 증가시키며, i가 설정된 학습용 영상데이터 의 생성 개수(N)에 도달하게 되면 학습용 영상데이터의 생성을 종료한다(S160 단계에 관한 설명 참조). 처방별 학습용 영상데이터의 생성 개수는 앞서 언급한 대로 학습에 사용할 수 있는 시간, 검수 모델의 목표 성능, 처방 등에 따라 달라질 수 있다. S120 단계는 처방에 포함되는 각 알약에 대한 임의의 면이 촬영된 영상데이터와 배경영상을 의약품 영상 DB로부터 추출하는 단계이다. 의약품 영상 DB는 검수 대상에 해당하는 알약 각각에 대하여 앞/뒤(정 제류 약품 두 면의 형상이 다르거나 인쇄(imprint)가 다른 경우, 캡슐류 약품 내 인쇄의 유/무 면 등 경우), 측 면(정제류 원형, 정방형 등 약품이 측면으로 서 있을 수 있는 경우 등) 등 알약이 검수 영상 내 존재할 수 있는 형태의 모든 면에 대한 영상을 저장할 수 있다. 학습용 데이터 생성부는 처방에 포함된 알약이 검수 영상 내 존재할 수 있는 형태의 모든 면에 대한 영상 중 임의의 면에 대한 영상데이터를 의약품 영상 DB로부터 추출할 수 있다. 예를 들어, A라는 약품이 정제로서 전면에는 영문이 음각으로 새겨져 있고, 후면에는 직선이 음각으로 새겨진 형태이고, 의약품 영상 DB에 A 약품의 앞면, 뒷면, 측면에 대한 영상데이터가 저장되어 있다고 하자. 이 때, 처방에 포함된 A 약품이 2개일 경우, 학습용 데이터 생성부가 A에 관해 의약품 영상 DB로부터 추출하는 영상은, A의 임의의 면에 대한 영상데이터를 추출한 결과 A의 앞면과 측면 영상이 될수 있다. S130 단계는 각 알약에 대한 영상데이터를 조합하여 학습용 영상데이터를 생성하는 단계이다. 본 발명에서 이 용되는 학습용 영상데이터는 배경 영상에 처방에 포함된 각 알약의 임의의 일면의 영상이 조합된 형태이다. 학 습용 데이터 생성부는 추출한 영상데이터별로 임의의 각도로 회전하여 배경영상의 임의의 위치에 배치하는 방식으로 영상데이터와 배경영상을 조합하여 학습용 영상데이터를 생성한다. 각 알약의 영상데이터를 회전하여 배경영상에 배치할 때 알약이 배경을 벗어나는 모서리 영역은 제외된다. S140 단계는 학습용 영상데이터에 포함된 각 알약의 이름과 위치를 상기 학습용 영상데이터에 자동으로 레이블 링하는 단계이다. 학습용 데이터 생성부는 학습용 영상데이터에 알약의 이름과 알약이 배경영상에 배치된 위치(즉, 알약의 위치)를 자동으로 레이블링할 수도 있고, 알약의 식별 코드를 학습용 영상데이터에 함께 레이 블링할 수도 있다. 또한 알약의 식별 코드를 알약의 이름 대신 학습용 영상데이터에 레이블링할 수도 있다. S150 단계는 상기와 같이 자동으로 레이블링되어 있는 학습용 영상데이터를 학습용 데이터 DB가 저장하는 단계이다. S160 단계는 i가 N과 일치하는지 판단한다. i가 설정된 학습용 영상데이터의 생성 개수(N)에 도달하였는지를 판단하는 단계이다. 만약 i가 증가한 결과 N에 도달한 경우라면 학습용 데이터의 생성을 종료하고 S210 단계를 진행한다. S170 단계는 i가 설정된 학습용 영상데이터 생성 개수(N)에 미달한 경우에 i를 1만큼 증가시키는 단계이다. 도 12는 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수를 위한 학습 방법(S200)을 설명하기 위한 흐름 도이다. S210 단계는 학습용 영상데이터를 학습용 데이터 DB로부터 추출하는 단계이다. 앞서 설명한대로, 학습용 영상데이터는 처방에 포함되는 각 알약의 일면의 영상데이터가 하나의 배경영상에 조합된 형태이다. 추출하는 학습용 영상데이터의 양은 전술한 학습용 영상데이터 생성 개수(N)일 수 있다. 또한 다른 예시로서, 처방에 따 라 생성할 수 있는 학습용 영상데이터의 최대값을 N으로 한 경우, S210 단계에서는 랜덤 샘플링(random sampling)으로 일부 학습용 영상데이터를 추출하는 방식으로 수행될 수 있다. S220 단계는 추출한 학습용 영상데이터로 초기 검수 모델을 학습시켜 검수 모델을 생성하는 단계이다. 추출한 학습용 영상데이터에는 알약의 이름(또는 알약의 식별 코드)과 위치가 레이블링되어 있어서, 이 영상데이터를 이용하여 초기 검수 모델을 학습시켜 검수 모델을 생성한다. 학습 대상이 되는 모델은 신경망일 수 있다. S230 단계는 검수 모델을 저장하는 단계이다. 학습부는 검수 모델을 해당하는 처방(약종별 개수)에 매칭시 켜 처방과 함께 내부저장소에 저장한다. 또한 학습부는 내부저장소에 해당 처방을 받은 환자의 ID나 이름 을 함께 저장할 수 있다. 검수 모델을 저장한 이후 동일한 처방이 접수되는 경우, 기존 검수 모델을 재사용하기 위함이다. 도 13은 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수 방법(S300)을 설명하기 위한 흐름도이다. S310 단계는 검수 모델을 실행하여 실제 조제 포장된 의약품 영상 내에서 각각의 알약을 검출하고 인식하는 단 계이다. S320 단계는 실제 조제 포장된 의약품 영상 내에서 검출한 알약의 인식 결과를 바탕으로 의약품 품목별 개수를 산출하는 단계이다. S330 단계는 산출된 의약품 품목별 개수와 처방을 비교하여 오조제 여부를 판단하는 단계이다. 선택적으로, 오 조제 여부를 판단할 수 없는 경우 육안 검수가 필요하다는 내용을 화면이나 소리를 이용하여 출력함으로써 최종 적인 직접 육안 검수가 이루어지도록 할 수 있다. 참고로, 본 발명의 실시예에 따른 구성 요소들은 소프트웨어 또는 FPGA(Field Programmable Gate Array) 또는 ASIC(Application Specific Integrated Circuit)와 같은 하드웨어 형태로 구현될 수 있으며, 소정의 역할들을 수행할 수 있다. 그렇지만 '구성 요소들'은 소프트웨어 또는 하드웨어에 한정되는 의미는 아니며, 각 구성 요소는 어드레싱할 수 있는 저장 매체에 있도록 구성될 수도 있고 하나 또는 그 이상의 프로세서들을 재생시키도록 구성될 수도 있다. 따라서, 일 예로서 구성 요소는 소프트웨어 구성 요소들, 객체지향 소프트웨어 구성 요소들, 클래스 구성 요소 들 및 태스크 구성 요소들과 같은 구성 요소들과, 프로세스들, 함수들, 속성들, 프로시저들, 서브루틴들, 프로 그램 코드의 세그먼트들, 드라이버들, 펌웨어, 마이크로 코드, 회로, 데이터, 데이터베이스, 데이터 구조들, 테 이블들, 어레이들 및 변수들을 포함한다. 구성 요소들과 해당 구성 요소들 안에서 제공되는 기능은 더 작은 수의 구성 요소들로 결합되거나 추가적인 구 성 요소들로 더 분리될 수 있다. 이 때, 처리 흐름도 도면들의 각 블록과 흐름도 도면들의 조합들은 컴퓨터 프로그램 인스트럭션들에 의해 수행 될 수 있음을 이해할 수 있을 것이다. 이들 컴퓨터 프로그램 인스트럭션들은 범용 컴퓨터, 특수용 컴퓨터 또는 기타 프로그램 가능한 데이터 프로세싱 장비의 프로세서에 탑재될 수 있으므로, 컴퓨터 또는 기타 프로그램 가 능한 데이터 프로세싱 장비의 프로세서를 통해 수행되는 그 인스트럭션들이 흐름도 블록(들)에서 설명된 기능들 을 수행하는 수단을 생성하게 된다. 이들 컴퓨터 프로그램 인스트럭션들은 특정 방식으로 기능을 구현하기 위해 컴퓨터 또는 기타 프로그램 가능한 데이터 프로세싱 장비를 지향할 수 있는 컴퓨터를 이용하거나 또는 컴퓨터 판독 가능 메모리에 저장되는 것도 가능하므로, 그 컴퓨터를 이용하거나 컴퓨터 판독 가능 메모리에 저장된 인 스트럭션들은 흐름도 블록(들)에서 설명된 기능을 수행하는 인스트럭션 수단을 내포하는 제조 품목을 생산하는 것도 가능하다. 컴퓨터 프로그램 인스트럭션들은 컴퓨터 또는 기타 프로그램 가능한 데이터 프로세싱 장비 상에 탑재되는 것도 가능하므로, 컴퓨터 또는 기타 프로그램 가능한 데이터 프로세싱 장비 상에서 일련의 동작 단계 들이 수행되어 컴퓨터로 실행되는 프로세스를 생성해서 컴퓨터 또는 기타 프로그램 가능한 데이터 프로세싱 장 비를 수행하는 인스트럭션들은 흐름도 블록(들)에서 설명된 기능들을 실행하기 위한 단계들을 제공하는 것도 가 능하다. 또한, 각 블록은 특정된 논리적 기능(들)을 실행하기 위한 하나 이상의 실행 가능한 인스트럭션들을 포함하는 모듈, 세그먼트 또는 코드의 일부를 나타낼 수 있다. 또, 몇 가지 대체 실행 예들에서는 블록들에서 언급된 기 능들이 순서를 벗어나서 발생하는 것도 가능함을 주목해야 한다. 예컨대, 잇달아 도시되어 있는 두 개의 블록들 은 사실 실질적으로 동시에 수행되는 것도 가능하고 또는 그 블록들이 때때로 해당하는 기능에 따라 역순으로 수행되는 것도 가능하다. 이 때, 본 실시예에서 사용되는 '~부'라는 용어는 소프트웨어 또는 FPGA또는 ASIC과 같은 하드웨어 구성요소를 의미하며, '~부'는 어떤 역할들을 수행한다. 그렇지만 '~부'는 소프트웨어 또는 하드웨어에 한정되는 의미는 아 니다. '~부'는 어드레싱할 수 있는 저장 매체에 있도록 구성될 수도 있고 하나 또는 그 이상의 프로세서들을 재 생시키도록 구성될 수도 있다. 따라서, 일 예로서 '~부'는 소프트웨어 구성요소들, 객체지향 소프트웨어 구성 요소들, 클래스 구성요소들 및 태스크 구성요소들과 같은 구성요소들과, 프로세스들, 함수들, 속성들, 프로시저 들, 서브루틴들, 프로그램 코드의 세그먼트들, 드라이버들, 펌웨어, 마이크로코드, 회로, 데이터, 데이터베이스, 데이터 구조들, 테이블들, 어레이들, 및 변수들을 포함한다. 구성요소들과 '~부'들 안에서 제공 되는 기능은 더 작은 수의 구성요소들 및 '~부'들로 결합되거나 추가적인 구성요소들과 '~부'들로 더 분리될 수 있다. 뿐만 아니라, 구성요소들 및 '~부'들은 디바이스 또는 보안 멀티미디어카드 내의 하나 또는 그 이상의 CPU들을 재생시키도록 구현될 수도 있다. 전술한 고형 의약품의 AI 기반 비전 검수를 위한 데이터 확장 방법, 학습 방법 및 AI 기반 의약품 비전 검수 방법은 도면에 제시된 흐름도를 참조로 하여 설명되었다. 간단히 설명하기 위하여 상기 방법은 일련의 블록들로 도시되고 설명되었으나, 본 발명은 상기 블록들의 순서에 한정되지 않고, 몇몇 블록들은 다른 블록들과 본 명세 서에서 도시되고 기술된 것과 상이한 순서로 또는 동시에 일어날 수도 있으며, 동일한 또는 유사한 결과를 달성 하는 다양한 다른 분기, 흐름 경로, 및 블록의 순서들이 구현될 수 있다. 또한, 본 명세서에서 기술되는 방법의 구현을 위하여 도시된 모든 블록들이 요구되지 않을 수도 있다. 이상, 본 발명의 구성에 대하여 첨부 도면을 참조하여 상세히 설명하였으나, 이는 예시에 불과한 것으로서, 본"}
{"patent_id": "10-2021-0109632", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 6, "content": "발명이 속하는 기술분야에 통상의 지식을 가진자라면 본 발명의 기술적 사상의 범위 내에서 다양한 변형과 변경 이 가능함은 물론이다. 따라서 본 발명의 보호 범위는 전술한 실시예에 국한되어서는 아니되며 이하의 특허청구 범위의 기재에 의하여 정해져야 할 것이다."}
{"patent_id": "10-2021-0109632", "section": "도면", "subsection": "도면설명", "item": 1, "content": "도 1a는 포장 전 약품 영상의 예. 도 1b는 포장 후 약품 영상의 예. 도 2a는 단일 알약 영상의 위치 변화를 통한 영상데이터 확장의 예. 도 2b는 단일 알약 영상의 각도 및 위치 변화를 통한 영상데이터 확장의 예. 도 3a는 단일 알약 영상을 확장한 영상으로 학습 후, 알약들이 떨어져 분포하는 영상에 대한 알약 검출 및 인식 결과. 도 3b는 단일 알약 영상을 확장한 영상으로 학습 후, 알약들이 가깝게 분포하는 영상에 대한 알약 검출 및 인식 결과. 도 4a는 준비 영상 중에서 6종의 약품에서 각 단일 약품에 대한 영상의 예. 도 4b는 준비 영상 중에서 배경 영상의 예. 도 5는 알약 2종의 앞면 영상을 이용한 영상 확장의 예. 도 6는 알약 6종의 앞면 영상을 이용한 영상 확장의 예. 도 7a은 단일 알약 영상을 확장한 영상으로 학습한 후의 시험 결과의 예. 도 7b는 복수 개의 알약 영상의 조합을 통해 확장한 영상으로 학습한 후의 시험 결과의 예. 도 8은 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수 시스템의 구성을 나타낸 블록도.도 9는 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수 시스템의 데이터관리부의 구성을 나타낸 블록도. 도 10은 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수의 전체 과정을 나타낸 흐름도. 도 11은 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수를 위한 데이터 확장 방법을 설명하기 위한 흐름 도. 도 12는 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수를 위한 학습 방법을 설명하기 위한 흐름도. 도 13은 본 발명의 일 실시예에 따른 AI 기반 의약품 비전 검수 방법을 설명하기 위한 흐름도."}
