{"patent_id": "10-2022-0077820", "section": "특허_기본정보", "subsection": "특허정보", "content": {"공개번호": "10-2024-0000966", "출원번호": "10-2022-0077820", "발명의 명칭": "인공지능을 이용한 의료 이미지 분할 학습 방법 및 그 시스템, 의료 이미지 분할 방법 및 그", "출원인": "연세대학교 산학협력단", "발명자": "김휘영"}}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_1", "content": "에너지 기반 분포 이탈 감지를 이용하여 의료 이미지 관련 데이터들을 FCN (Fully Convolutional Network, 완전합성곱 신경망)에 입력하여 의료 이미지 분할을 학습시키는 방법으로서,상기 의료 이미지 관련 데이터들 중 초기 양성(positive) 데이터를 상기 FCN에 입력하는 단계,상기 FCN에서 출력된 상기 초기 양성 데이터의 특징 맵을 초기 에너지 함수로 변환하는 단계,상기 초기 에너지 함수를 랑주뱅 함수(Langevin Dynamics)에 입력해 음성(negative) 데이터를 출력하는 단계,상기 음성 데이터와 상기 의료 이미지 관련 데이터들 중 양성 데이터를 상기 FCN에 입력하는 단계,상기 FCN에서 상기 음성 데이터의 특징 맵과 상기 양성 데이터의 특징 맵을 출력하는 단계,상기 음성 데이터의 특징 맵과 상기 양성 데이터의 특징 맵을 각각 음성 에너지 함수 및 양성 에너지 함수로 변환하는 단계,상기 음성 에너지 함수 및 상기 양성 에너지 함수로부터 손실 함수를 출력하는 단계, 및상기 양성 데이터의 특징 맵으로부터 분할 예측 맵을 출력하여 의료 이미지 분할을 학습하는 단계를 포함하는 의료 이미지 분할 학습 방법."}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_2", "content": "제1항에서,상기 음성 데이터를 출력하는 단계에서, 상기 랑주뱅 함수는 하기의 수학식을 만족하는 의료 이미지 분할 학습방법.상기 xt는 t번째 입력 데이터, 상기 xt-1은 t-1번째 입력 데이터, 상기 Eθ(xt-1)는 가중치 θ를 가지고 상기 FCN에 의해 매개 변수화된 t-1번째 입력 데이터의 에너지 함수, 상기 α 및 상기 ε은 상수임"}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_3", "content": "제1항에서,상기 음성 데이터의 특징 맵과 상기 양성 데이터의 특징 맵을 출력하는 단계에서, 상기 각 특징 맵은 하기의 수학식을 만족하는 확률 분포를 합성한 데이터로서 출력하는 의료 이미지 분할 학습 방법.상기 pθ는 상기 FCN의 확률 분포, 상기 Eθ(x)는 가중치 θ를 가지고 상기 FCN에 의해 매개 변수화된 에너지 함수, 상기 Z(θ)는 정규화 상수임"}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_4", "content": "제1항에서,상기 음성 데이터의 특징 맵과 상기 양성 데이터의 특징 맵을 각각 음성 에너지 함수 및 양성 에너지 함수로 변환하는 단계에서,공개특허 10-2024-0000966-3-상기 각 특징 맵은 Fθ(x)로 출력되고,상기 각 에너지 함수는 하기의 수학식을 만족하는 의료 이미지 분할 학습 방법.상기 Eθ(x)는 가중치 θ를 가지고 상기 FCN에 의해 매개 변수화된 에너지 함수, 상기 Aθ(x)는 입력 이미지 x에서 클래스 분류를 위해 설계된 점수, 상기 fθ(x)는 입력 이미지 x에서 픽셀별 분류를 수행하는 FCN의 특징 맵,상기 i는 이미지 x의 행 번호, 상기 j는 이미지 x의 열번호임"}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_5", "content": "제1항에 있어서,상기 손실 함수를 출력하는 단계에서, 상기 손실 함수는 에너지 기반 생성 모델(Energy Based generativeModel, EBM) 손실 함수를 포함하고, 상기 음성 에너지 함수와 상기 양성 에너지 함수를 변수로 하여 하기의 수학식을 만족하는 상기 에너지 기반 생성 모델 손실 함수를 산출하는 에너지 기반 분포 이탈 감지 방법.상기 LEBM은 상기 에너지 기반 생성 모델 손실 함수, 상기 Eθ(x)는 가중치 θ를 가지고 심층 신경망에 의해 매개변수화된 에너지 함수로서 상기 Eθ(x-)는 상기 음성 에너지 함수이며, 상기 Eθ(x+)는 상기 양성 에너지 함수이고, 상기 n은 입력 데이터에 대한 배치(batch) 사이즈, 상기 i는 배치 사이즈 내의 데이터 번호, 상기 x+는 양성 이미지 데이터이고, 상기 x-는 음성(negative) 이미지 데이터임"}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_6", "content": "제5항에서,상기 양성 데이터로부터 그라운드 트루스 레이블을 제공하는 단계를 더 포함하고,상기 손실 함수를 출력하는 단계에서, 상기 손실 함수는 분할 손실 함수를 더 포함하고상기 그라운드 트루스 레이블과 상기 양성 데이터의 특징 맵을 비교하여 상기 분할 손실 함수를 생성하는 의료이미지 분할 학습 방법."}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_7", "content": "제6항에서,상기 손실 함수는 하기의 수학식을 만족하는 의료 이미지 분할 학습 방법.상기 L은 상기 손실 함수의 전체 손실, 상기 λ1 및 상기 λ2는 음수가 아닌 가중치, 상기 Lseg는 상기 분할 손실함수임"}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_8", "content": "제1항에서,상기 의료 이미지 분할을 학습하는 단계에서, 상기 손실 함수의 손실값이 기설정치 이상인 경우, 상기 분할 예측 맵을 재분할하고, 상기 손실 함수의 손실값이 기설정치 미만인 경우 상기 분할 예측 맵의 분할을 유지하는의료 이미지 분할 학습 방법.공개특허 10-2024-0000966-4-청구항 9 제1항에 따른 의료 이미지 분할 학습 방법에 의해 학습된 FCDD (Fully Convolutional Data Description)을 제공하는 단계,의료 이미지 데이터를 상기 FCFF에 입력하는 단계,상기 의료 이미지 데이터의 특징 맵을 출력하는 단계,상기 특징 맵을 에너지 함수로 변환하는 단계,상기 에너지 함수로부터 분포 외 점수를 출력하는 단계, 및상기 에너지 함수로부터 분할 예측 맵을 출력하는 단계를 포함하는 의료 이미지 분할 방법."}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_10", "content": "제9항에서,상기 특징 맵을 에너지 함수로 변환하는 단계는 상기 특징 맵을 하기의 수학식을 만족하는 상기 에너지 함수로변환하는 의료 이미지 분할 방법.상기 Eθ(x)는 가중치 θ를 가지고 상기 FCDD에 의해 매개 변수화된 에너지 함수, 상기 Hθ,i(x)는 거리 장면 분할에서 제안된 배경 분할 점수, 상기 fθ(x)[i,;]T는 입력 데이터 x에서 픽셀별 분류를 수행하는 상기 FCDD의 i번째 행에서의 전치 행렬로서의 특징 맵, 상기 Pθ(x)[i,;]는 에너지 기반 생성 모델로 훈련된 분포임"}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_11", "content": "제9항에서,상기 특징 맵을 출력하는 단계에서, 상기 특징 맵은 상기 의료 이미지 데이터의 분할 신뢰도와 합성 이미지로출력되고, 상기 합성 이미지 내에서 상기 분할 신뢰도가 기설정된 수치 이상인 부분을 분할하여 상기 분할 예측맵을 출력하는 단계를 수행하는 의료 이미지 분할 방법."}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_12", "content": "제9항에서,상기 분포 외 점수를 출력하는 단계는 하기의 수학식을 만족하는 의료 이미지 분할 방법.상기 는 입력 x에 대한 이미지 수준 점수, 상기 x는 입력, 상기 Ω은 입력 x의 배경 분할 예측의 픽셀 인덱스, 상기 i는 Ω의 픽셀 인덱스 중 하나, 상기 Hθ,I(x)는 거리 장면 분할(street-scene segmentation)의 배경분할 점수임"}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_13", "content": "의료 이미지 관련 데이터들 중 양성 데이터들을 제공하는 학습용 데이터 수집부,상기 양성 데이터들을 제공받아 그라운드 트루스 레이블로 가공하는 학습용 데이터 전처리부,상기 양성 데이터들을 양성 데이터의 특징 맵으로 출력하는 모델 학습부, 및 공개특허 10-2024-0000966-5-상기 양성 데이터의 특징 맵을 양성 에너지 함수로 변환하고, 상기 양성 데이터의 특징 맵으로부터 분할 예측맵을 출력하여 상기 모델 학습부에 의료 이미지 분할을 학습시키는 학습용 데이터 후처리부를 포함하고,상기 모델 학습부는 상기 양성 데이터들 중 초기 양성 데이터를 초기 양성 데이터의 특징 맵으로 출력하고, 상기 학습용 데이터 후처리부는 상기 초기 양성 데이터의 특징 맵을 초기 에너지 함수로 변환하며, 상기 초기 에너지 함수는 상기 학습용 데이터 전처리부에 입력되어 음성 데이터로 출력되며,상기 음성 데이터는 상기 모델 학습부에 입력되어 음성 데이터 특징 맵으로 출력되고 상기 학습용 데이터 후처리부에 전송되는 의료 이미지 분할 학습 시스템."}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_14", "content": "제13항에서,상기 학습용 데이터 후처리부는 하기의 수학식을 만족하는 랑주뱅 함수를 더 포함하고, 상기 초기 에너지 함수는 상기 랑주뱅 함수에 입력되어 상기 음성 데이터로 출력되는 의료 이미지 분할 학습 시스템.상기 xt는 t번째 입력 데이터, 상기 xt-1은 t-1번째 입력 데이터, 상기 Eθ(xt-1)는 가중치 θ를 가지고 상기 FCN에 의해 매개 변수화된 t-1번째 입력 데이터의 에너지 함수, 상기 α 및 상기 ε은 상수임"}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_15", "content": "제13항에서,상기 학습용 데이터 후처리부는 상기 분할 예측 맵과 함께 손실 함수를 출력하고, 상기 손실 함수는 에너지 기반 생성 모델(Energy Based generative Model, EBM) 손실 함수를 포함하고, 상기 음성 에너지 함수와 상기 양성 에너지 함수를 변수로 하여 하기의 수학식을 만족하는 상기 에너지 기반 생성 모델 손실 함수를 산출하는 의료 이미지 분할 학습 시스템.상기 LEBM은 상기 에너지 기반 생성 모델 손실 함수, 상기 Eθ(x)는 가중치 θ를 가지고 심층 신경망에 의해 매개변수화된 에너지 함수로서 상기 Eθ(x-)는 상기 음성 에너지 함수이며, 상기 Eθ(x+)는 상기 양성 에너지 함수이고, 상기 n은 입력 데이터에 대한 배치(batch) 사이즈, 상기 i는 배치 사이즈 내의 데이터 번호, 상기 x+는 양성 이미지 데이터이고, 상기 x-는 음성(negative) 이미지 데이터임"}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_16", "content": "제15항에서,상기 손실 함수는 분할 손실 함수를 더 포함하고, 상기 그라운드 트루스 레이블과 상기 양성 데이터의 특징 맵을 비교하여 상기 분할 손실 함수를 생성하며,상기 손실 함수는 하기의 수학식을 만족하는 의료 이미지 분할 학습 시스템.상기 L은 상기 손실 함수의 전체 손실, 상기 λ1 및 상기 λ2는 음수가 아닌 가중치, 상기 Lseg는 상기 분할 손실함수임"}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_17", "content": "공개특허 10-2024-0000966-6-제15항에서,상기 학습용 데이터 후처리부는 상기 손실 함수의 손실값이 기설정치 이상인 경우, 상기 분할 예측 맵을 재분할하고, 상기 손실 함수의 손실값이 기설정치 미만인 경우 상기 분할 예측 맵의 분할을 유지하는 의료 이미지 분할 학습 시스템."}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_18", "content": "제1항에 따른 의료 이미지 분할 학습 방법에 의해 학습되고, 의료 이미지 데이터를 제공받아 데이터 특징 맵을출력하는 FCDD 모델부,상기 FCDD 모델부에 상기 의료 이미지 데이터를 제공하는 데이터 입력부, 및상기 FCDD 모델부로부터 상기 데이터 특징 맵을 제공받아 에너지 함수로 변환하며, 상기 에너지 함수로부터 분포 외 점수를 출력해 상기 의료 이미지 데이터의 분할 결과를 판단하는 데이터 처리부를 포함하는 의료 이미지 분할 시스템."}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_19", "content": "제18항에서,상기 데이터 처리부는 상기 의료 이미지 데이터의 분할 결과를 하기의 수학식에 의해 판단하는 의료 이미지 분할 시스템.는 입력 x에 대한 이미지 수준 점수, x는 입력, Ω은 입력 x의 배경 분할 예측의 픽셀 인덱스, i는 Ω의 픽셀 인덱스 중 하나임"}
{"patent_id": "10-2022-0077820", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_20", "content": "제18항에서,상기 데이터 처리부는 분할 예측 맵을 출력하는 의료 이미지 분할 시스템."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "요약", "paragraph": 1, "content": "인공지능을 이용한 의료 이미지 분할 학습 방법 및 그 시스템, 의료 이미지 분할 방법 및 그 시스템을 제공한다. 의료 이미지 분할 학습 방법은 에너지 기반 분포 이탈 감지를 이용하여 의료 이미지 관련 데이터들을 FCN에 입력 하여 의료 이미지 분할을 학습한다. 의료 이미지 분할 학습 방법은 i) 의료 이미지 관련 데이터들 중 초기 양성 (뒷면에 계속)"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "기술분야", "paragraph": 1, "content": "본 발명은 의료 이미지 분할 학습 방법 및 그 시스템, 의료 이미지 분할 방법 및 그 시스템에 관한 것이다. 좀 더 상세하게는, 의료 이미지 감지 분야에서 분포 외(Out Of Distribution, OOD) 이미지 점수를 도입한 인공지능 모델을 이용하여 대량의 의료 이미지 샘플 없이도 관심 영역의 이미지 감지 성능을 향상시킬 수 있는 의료 이미 지 분할 학습 방법 및 그 시스템, 의료 이미지 분할 방법 및 그 시스템에 관한 것이다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "배경기술", "paragraph": 1, "content": "종래의 의료 이미지 분석 기술은 픽셀 수준의 불확실성 측정 데이터를 집계하여 각 입력 데이터를 평가하고 설 명을 위해 불확실성 맵을 사용했었다. 좀더 상세하게는, FCN(Fully Convolutional Network, 완전 합성곱 신경망) 추론을 통해 추정되는 픽셀 수준 불확실성 메트릭을 집계하여 분포 외 이미지 점수를 계산했었다. 그러나 종래의 불확실성 맵은 각 입력 샘플의 이미지 수준 평가에 필요한 분포 외 이미지 평가에 효과적이지 않 았다. 그리고 종래의 의료 응용 프로그램에서 기계 학습 알고리즘은 학습 데이터의 부족 및 데이터 분산영역 집중으로 분포 외 데이터 샘플에 취약하였다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "해결하려는과제", "paragraph": 1, "content": "설명 가능한 에너지 기반 분포 이탈 감지 방법을 이용한 의료 이미지 분할 학습 방법과 시스템을 제공하고자 한 다. 또한, 전술한 에너지 기반 분포 이탈 감지 방법을 이용한 의료 이미지 분할 방법과 시스템을 제공하고자 한다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 1, "content": "본 발명의 일 실시예에 따른 에너지 기반 분포 이탈 감지를 이용하여 의료 이미지 관련 데이터들을 FCN (Fully Convolutional Network, 완전 합성곱 신경망)에 입력하여 의료 이미지 분할을 학습시키는 방법으로서, i) 의료 이미지 관련 데이터들 중 초기 양성(positive) 데이터를 FCN에 입력하는 단계, ii) FCN에서 출력된 초기 양성 데이터의 특징 맵을 초기 에너지 함수로 변환하는 단계, iii) 초기 에너지 함수를 랑주뱅 함수(Langevin Dynamics)에 입력해 음성(negative) 데이터를 출력하는 단계, iv) 음성 데이터와 의료 이미지 관련 데이터들 중 양성 데이터를 FCN에 입력하는 단계, v) FCN에서 음성 데이터의 특징 맵과 양성 데이터의 특징 맵을 출력하는 단계, vi) 음성 데이터의 특징 맵과 양성 데이터의 특징 맵을 각각 음성 에너지 함수 및 양성 에너지 함수로 변 환하는 단계, vii) 음성 에너지 함수 및 양성 에너지 함수로부터 손실 함수를 출력하는 단계, 및 viii) 양성 데 이터의 특징 맵으로부터 분할 예측 맵을 출력하여 의료 이미지 분할을 학습하는 단계를 포함한다. 음성 데이터를 출력하는 단계에서, 랑주뱅 함수는 아래의 수학식을 만족할 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 2, "content": "xt는 t번째 입력 데이터, xt-1은 t-1번째 입력 데이터, Eθ(xt-1)는 가중치 θ를 가지고 FCN에 의해 매개 변수화 된 t-1번째 입력 데이터의 에너지 함수, α 및 ε은 상수임 음성 데이터의 특징 맵과 양성 데이터의 특징 맵을 출력하는 단계에서, 각 특징 맵은 하기의 수학식을 만족하는 확률 분포를 합성한 데이터로서 출력할 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 3, "content": "pθ는 FCN의 확률 분포, Eθ(x)는 가중치 θ를 가지고 FCN에 의해 매개 변수화된 에너지 함수, Z(θ)는 정규화 상수임 음성 데이터의 특징 맵과 양성 데이터의 특징 맵을 각각 음성 에너지 함수 및 양성 에너지 함수로 변환하는 단 계에서, 각 특징 맵은 Fθ(x)로 출력되고, 각 에너지 함수는 하기의 수학식을 만족할 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 4, "content": "Eθ(x)는 가중치 θ를 가지고 FCN에 의해 매개 변수화된 에너지 함수, Aθ(x)는 입력 이미지 x에서 클래스 분류 를 위해 설계된 점수, fθ(x)는 입력 이미지 x에서 픽셀별 분류를 수행하는 FCN의 특징 맵, i는 이미지 x의 행 번호, j는 이미지 x의 열번호임 손실 함수를 출력하는 단계에서, 손실 함수는 에너지 기반 생성 모델(Energy Based generative Model, EBM) 손 실 함수를 포함하고, 음성 에너지 함수와 양성 에너지 함수를 변수로 하여 하기의 수학식을 만족할 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 5, "content": "LEBM은 에너지 기반 생성 모델 손실 함수, Eθ(x)는 가중치 θ를 가지고 심층 신경망에 의해 매개 변수화된 에너 지 함수로서 Eθ(x-)는 음성 에너지 함수이며, Eθ(x+)는 양성 에너지 함수이고, n은 입력 데이터에 대한 배치 (batch) 사이즈, i는 배치 사이즈 내의 데이터 번호, x+는 양성 이미지 데이터이고, x-는 음성(negative) 이미 지 데이터임 본 발명의 일 실시예에 따른 의료 이미지 분할 학습 방법은 양성 데이터로부터 그라운드 트루스 레이블을 제공 하는 단계를 더 포함할 수 있다. 손실 함수를 출력하는 단계에서, 손실 함수는 분할 손실 함수를 더 포함하고, 그라운드 트루스 레이블과 양성 데이터의 특징 맵을 비교하여 분할 손실 함수를 생성할 수 있다.손실 함수는 하기의 수학식을 만족할 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 6, "content": "L은 손실 함수의 전체 손실, λ1 및 λ2는 음수가 아닌 가중치, Lseg는 분할 손실 함수임 의료 이미지 분할을 학습하는 단계에서, 손실 함수의 손실값이 기설정치 이상인 경우, 분할 예측 맵을 재분할하 고, 손실 함수의 손실값이 기설정치 미만인 경우 분할 예측 맵의 분할을 유지할 수 있다. 본 발명의 다른 실시예에 따른 의료 이미지 분할 방법은 i) 전술한 의료 이미지 분할 학습 방법에 의해 학습된 FCDD (Fully Convolutional Data Description)을 제공하는 단계, ii) 의료 이미지 데이터를 FCFF에 입력하는 단계, iii) 의료 이미지 데이터의 특징 맵을 출력하는 단계, iv) 특징 맵을 에너지 함수로 변환하는 단계, v) 에너지 함수로부터 분포 외 점수를 출력하는 단계, 및 vi) 에너지 함수로부터 분할 예측 맵을 출력하는 단계를 포함한다. 특징 맵을 에너지 함수로 변환하는 단계는 특징 맵을 하기의 수학식을 만족하는 에너지 함수로 변환할 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 7, "content": "Eθ(x)는 가중치 θ를 가지고 FCDD에 의해 매개 변수화된 에너지 함수, Hθ,i(x)는 거리 장면 분할에서 제안된 배 경 분할 점수, fθ(x)[i,;]T는 입력 데이터 x에서 픽셀별 분류를 수행하는 FCDD의 i번째 행에서의 전치 행렬로서 의 특징 맵, Pθ(x)[i,;]는 에너지 기반 생성 모델로 훈련된 분포임 특징 맵을 출력하는 단계에서, 특징 맵은 의료 이미지 데이터의 분할 신뢰도와 합성 이미지로 출력되고, 합성 이미지 내에서 분할 신뢰도가 기설정된 수치 이상인 부분을 분할하여 분할 예측 맵을 출력하는 단계를 수행할 수 있다. 분포 외 점수를 출력하는 단계는 하기의 수학식을 만족할 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 8, "content": "는 입력 x에 대한 이미지 수준 점수, x는 입력, Ω은 입력 x의 배경 분할 예측의 픽셀 인덱스, i는 Ω의 픽 셀 인덱스 중 하나, Hθ,I(x)는 거리 장면 분할(street-scene segmentation)의 배경 분할 점수임 본 발명의 일 실시예에 따른 의료 이미지 분할 학습 시스템은, i) 의료 이미지 관련 데이터들 중 양성 데이터들 을 제공하는 학습용 데이터 수집부, ii) 양성 데이터들을 제공받아 그라운드 트루스 레이블로 가공하는 학습용 데이터 전처리부, iii) 양성 데이터들을 양성 데이터의 특징 맵으로 출력하는 모델 학습부, 및 iv) 양성 데이터 의 특징 맵을 양성 에너지 함수로 변환하고, 양성 데이터의 특징 맵으로부터 분할 예측 맵을 출력하여 모델 학 습부에 의료 이미지 분할을 학습시키는 학습용 데이터 후처리부를 포함한다. 모델 학습부는 양성 데이터들 중 초기 양성 데이터를 초기 양성 데이터의 특징 맵으로 출력하고, 학습용 데이터 후처리부는 초기 양성 데이터의 특징 맵을 초기 에너지 함수로 변환하며, 초기 에너지 함수는 학습용 데이터 전처리부에 입력되어 음성 데이터 로 출력되며, 음성 데이터는 모델 학습부에 입력되어 음성 데이터 특징 맵으로 출력되고 학습용 데이터 후처리 부에 전송될 수 있다. 학습용 데이터 후처리부는 하기의 수학식을 만족하는 랑주뱅 함수를 더 포함하고, 초기 에너지 함수는 랑주뱅 함수에 입력되어 음성 데이터로 출력될 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 9, "content": "xt는 t번째 입력 데이터, xt-1은 t-1번째 입력 데이터, Eθ(xt-1)는 가중치 θ를 가지고 FCN에 의해 매개 변수화 된 t-1번째 입력 데이터의 에너지 함수, α 및 ε은 상수임학습용 데이터 후처리부는 분할 예측 맵과 함께 손실 함수를 출력하고, 손실 함수는 에너지 기반 생성 모델 (Energy Based generative Model, EBM) 손실 함수를 포함하고, 음성 에너지 함수와 양성 에너지 함수를 변수로 하여 하기의 수학식을 만족하는 에너지 기반 생성 모델 손실 함수를 산출할 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 10, "content": "LEBM은 에너지 기반 생성 모델 손실 함수, Eθ(x)는 가중치 θ를 가지고 심층 신경망에 의해 매개 변수화된 에너 지 함수로서 Eθ(x-)는 음성 에너지 함수이며, Eθ(x+)는 양성 에너지 함수이고, n은 입력 데이터에 대한 배치 (batch) 사이즈, i는 배치 사이즈 내의 데이터 번호, x+는 양성 이미지 데이터이고, x-는 음성(negative) 이미 지 데이터임 손실 함수는 분할 손실 함수를 더 포함하고, 그라운드 트루스 레이블과 양성 데이터의 특징 맵을 비교하여 분할 손실 함수를 생성하며, 손실 함수는 아래의 수학식을 만족할 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 11, "content": "L은 손실 함수의 전체 손실, λ1 및 λ2는 음수가 아닌 가중치, Lseg는 분할 손실 함수임 학습용 데이터 후처리부는 손실 함수의 손실값이 기설정치 이상인 경우, 분할 예측 맵을 재분할하고, 손실 함수 의 손실값이 기설정치 미만인 경우 분할 예측 맵의 분할을 유지할 수 있다. 본 발명의 다른 실시예에 따른 의료 이미지 분할 학습 시스템은, i) 전술한 의료 이미지 분할 학습 방법에 의해 학습되고, 의료 이미지 데이터를 제공받아 데이터 특징 맵을 출력하는 FCDD 모델부, ii) FCDD 모델부에 의료 이 미지 데이터를 제공하는 데이터 입력부, 및 iii) FCDD 모델부로부터 데이터 특징 맵을 제공받아 에너지 함수로 변환하며, 에너지 함수로부터 분포 외 점수를 출력해 의료 이미지 데이터의 분할 결과를 판단하는 데이터 처리 부를 포함한다. 데이터 처리부는 의료 이미지 데이터의 분할 결과를 아래의 수학식에 의해 판단할 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 12, "content": "는 입력 x에 대한 이미지 수준 점수, x는 입력, Ω은 입력 x의 배경 분할 예측의 픽셀 인덱스, i는 Ω의 픽 셀 인덱스 중 하나임 데이터 처리부는 분할 예측 맵을 출력할 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명의효과", "paragraph": 1, "content": "에너지 기반 생성 모델을 훈련시키는 방법을 통하여 분포 외 데이터 샘플 없이도 광범위한 음성(negative) 샘플 을 처리할 수 있다. 이는 의료 이미지 데이터 처리에 적합하다. 즉, 각 질병마다 인공지능 학습에 필요한 원 하는 수의 모집단을 얻을 수 없는 경우가 많아 본 발명의 일 실시예를 통해 이러한 문제점을 해결할 수 있다. 마코프 체인 몬테 카를로(Markov Chain Monte Carlo, MCMC) 샘플을 통해 각 픽셀의 에너지 점수를 조정하여 분 포 외 이미지 감지 성능을 향상시킬 수 있다."}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 1, "content": "아래에서는 첨부한 도면을 참고로 하여 본 개시의 실시예에 대하여 본 개시가 속하는 기술 분야에서 통상의 지 식을 가진 자가 용이하게 실시할 수 있도록 상세히 설명한다. 그러나 본 개시는 여러 가지 상이한 형태로 구현 될 수 있으며 여기에서 설명하는 실시예에 한정되지 않는다. 그리고 도면에서 본 개시를 명확하게 설명하기 위 해서 설명과 관계없는 부분은 생략하였으며, 명세서 전체를 통하여 유사한 부분에 대해서는 유사한 도면 부호를 붙였다. 명세서에서, 어떤 부분이 어떤 구성요소를 \"포함\"한다고 할 때, 이는 특별히 반대되는 기재가 없는 한 다른 구 성요소를 제외하는 것이 아니라 다른 구성요소를 더 포함할 수 있는 것을 의미한다. 네트워크를 구성하는 장치 들은 하드웨어나 소프트웨어 또는 하드웨어 및 소프트웨어의 결합으로 구현될 수 있다. 또한, 명세서에 기재된 \"……부\", \"……기\", \"……모듈\" 등의 용어는 적어도 하나의 기능이나 작동을 처리하는 단위를 의미하며, 이는 하드웨어나 소프트웨어 또는 하드웨어 및 소프트웨어의 결합으로 구현될 수 있다. 본 발명의 일 실시예에서 설명하는 장치들은 적어도 하나의 프로세서, 메모리 장치, 통신 장치 등을 포함하는 하드웨어로 구성되고, 지정된 장소에 하드웨어와 결합되어 실행되는 프로그램이 저장된다. 하드웨어는 본 발명 의 방법을 실행할 수 있는 구성과 성능을 가진다. 프로그램은 도면들을 참고로 설명한 본 발명의 작동 방법을 구현한 명령어(instructions)를 포함하고, 프로세서와 메모리 장치 등의 하드웨어와 결합하여 본 발명을 실행한 다. 본 명세서에서 \"전송 또는 제공\"은 직접적인 전송 또는 제공하는 것뿐만 아니라 다른 장치를 통해 또는 우회 경 로를 이용하여 간접적으로 전송 또는 제공도 포함할 수 있다. 본 명세서에서 단수로 기재된 표현은 \"하나\" 또 는 \"단일\" 등의 명시적인 표현을 사용하지 않은 이상, 단수 또는 복수로 해석될 수 있다. 본 명세서에서, 제1, 제2 등과 같이 서수를 포함하는 용어들은 다양한 구성요소들을 설명하는데 사용될 수 있지 만, 상기 구성요소들은 상기 용어들에 의해 한정되지는 않는다. 상기 용어들은 하나의 구성요소를 다른 구성요 소로부터 구별하는 목적으로만 사용된다. 예를 들어, 본 개시의 권리 범위를 벗어나지 않으면서 제1 구성요소는 제2 구성요소로 명명될 수 있고, 유사하게 제2 구성요소도 제1 구성요소로 명명될 수 있다. 본 명세서에서 도 면을 참고하여 설명한 흐름도에서, 작동 순서는 변경될 수 있고, 여러 작동들이 병합되거나, 어느 작동이 분할 될 수 있고, 특정 작동은 수행되지 않을 수 있다. 본 발명의 일 실시예에서는 FCN 아키텍쳐를 기반으로 하는 FCDD (Fully Convolutional Data Description, 완전 합성곱 데이터 설명)를 변형, 즉 FCN에 에너지 기반 생성 모델(Energy Based Generative Model, EBM)을 결합시 켜 의료 이미지 분할 학습과 의료 이미지 분할에 이용한다. 다시 말하면, 에너지 기반 생성 모델을 FCN 아키텍 쳐의 학습 데이터로 한다. FCDD는 대량의 보조 이상 점수 데이터 세트를 이용하여 이상 점수를 학습한다. 그러나 보조 이상 점수 데이터 세트를 구성하기 위해 대량의 이상 의료 데이터를 제작하는 것은 불가능하다. 따라서 에너지 기반 생성 모델을 통한 비지도 방식을 이용한다. 즉, 에너지 기반 생성 모델을 사용해 임의로 음성 입력을 생성하고, FCN이 의료 이미지의 분포 학습 데이터 및 이미지 수준의 이상 점수 데이터를 학습한다. 각 샘플에 에너지 점수를 할당하 는 에너지 기반 생성 모델을 FCN의 입력으로 하여 학습한다. 이 경우, FCN 구조를 수정하지 않고 FCDD 원리를 적용할 수 있는 이점이 있다. 이 방법은 정답 데이터가 없는 비지도 학습으로 이루어진다. FCN에서는 음성 에 너지 기반 생성 이미지와 양성 에너지 기반 생성 이미지가 공통으로 입력되어 학습된 FCDD 모델이 구성된다. 본 발명의 일 실시예에서는 FCDD 원리에 부합하는 분포 외 이미지에 대한 메트릭을 설계한다. 메트릭은 FCN를 에너지 기반 생성 모델의 출력으로 학습시키고, 설계한 메트릭으로 에너지 기반 밀도 추정에 따른 점수를 학습 시킨다. 이를 손실 함수로 구현할 수 있다. 분포 외 이미지 감지를 위해 이미지 기반 생성 모델은 FCN을 기반 으로 한 FCDD로 구축된다. 예를 들면, FCDD의 손실 함수는 아래의 수학식 1과 같다. 아래의 수학식 1에서 정상 점수 학습 데이터인 경우, yi는 0이고, 이상(비정상) 점수 학습 데이터인 경우, yi는 1이다. 즉, 이상 점수 학습 데이터에서는 아래의 수 학식의 우변의 앞부분은 0이므로, FCDD의 손실 함수는 뒷부분만 해당된다. [수학식 1]"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 2, "content": "Lfcdd는 FCDD의 손실 함수, n은 입력된 데이터의 배치(batch) 사이즈, i는 입력 데이터 번호, y는 학습 데이터 구분 변수, h는 입력 데이터 이미지의 총 픽셀 열의 개수, w는 입력 데이터의 총 픽셀 행의 개수, ||Aθ(Xi)||1 는 가중치 θ를 가지고 FCN에 의해 매개변수화된 함수이다. 본 발명의 일 실시예에서는 에너지 기반 생성 모델로 확률 밀도를 추정하고 샘플을 생성한다. x"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 3, "content": "N인 에너지 기반 생성 모델의 확률 분포인 pθ는 아래의 수학식 2로 모델링된다. [수학식 2]"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 4, "content": "pθ는 에너지 기반 생성 모델의 확률 분포, Z(θ)는 정규화 상수, Eθ(x)는 가중치 θ로 FCN에 의해 매개 변수화 된 에너지 함수이다. Eθ는 마코프 체인 몬테 카를로 샘플링에 의해 최대 가능성 학습에 대한 충분한 정보를 제공한다. 실제 이미지 의 데이터 분포(q)와 학습 데이터에 의해 훈련된 분포(pθ)를 이용하여 아래의 수학식 3으로 log pθ(x)의 도함 수가 도출된다. log pθ(x)는 FCDD의 손실 함수로서 수학식 1과 동일하다. [수학식 3]"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 5, "content": "pθ(x)는 학습 데이터 분포, q는 실제 데이터 입력에서 FCN에 의해 매개 변수화된 에너지 함수 벡터값, pθ(x) 는 가중치 θ를 가지고 FCN에 의해 매개 변수화된 에너지 기반 생성 모델에 의해 학습된 분포의 에너지 함수 벡 터값, Eθ(x)는 가중치 θ를 가지고 FCN에 의해 매개 변수화된 에너지 함수, 는 실제 이미지 데이터의 독 립 균등 분포 샘플, 는 학습 데이터에 의해 훈련된 분포 데이터의 독립 균등 분포 샘플이다. 의료 이미지 분할 학습 방법 이하에서는 전술한 원리에 기초하여 본 발명의 일 실시예에 따른 의료 이미지 분할의 학습 방법을 도 1 및 도 2 를 참조하여 상세하게 설명한다. 이러한 의료 이미지 분할 학습 방법은 단지 본 발명을 예시하기 위한 것이며, 본 발명이 여기에 한정되는 것은 아니다. 따라서 의료 이미지 분할 학습 방법을 다른 형태로도 변형할 수있다. 도 1은 본 발명의 일 실시예에 따른 의료 이미지 분할 학습 방법의 개념을 개략적으로 나타낸다. 도 2는 도 1 의 의료 이미지 분할 학습 방법의 순서도를 개략적으로 나타낸다. 도 2의 각 단계는 도 1의 각 단계와 동일하 다. 도 1 및 도 2에 도시한 바와 같이, 본 발명의 일 실시예에 따른 의료 이미지 분할 학습 방법은, 의료 이미지 관 련 데이터들 중 초기 양성(positive) 데이터를 FCN에 입력하는 단계(S10), FCN에서 출력된 초기 양성 데이터의 특징 맵을 초기 에너지 함수로 변환하는 단계(S20), 초기 에너지 함수를 랑주뱅 입력 함수에 입력해 음성 (negative) 데이터를 출력 하는 단계(S30), 음성 데이터와 의료 이미지 관련 데이터들 중 양성 데이터를 FCN에 입력하는 단계(S40), FCN에서 음성 데이터의 특징 맵과 양성 데이터의 특징 맵을 출력하는 단계(S50), 음성 데 이터의 특징 맵과 양성 데이터의 특징 맵을 각각 음성 에너지 함수 및 양성 에너지 함수로 변환하는 단계(S60), 음성 에너지 함수 및 양성 에너지 함수로부터 손실 함수를 출력하는 단계(S70), 그리고 양성 데이터의 특징 맵 으로부터 분할 예측 맵을 출력하여 의료 이미지 분할을 학습하는 단계(S80)를 포함한다. 이외에, 본 발명의 일 실시예에 따른 의료 이미지 분할 학습 방법은 필요에 따라 다른 단계들을 더 포함할 수 있다. 먼저, 도 1 및 도 2의 단계(S10)에서는 의료 이미지 관련 데이터들 중 초기 양성(positive) 데이터를 FCN에 입 력한다. 이러한 초기 양성 데이터는 임의로 음성(negative) 데이터를 생성하기 위해 사용된다. 도 1 및 도 2의 단계(S20)에서는 FCN에서 출력된 초기 양성 데이터의 특징 맵을 초기 에너지 함수로 변환한다. 즉, 양성 데이터와 함께 FCN을 비지도 학습시키기 위한 음성 데이터의 생성을 위해 이러한 과정을 거친다. 양 성 데이터는 정상 이미지 데이터를 의미한다. 정상 이미지 데이터는 노이즈가 없고, 사용자가 관찰하고자 하는 위치의 이미지 데이터를 의미한다. 다음으로, 도 1 및 도 2의 단계(S30)에서는 초기 에너지 함수를 랑주뱅(Langevin Dynamics) 입력 함수에 입력해 음성(negative) 데이터를 출력한다. 본 발명의 일 실시예에 사용된 에너지 기반 생성 모델은 마코프 체인 몬테 카를로(Markov Chain Monte Carlo, MCMC) 샘플링을 통해 음성 데이터를 생성하고 그 점수를 높이면서 정상 데이 터의 점수는 낮춘다. 여기서, 음성 데이터는 분포 외 데이터를 의미하고, 정상 데이터는 분포 내 데이터를 의 미한다. FCN은 분포 외 데이터(OOD, Out Of Distribution)와 분포 내 데이터(In-Distribution)를 구분하도록 학습된다. 전술한 수학식 2의 pθ에서 를 얻기 위해서 수학식 3을 반복적으로 수행하면서 확률적 경사 랑주뱅 입력 (Stochastic Gradient Langevin Dynamics, SGLD)과 재생 버퍼(replay buffer)를 함께 사용한다. 따라서 확률 적 경사 랑주뱅 입력에서 아래의 수학식 4를 만족하는 t 번째 샘플링 단계가 도출된다. [수학식 4]"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 6, "content": "xt는 t번째 입력 이미지, xt-1은 t-1번째 입력 이미지, Eθ(xt-1)는 가중치 θ를 가지고 FCN에 의해 매개 변수화된 t-1번째 입력 이미지의 에너지 함수, α, ε은 상수이다. 에너지 기반 생성 모델은 수학식 4의 과정을 반복하여 양성 데이터로부터 다음에 사용할 음성 데이터를 생성한 다. 음성 데이터는 FCDD 모델에서 보조 이상치 데이터로서 기능한다. 그 결과, 후속 단계에서 수학식 1 및 수 학식 3의 FCDD의 학습 목표인 손실 함수를 학습할 수 있다. 즉, FCN에서 에너지 기반 생성 모델 데이터 세트를 학습 데이터로 하여 확률분포인 pθ를 산출하고, 수학식 3 및 수학식 4를 통해 에너지 기반 생성 모델 Eθ(x)를 학습시킨다. Eθ(x)가 분포 외 이상 데이터일 때는 높은 에너지를 출력하고, 분포 내 정상 데이터일 때는 낮은 에너지를 출력한다. 전술한 방법으로 수학식 4를 반복하여 음성(negative) 입력을 추출한다. 도 1 및 도 2의 단계(S40)에서는 음성 데이터와 의료 이미지 관련 데이터들 중 양성 데이터를 FCN에 입력한다. 음성 데이터와 양성 데이터는 FCN에서 분할되어 그 신뢰도를 평가하는 과정을 거친다. 전술한 수학식 1을 참조하면 각각의 Aθ는 단일 클래스 분류를 위해 설계된 점수이다. Aθ는 다중 클래스 분류에 서 분포 외 이미지 감지를 위한 점수로 설계된다. FCDD를 이용하기 위해 수학식 1의 Aθ(x)가 픽셀 수준의 구성요소로 분해되도록 설계한다. FCDD의 Aθ는 해당 픽셀 또는 수용 필드의 정상 여부를 판단하는 단일 클래스로 분류된다. 그러나 본 발명의 일 실시예에서는 Aθ를 다중 클래스 분류에 사용한다. 좀더 구체적으로, 아래의 수 학식 5를 만족하는 Aθ를 설계한다. [수학식 5]"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 7, "content": "Aθ(x)는 입력 이미지 x에서 분포 내 클래스 분류를 위해 설계된 점수, fθ(x)는 입력 이미지 x에서 픽셀별 분류 를 수행하는 FCN, i는 이미지 x의 행 번호, j는 이미지 x의 열번호이다. 다음으로, 도 1 및 도 2의 단계(S50)에서는 FCN에서 각각 음성 데이터의 특징 맵과 양성 데이터의 특징 맵을 출 력한다. 음성 데이터의 특징 맵과 양성 데이터의 특징 맵은 각각 분할의 신뢰도를 평가받아 이를 색으로 나타 내며, 도 1에서 적색으로 나타낸 부분은 높은 신뢰도를 가진다. FCN은 각 입력 이미지 X = c*h*w에 대하여 특 징 맵인 gθ(x)"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 8, "content": "h*w를 출력하도록 학습시켜 FCDD 모델을 구축한다. 도 1 및 도 2의 단계(S60)에서는 음성 데이터의 특징 맵과 양성 데이터의 특징 맵을 각각 음성 에너지 함수 및 양성 에너지 함수로 변환한다. 이는 FCN의 출력을 아래의 수학식 6과 같이 에너지 함수인 Eθ(x) 데이터로 변환 하여 출력할 수 있다. 한편, 수학식 3과 수학식 4를 통하여 Eθ(x)를 학습시킨다. 입력 이미지 x가 실제 이미지의 데이터 분포 q인 경 우 낮은 에너지를 출력하고, 입력 이미지 x가 실제 이미지의 데이터 분포가 아닌 경우에는 높은 에너지를 출력 한다. 즉, 랑주뱅 입력의 출력인 음성 데이터에서는 고에너지를 출력한다. 한편, 에너지 함수는 아래의 수학 식 6을 만족한다. 수학식 6에서 정의한 는 에너지 함수, 즉 로 정의되고, Eθ (x+) 데이터와 Eθ(x-) 데이터가 출력된다. [수학식 6]"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 9, "content": "Aθ(x)는 입력 이미지 x에서 클래스 분류를 위해 설계된 점수, fθ(x)는 입력 이미지 x에서 픽셀별 분류를 수행하 는 FCN의 특징맵, i는 이미지 x의 행 번호, j는 이미지 x의 열번호이다. Eθ(x+) 데이터와 Eθ(x-) 데이터는 후술하는 수학식 9의 변수가 된다. 즉, 후속 단계에서 Eθ(x+) 데이터와 Eθ (x-) 데이터를 변수로 하여 Lebm값을 산출한다. 다음으로, 도 1 및 도 2의 단계(S70)에서는 음성 에너지 함수 및 양성 에너지 함수로부터 손실 함수를 출력한다. 본 발명의 일 실시예에서는 이미지 수준의 분포 외 데이터 점수를 에너지 기반 생성 모델의 에너지 함수로 사용 한다. 그리고 에너지 기반 생성 모델로 분할 모델도 동시에 학습한다. 전술한 수학식 6의 에너지 기반 생성 모델 학습 목표와 각 반복 학습에서 발생하는 음성(negative) 샘플들은 각각 수학식 1의 FCDD의 손실 함수 및 보조 이상 점수 데이터 세트이다. 본 발명의 일 실시예에서는 FCN를 적용하는 fθ로 의료 영상을 분할한다. fθ의 입력은 2차원 그레이 스케일의 의료 이미지로 한다. 의료 이미지는 X = HxW이고 이미지 X는 x ∈ N(N = H x W)으로 벡터화할 수 있다. 각 학습 샘플인 X에는 y ∈{1,…,K}N와 같이 대응되는 분할 레이블이 있다. K는 대상 클래스의 수이다. 전술한 수학식 6을 최적화하기 위하여 FCN을 적용한 fθ의 분할 모델과 아래의 수학식 7을 만족하는 손실 함수를 설계한다. [수학식 7]"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 10, "content": "L은 손실함수의 전체 손실, λ1, λ2는 음수가 아닌 가중치, Lseg는 분할 손실로서 교차 엔트로피 손실과 유사하 며, Lfcdd은 FCDD 모델의 손실 함수이다. 여기서, Lfcdd는 실질적으로 Lebm과 동일하므로, 아래의 수학식 8이 도출된다. [수학식 8]"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 11, "content": "L은 손실 함수의 전체 손실, λ1, λ2는 음수가 아닌 가중치, Lseg는 분할 손실로서 교차 엔트로피 손실과 유사하 며, Lebm은 분포 내 데이터 점수를 줄이고 분포 외 데이터 점수를 높이는 에너지 기반 생성 모델에 따른 손실 함 수이다. 본 발명의 일 실시예에 따른 의료 이미지 분할 방법에서는 Lseg와 Lebm을 구한 후, 여기에 가중치를 곱해 손실 함 수를 계산한다. 수학식 8의 손실 함수에서 Lseg 와 Lebm은 상호 보완적으로 정규화되므로, 손실 함수의 신뢰도를 높일 수 있다. 그리고 분포 외 데이터 감지에서도 이점이 있다. 분할 신뢰도가 높은 경우 손실 함수의 값이 낮게 출력되고, 분할 신뢰도가 낮은 경우 반대로 높은 손실 함수 값이 출력된다. 한편, Lseg를 연산하기 위해 그라운드 트루스(Ground Truth, GT) 레이블이 도입될 수 있다. 즉, 도 1에 도시한 바와 같이, 본 발명의 일 실시예에 따른 의료 이미지 분할 학습 방법은 그라운드 트루스 (Ground Truth, GT) 레이블의 구분 레벨을 변수로서 손실 함수에 입력하는 단계를 더 포함할 수 있다. X에 대 응되는 그라운드 트루스(Ground Truth, GT) 레이블인 y의 추정치인 는 fθ(x) ∈ NxK가 입력 이미지인 x에 대 응되는 점을 통하여 fθ를 학습한다. 따라서 [i]와 관련하여 [i] = argmaxj ∈ {1,…,K}fθ(x)[i, j] 이고, i ∈{1,…, N}이다. 한편, FCN에서 출력된 양성 데이터의 특징 맵의 구분 레벨도 Lseg에 입력된다. 이 경우, Lseg는 2개의 입력값을 비교하여 엔트로피값, 즉 분할 손실 함수값을 출력한다. 한편, Lseg는 학습 반복을 통해 의 값을 감소시킨다. 양성 데이터와 음성 데이터를 각각 FCN의 fθ에 입력하면, 양성 입력은 확률 분포를 통한 예측의 출력으로 입력 이미지의 그라운드 트루스 예측 데이터를 출력한다. 그리고 출력 데이터는 양성 에너지로서 수학식 8의 Lebm 산 출에 참여한다. 이와 동시에 입력된 음성 데이터는 fθ에 입력된 후 출력되어 음성 에너지로서 수학식 8의 Lebm 를 출력한다. 추출한 Lebm 과 Lseg에 가중치를 곱한 후 서로 더해 전체 손실함수를 산출한다. 산출된 전체 손실 함수가 학습 목표가 되어 FCN을 학습시킨다. 한편, 수학식 8의 손실 함수 중 Lebm은 아래의 수학식 9로 정의된다. Lebm은 에너지 기반 생성 모델에 기반하며, 양성 에너지 특징맵과 음성 에너지 특징맵의 차를 의미한다. [수학식 9]"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 12, "content": "Lebm은 EBM의 손실함수, Eθ(x)는 가중치 θ를 가지고 심층 신경망에 의해 매개 변수화된 에너지 함수, n은 입력 데이터에 대한 배치(batch) 사이즈, i는 배치 사이즈 내의 데이터 번호, x+는 학습 데이터에서 추출된 이미지이 고, x-는 수학식 4를 반복 수행하여 출력된 고에너지의 음성 데이터이다.Lebm은 학습 데이터 분포 외 데이터에 높은 에너지값 Eθ(x) = 를 출력하도록 fθ를 학습시킨다. A θ(x)[i]는 전술한 수학식 5를 만족한다. Aθ(x)[i]값이 증가할수록 fθ(x)[[i,j] 값은 감소한다. 이 관계는 2개 의 값을 유사한 값으로 수렴시킨다. Lebm은 Eθ(x+)값을 감소시키고 Eθ(x-) 값을 증가시킨다. 이러한 관계에 따라 Lebm은 Lseg을 제한하여 FCN의 단점 인 과신뢰(over confident)를 감소시킬 수 있다. 반대로, Lseg는 Lebm을 제어할 수 있으므로 각각의 데이터가 가 지는 분할 난이도가 분포 외 데이터 검출에 영향을 준다. 일례로 수학식 9에서 각각의 x+에 대하여 각 이미지 의 엔트로피 레벨이 낮은 경우 Lseg의 값인 이 감소한다. 이 경우, 정상적인 이미지에 대한 에너지 기반 생성 모델의 값인 Eθ(x+)가 증가한다. 그 결과, Lebm은 Eθ(x-)의 값으로 Eθ(x+)를 감소시킨다. 따라서 Lseg와 Lebm의 상호 제어가 가능하다. 입력 이미지가 낮은 Eθ값을 가질수록 신뢰성이 높은 분할 성능을 가진다. 마지막으로, 도 1 및 도 2의 단계(S80)에서는 양성 데이터의 특징 맵으로부터 분할 예측 맵을 출력하여 의료 이 미지 분할을 학습한다. 여기서, 전술한 손실 함수의 손실값이 기설정치 이상인 경우, 분할 예측 맵을 재분할할 수 있다. 또한, 손실 함수의 손실값이 기설정치 미만인 경우, 분할 예측 맵의 분할을 유지할 수 있다. 수학식 9는 분포 내 데이터에서 낮은 에너지 값을 출력하도록 인공지능 모델을 학습시킨다. 그리고 분포 외 데 이터는 높은 값을 출력하도록 모델을 학습시킨다. 본 발명의 일 실시예에 따른 의료 이미지 분할 학습 방법에 따라 Eθ의 학습이 진행되면 손실 함수의 값은 작아진다. 즉, x-가 양성 데이터와 유사한 데이터로 변하면서 FCDD 모델에서 보조 이상치 데이터와 동일한 역할을 수행한다. 즉, 양성 데이터의 잡음 데이터 역할 및 분포 외 데이터의 역할을 수행할 수 있다. 의료 이미지 분할 방법 이하에서는 도 3 및 도 4를 통하여 본 발명의 일 실시예에 따른 의료 이미지 분할 방법을 개략적으로 설명한다. 도 3은 본 발명의 일 실시예에 따른 의료 이미지 분할 방법의 개념을 개략적으로 나타낸다. 도 4는 도 3의 의 료 이미지 분할 방법의 순서도를 개략적으로 나타낸다. 도 4의 각 단계는 도 3의 각 단계와 동일하다. 도 3 및 도 4에 도시한 바와 같이, 본 발명의 일 실시예에 따른 의료 이미지 분할 학습 방법은, 의료 이미지 데 이터를 학습된 FCDD에 입력하는 단계(S12), 의료 이미지 데이터의 특징 맵을 출력하는 단계(S22), 특징 맵을 에 너지 함수로 변환하는 단계(S32), 분포 외 점수를 출력하는 단계(S42), 그리고 에너지 함수로부터 분할 예측 맵 을 출력하는 단계(S52)를 포함한다. 이외에, 본 발명의 일 실시예에 따른 의료 이미지 분할 학습 방법은 다른 단계들을 더 포함할 수 있다. 먼저, 도 3 및 도 4의 단계(S12)에서는 의료 이미지 데이터를 학습된 FCDD에 입력한다. 학습된 FCDD를 이용하 여 후속 단계에서 합리적인 이미지 수준 점수를 출력할 수 있다. 다음으로, 도 3 및 도 4의 단계(S22)에서는 의료 이미지 데이터의 특징 맵을 출력한다. 특징 맵의 출력 과정은 전술한 의료 이미지 분할 학습 방법과 동일하다. 도 3 및 도 4의 단계(S32)에서는 특징 맵을 에너지 함수로 변환한다. 학습된 FCDD를 이용하여 분포 외 데이터 의 점수를 분포 내 데이터의 점수보다 높게 만들어 의료 이미지에서 관심 영역을 좀더 정확하게 분할할 수 있다. 이를 위해 이상 점수 데이터 외에 보조 이상 점수 데이터를 사용한다. FCDD는 에너지 함수를 이용해 후 속 단계에서 이미지 수준의 이상 점수 학습 데이터에 대한 분할 특징 맵과 이미지 분포에 대한 학습 데이터를 출력할 수 있다. 도 3 및 도 4의 단계(S42)에서는 분포 외(OOD) 점수를 출력한다. 즉, 이미지 수준 분포 외 이미지의 점수가 계 산된다. 분할 수준의 점수로 FCDD 모델의 분포 외 데이터 감지 성능을 보조한다. 분할 수준 점수는 배경 픽셀 이 분포 외 데이터에 주는 영향을 감소시키고, 분할에 대한 픽셀 수준 불확실성을 정규화한다. 정규화를 통하 여 각 배경 분할의 불확실성을 예측한다. 분할 수준의 예측 불확실성 정도는 아래의 수학식 10에 따라 점수로 표시된다.[수학식 10]"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 13, "content": "는 분할 수준 예측 불확실성 점수, x는 입력, Ω은 입력 x의 배경 분할 예측의 픽셀 인덱스로서 Ω ⊂ {1, …, N}이고, i는 Ω의 픽셀 인덱스 중 하나, Hθ,I(x)는 거리 장면 분할(street-scene segmentation, Rottmann and Schubert 2019)에서 제안한 배경 분할 점수이다. 한편, 입력된 각각의 의료 이미지 데이터 x는 아래의 수학식 11에서 이미지 수준 점수로 평가된다. 즉, 이미지 레벨의 분포 외 이미지 점수인 Seng가 출력된다. [수학식 11]"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 14, "content": "는 입력 x에 대한 이미지 수준 점수, x는 입력, Ω은 입력 x의 배경 분할 예측의 픽셀 인덱스, i는 Ω의 픽 셀 인덱스 중 하나임 이미지 수준 점수인 의 픽셀 수준 점수는 수학식 5의 Aθ(x)[i]가 될 수 있다. 수학식 5와 음성 엔트로피의 볼록 공액(convex conjugate) 관계에 기초해 Hθ,i(x)는 아래의 수학식 12를 만족한다. [수학식 12] Hθ,i(x) = - Aθ(x)[i] - fθ(x)[i,;]T Pθ(x)[i,;] Hθ,i(x)는 거리 장면 분할(street-scene segmentation)에서 도출한 배경 분할 점수, Aθ(x)[i]는 입력 이미지 x 에서 클래스 분류를 위해 설계된 I 행의 점수, fθ(x)[i,;]T는 입력 이미지 x에서 픽셀별 분류를 수행하는 FCN의 i번째 행에서의 전치행렬(Transpose), Pθ(x)[i,;]는 에너지 기반 생성 모델로 훈련 FCDD의 출력이다. 에너지 기반 생성 모델로 훈련된 분포의 조건부 확률맵인 Pθ(x)는 fθ(x)로 나타낸다. 2차원 이미지들을 벡터화 한 NxK는 Pθ(x)를 포함한다. 따라서 Pθ(x)는 fθ(x)를 이용하여 Pθ(x)[i, :] = SoftMax(fθ(x) )[i, :])로 표 현할 수 있다. 수학식 12에서 Aθ(x)[i], fθ(x)[i,;]T 및 Pθ(x)[i,;]는 f가 입력 x에 대하여 높은 신뢰도를 형성하면 큰 값을 가진다. Hθ,i(x)값은 - Aθ(x)[i]값에 따라 편향될 수 있다. 그러나 각 입력 x에 대한 평가와 각 입력에 해당 하는 설명맵인 Aθ(x)를 통해 각 픽셀의 기여도에 대해 좀 더 정확하게 설명할 수 있다. 정규화 효과는 아래의 수학식 13을 통해 확인할 수 있다. [수학식 13]"}
{"patent_id": "10-2022-0077820", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 15, "content": "Eθ(x)는 가중치 θ를 가지고 FCDD에 의해 매개 변수화된 에너지 함수, Hθ,i(x)는 거리 장면 분할에서 제안한 배 경 분할 점수, fθ(x)[i,;]T는 입력 이미지 x에서 픽셀별 분류를 수행하는 FCDD의 i번째 행에서의 전치행렬 (Transpose), Pθ(x)[i,;]는 에너지 기반 생성 모델로 훈련된 분포이다. 도 3 및 도 4의 단계(S52)에서는 에너지 함수로부터 분할 예측 맵을 출력한다. 단계(S52)는 단계(S42)와 동시 에 진행할 수 있다. 즉, 단계(S42)에서 이미지 점수를 계산시, 단계(S52)에서 각 픽셀의 기여도를 나타내는 각샘플에 대한 설명 맵을 함께 제공한다. 이에 따라 분할 예측 맵이 출력된다. FCDD 모델은 FCN에서 이상을 감 지한 후 이상이 감지된 이미지를 시각화해 의료 영상을 효율적으로 분할한다. 손실 함수의 값을 통해 분할 예 측 맵의 분할 성능을 판단할 수 있다. 분할 성능이 좋은 경우, 총 손실 함수의 값은 작다. 이와 반대로, 분할 성능이 좋지 않은 경우, 총 손실 함수의 값은 크다. 도 5는 도 2의 의료 이미지 분할 학습 방법을 구현하기 위한 의료 이미지 분할 학습 시스템의 블록도를 개 략적으로 나타낸다. 도 5의 의료 이미지 분할 학습 시스템은 단지 본 발명을 예시하기 위한 것이며, 본 발명이 여기에 한정되는 것은 아니다. 따라서 의료 이미지 분할 학습 시스템을 다르게 변형할 수 있다. 또한, 도 5의 의료 이미지 분할 학습 시스템은 전술한 도 2의 의료 이미지 분할 학습 방법을 도 5의 각 구 성요소에서 구현하기 위한 것이며, 그 구현 형태는 전술한 내용과 동일하므로, 수학식을 포함한 그 상세한 설명 은 생략한다. 도 5에 도시한 바와 같이, 의료 이미지 분할 학습 시스템은 학습용 데이터 수집부, 학습용 데이터 전 처리부, 모델 학습부 및 학습용 데이터 후처리부를 포함한다. 이외에, 의료 이미지 분할 학습 시 스템은 필요에 따라 다른 구성요소들을 더 포함할 수 있다. 학습용 데이터 수집부는 정상 이미지를 수집한다. 정상 이미지인 양성 데이터는 모델 학습부에 제공된 다. 또한, 학습용 데이터 수집부는 양성 데이터를 학습용 데이터 전처리부에 제공한다. 학습용 데이 터 전처리부는 이를 그라운드 트루스 레이블로 가공한다. 한편, 모델 학습부는 양성 데이터를 양성 데 이터의 특징 맵으로 출력하고, 양성 데이터의 특징 맵은 학습용 데이터 후처리부에서 양성 에너지 함수로 변환된다. 양성 데이터들 중 초기 양성 데이터는 모델 학습부를 통해 초기 양성 데이터의 특징 맵으로 출 력되어 학습용 데이터 후처리부에서 초기 에너지 함수로 변환된다. 초기 에너지 함수는 학습용 데이터 전 처리부에 포함된 LD(랑주뱅 함수)에 입력되어 음성 데이터로 출력된다. 이 음성 데이터는 양성 데이 터와 함께 모델 학습부에 입력되어 각각 음성 데이터 특징 맵과 양성 데이터 특징 맵으로 출력된 후 학습용 데이터 후처리부로 전송된다. 학습용 데이터 후처리부는 음성 데이터 특징 맵과 양성 데이터 특징 맵을 각각 음성 에너지 함수 및 양성 에너지 함수로 변환한다. 그리고 음성 에너지 함수 및 양성 에너지 함수로부터 손실 함수를 출력한다. 그리고 학습용 데이터 후처리부는 양성 데이터 특징 맵으로부터 분할 예측 맵을 출력하여 모델 학습부에 의료 이미지 분할을 학습시킨다. 그라운드 트루스 레이블은 학습용 데이터 전처리부로부터 학습용 데이터 후처 리부에 손실 함수의 연산을 위해 제공된다. 한편, 모델 학습부는 지속적인 학습을 통해 최종적으로 FCDD 모델 유닛을 생성한다. 도 6은 도 4의 의료 이미지 분할 방법을 구현하기 위한 의료 이미지 분할 시스템의 블록도를 개략적으로 나타낸다. 도 6의 의료 이미지 분할 시스템은 단지 본 발명을 예시하기 위한 것이며, 본 발명이 여기에 한정되는 것은 아니다. 따라서 의료 이미지 분할 시스템을 다르게 변형할 수 있다. 또한, 도 6의 의료 이미지 분할 시스템은 전술한 도 4의 의료 이미지 분할 방법을 도 6의 각 구성요소에서 구현하기 위한 것 이며, 그 구현 형태는 전술한 내용과 동일하므로, 수학식을 포함한 그 상세한 설명은 생략한다. 도 6에 도시한 바와 같이, 의료 이미지 분할 시스템은 데이터 입력부, FCDD 모델부 및 데이터 처 리부를 포함한다. 이외에, 필요에 따라 의료 이미지 분할 시스템은 다른 구성요소들을 더 포함할 수 있다. 데이터 입력부는 의료 이미지 데이터를 FCDD 모델부에 입력한다. FCDD 모델부는 제공받은 의료 이 미지 데이터를 변환해 데이터 특징 맵을 출력해 데이터 처리부에 제공한다. 데이터 처리부는 데이터 특징 맵을 에너지 함수로 변환한다. 그리고 데이터 처리부는 수학식 10을 이용해 에너지 함수로부터 분포 외 점수를 출력한다. 의료 이미지가 잘 분할되지 않은 경우 분포 외 점수가 높다. 이와 반대로, 의료 이미지 의 분할이 잘 된 경우, 분포 외 점수가 낮다. 따라서 분포 외 점수를 통해 의료 이미지의 분할 결과를 판단할 수 있다. 이와 같이, 분포 외 점수의 출력에 의해 의료 이미지 수준 점수로의 평가가 가능하다. 한편, 데이터 처리부는 분할 예측 맵을 출력한다. 그 결과, 이상이 감지된 이미지를 시각화해 의료 영상을 신뢰도가 높은 구간으로 효율적으로 분할할 수 있다. 이하에서는 실험예를 통하여 본 발명을 상세하게 설명한다. 이러한 실험예는 단지 본 발명을 예시하기 위한 것 이며, 본 발명이 여기에 한정되는 것은 아니다. 좀더 구체적으로, 이하의 실험예는 심장과 전립선을 그 대상으 로 하였지만, 이는 예시에 불과하며 다른 부위에도 본 발명을 응용할 수 있다.실험예 의료 영상 데이터의 특성을 고려하여 영상 데이터를 의료 이미지 영역에 대응해 분류하였다. 영상 데이터들은 i) 대상 작업과 관련 없는 이미지, ii) 확인되지 않는 조건을 가진 이미지, 및 iii) 픽셀 오류가 있는 이미지로 분류할 수 있었다. 본 발명의 실험예에서는 전술한 ii) 확인되지 않는 조건을 가진 이미지 및 iii) 픽셀 오류 가 있는 이미지에서 분포 외 이미지를 구분하였다. 이들 경우에 대해 2가지 단계로 나누어진 방법으로 분포 외 데이터를 검출하였다. 여기서 각 단계를 제1 클래스 및 제2 클래스라고 한다. 실험을 통해 제1 클래스 및 제2 클래스를 검증하였다. 제1 클래스로서 특징 맵의 정량적 분석 및 정성적 시각 화를 위한 분포 외 데이터 샘플로 데이터 세트 또는 외부 데이터의 특정 하위 그룹을 사용하였다. 제2 클래스 로서 분포 이동 데이터에 대한 분포 외 데이터 검출을 위해 합성 이상값을 사용하였다. 먼저, 제1 클래스와 제2 클래스에서 동일하게 아래 실험 파라미터들을 조절하였다. 클래스 분할은 이진 클래스 분할로 하였다. 그리고 심장 이미지 데이터 분할을 위해 ACDC 및 M&Ms 챌린지 데이터 세트를 사용하였다. 전 립선 분할에는 PROSTATEx 데이터 세트를 사용하였다. 모든 데이터 세트는 복수의 MR 이미지들과 이에 해당하는 세분화 마스크로 구성되었다. FCN fθ는 R2U-NET 아키텍쳐를 사용하여 에너지 기반 생성 모델을 프레임 워크로 하였다. 그리고 종래 기술로서 동일한 아키텍처의 FCN fθ에 심층 앙상블 기법을 추가적으로 사용한 경우와 동일한 아키텍처의 FCN fθ에 마코프 체인 드롭아웃(Markov Chain Drop Out, MCDO)을 추가적으로 사용한 경우를 비교하였다. 수학식 9와 수학식 10의 와 점수에 각각 임계값을 적용하여 종래 기술과 본 발명의 실험예를 비교하였 다. 그리고 는 전경분할 예측 데이터 점수에 영향을 주므로, 모든 i에 대하며 Pθ(x)[I,2] < 0.5인 경우 를 -1로 하였다. 제1 클래스 실험은 전술한 이미지 중 확인되지 않는 조건이 있는 이미지에 대한 예측 실험이다. 1개의 정상군 과 4개의 질병군을 포함하는 ACDC 데이터 셋을 이용하였다. 그리고 특정 질병군을 분포 외 데이터로 지정하여 실험하였다. 의료 영상의 촬영 장소에 따라 영상 데이터의 특징은 상이하였다. 따라서 5개 임상 센터의 영상 데이터 세트를 포함하는 M&Ms 데이터 세트를 사용하였다. 3개의 임상 센터 데이터 세트를 분포 내 데이터 세트로 하고, 2개의 임상 센터 데이터 세트는 분포 외 데이터 세트로 사용하였다. 의료 단면 영상을 시점이 다른 평면에서 획득하 는 경우 분할이 어려워 PROSTATEx 데이터 세트에서 실험하였다. 시상면의 슬라이스를 분포 외 데이터로 하고, 학습 데이터 셋과 분할 레이블을 사용하였다. 아래의 표 1은 전술한 실험 조건들을 적용한 실험 결과를 나타낸다. 표 1 학습된 데이터 세트 ACDC M&Ms PROSTATEx 분포 외 데이터 종류Disease M&Ms Vendor ACDC Sagittal MCDO 0.181 0.429 0.203 0.016 0.880 EN (딥 앙상블) 0.200 0.506 0.197 0.022 0.937 EBM 0.836 0.959 0.627 0.432 1.000 표 1에 기재한 바와 같이, 각 숫자들은 분포 외 데이터 점수이고 순서대로 종래 기술인 마코프 체인 드롭 아웃 (MCDO), 딥 앙상블(EN) 및 본 발명의 실험예에 따른 에너지 기반 생성 모델(EBM)을 나타낸다. 종래 기술은 수 학식 10의 픽셀 수준 검출에서 점수이었고, 본 발명의 실험예에서는 이미지 수준 검출의 점수였다. 각 점수는 0 내지 1 사이에서 정규화된 값을 가졌다. 각 데이터 세트에서 본 발명의 실험예에서의 분포 외 데 이터 검출 수준은 종래 기술의 분포 외 데이터 검출 수준에 비해 현저히 높았다. 픽셀 수준 불확실성 점수를 기반으로 하는 종래 기술인 마코프 체인 드롭아웃 및 딥 앙상블 방식보다는 이미지 수준 점수를 이용하는 에너지 기반 생성 모델의 성능이 우수한 것을 알 수 있었다. 도 7은 각각 ACDC (Automated Cardiac Diagnosis Challenge, 자동 심장 진단 시험) 데이터 세트와 PROSTATEx (전립선) 데이터 세트에 대한 분포 내(In-distribution) 및 분포 외 샘플의 에너지 검출을 예시한 사진들을 나 타낸다. 분포 외 샘플로서 ACDC 데이터 세트는 질병 그룹 데이터 세트를 이용하였고, 전립선 데이터 세트는 시상면(sagittal plane)의 슬라이스 데이터 세트를 이용하였다. 도 7에 도시한 바와 같이, 배경 분할과 분포 내 데이터의 경계가 강조 표시되었다. PROSTATEx 데이터 세트의 시상면 이미지는 분포 샘플에서 크게 벗어나므로 해당 맵은 강조 표시된 영역이 넓게 나타났다. 또한, ACDC 데 이터 세트의 확인되지 않는 질병에 대한 분포 외 데이터는 맵의 특징이 되는 배경 분할에서 두꺼운 벽 부분이 강조되었다. 제2 클래스는 의료 이미지를 전처리 하는 과정에서 이미지의 왜곡이 발생할 때의 성능이다. 본 발명의 실험예에 서는 발생할 수 있는 노이즈를 인위적으로 재연하고, 이미지의 방향, 복셀 간격 및 대비를 조정하여 분포 외 데 이터 세트를 생성하였다. 노이즈 재연을 위해 가우시안 노이즈(NOI), 가우시안 블러(GBR) 및 모션 블러(MBR)을 적용하였다. 이미지의 방향, 복셀 간격 및 대비는 테스트 데이터의 회전(ROT), 리샘플링(RES) 및 히스토그램 균등화(HEQ)를 적용하였다. 표 2는 전술한 실험 조건을 적용하여 분포 외 데이터를 검출한 실험 결과를 나타낸다. 표 2 ACDC 데이터 셋으로 학습 입력 OOD NOI GBR MBR ROT RES HEQ MCDO 0.072 0.060 0.082 0.174 0.025 0.039 EN 0.137 0.076 0.117 0.195 0.041 0.064 EBM 0.801 0.658 0.697 0.900 0.912 0.957 PROSTATEx 데이터 셋으로 학습 입력 OOD NOI GBR MBR ROT RES HEQ MCDO 0.112 0.177 0.258 0.472 0.207 0.427 EN 0.180 0.374 0.472 0.725 0.287 0.562 EBM 1.000 0.955 0.978 1.000 1.000 1.000 표 2에서 각 수치들은 분포 외 데이터 점수이고, 순서대로 종래 기술인 마코프 체인 드롭아웃(MCDO), 딥 앙상블 (EM) 및 본 발명의 실험예에 따른 에너지 기반 생성 모델(EBM)을 나타낸다. 종래 기술은 수학식 10의 픽셀 수 준 검출의 점수이고, 본 발명의 일 실시예는 이미지 수준 검출의 점수이다. 각 점수는 0 내지 1까지 범위의 정규화된 값을 가졌다. 각 데이터 셋에서 본 발명의 실험예에 따른 분포 외 데 이터 검출 수준이 종래 기술에 비하여 현저히 높았다. 픽셀 수준 불확실성 점수를 기반으로 하는 종래 기술인 MCDO 및 EM에 비해 이미지 수준 점수를 이용하는 에너지 기반 생성 모델의 성능이 우수하였다. 각각의 분포 외 데이터 검출 모델의 기본 구조인 FCN의 신뢰도 보정 성능을 평가하였다. FCN의 보정 성능 평가 는 전체 픽셀 단위 분류기의 보정 메트릭을 측정한 후 평균을 계산하는 방법으로 수행되었다. 의료 영상은 배 경 픽셀과 전경 픽셀의 수가 균일하지 않으므로, 이를 분할하기 위해 아래와 같은 방법을 사용하였다. 먼저 분포 외 데이터로 판단된 부위를 바운딩 박스(Bounding Box)로 둘러쌌다. 그리고 바운딩 박스의 경계를 데 이터의 이미지에 따라 5mm 확장하였다. 확장의 일례로, 심장 데이터는 4픽셀을 확장하였고, 전립선 데이터는 5 픽셀을 확장하였다. 이러한 확장은 관심영역(Region of Interest)를 줄이는 효과가 있었다. 표 3은 전술한 방법에 따른 예상 보정 오차(ECE)와 최대 보정오차(MCE)를 비교하여 나타낸다. 즉, 베이스라인 FCN, 베이스라인 FCN와 온도 스케일링의 동시 사용, 그리고 본 발명의 실험예에 따른 에너지 기반 생성 모델 각 각의 예상 보정 오차(ECE)와 최대 보정오차(MCE)를 비교해 나타낸다.표 3 Model ACDC PROSTATEx ECE MCE ECE MCE Baseline FCN 0.049 0.238 0.087 0.305 Baseline FCN + Temperature scaling 0.033 0.147 0.071 0.233 EBM 0.036 0.133 0.070 0.165 표 3에 기재한 바와 같이, 본 발명의 실험예에 따른 에너지 기반 생성 모델의 오차 성능이 가장 우수한 것을 알 수 있었다. 즉, ACDC의 예상 보정 오차(ECE)를 제외하고는 나머지 항목에서 예상 보정 오차(ECE)와 최대 보정 오차(MCE)가 가장 작게 나타났다.도 8은 본 발명의 실험예에 따른 ACDC 데이터 세트와 PROSTATEx 데이터 세트에 서 각각 높은 점수의 샘플과 낮은 점수의 샘플의 예시 사진들을 나타낸다. 이들 샘플들은 테스트 세트에서 추 출되었다. 도 8의 상단 행은 최고점을 가진 테스트 샘플이고, 하단 행은 최저점을 가진 테스트 샘플이다. 최 저점을 가지는 샘플들은 엣지 슬라이스이거나 불규칙한 이미지 모양이 포함된 이미지였다. 도 8의 고득점 샘플 및 저득점 샘플은 모두 (x)로 계산되었다. 도 8에 도시한 바와 같이, 3차원 의료 이미지의 에지 슬라이스(edge slice)의 모양은 균일하지 않았고, 인공물 이 포함된 경우도 존재하였다. 본 발명의 실험예에 따른 분포 외 데이터 검출 방법은 입력 이미지의 분할이 어 려운 경우, 본 발명의 실험예의 모델에 따라 낮은 Seng(x) 점수를 출력하였다. 따라서 본 발명의 실험예 따른 방법은 분포 외 데이터뿐만 아니라 3차원 의료 영상의 에지 슬라이스에서 도출되는 특이점도 확인되었다. 각각의 2차원 의료 이미지는 슬라이스 넘버에 따라 sn(x)로 대응되었다. 또한, 각각의 데이터 세트에 대해 슬 라이스 번호에 따른 테스트 데이터를 오름차순으로 정렬하고 테스트 세트를 동일한 이미지 크기를 가진 5개의 하부 그룹으로 구분하였다. 각 그룹은 으로 지칭하였다. 표 4는 ACDC 데이터 세트 및 PROSTATEx 데이터 세트의 각 그룹에 대한 의 평균값을 나타낸다. 표 4의 하단 에서 가장자리의 엣지 슬라이스를 포함하는 는 다른 그룹에 비해 현저히 낮은 점수를 나타내었다. 표 4 Dataset ACDC 5169 5180 5156 5102 4945 PROSTATEx 6832 6809 6752 6514 6409 표 5는 표 4의 점수와 주사위 계수(Dice Coefficient)의 관계를 나타낸다. 표 5에는 점수를 내림 차 순으로 정렬한 후 동일한 크기를 가진 5개의 그룹으로 분할한 결과를 나타내었다. 각 그룹은 으로 지칭하였 다. 표 5로부터 점수가 낮은 경우, 데이터 분할 결과가 더 나쁘다는 것을 확인할 수 있었다. 표 5 Dataset ACDC 0.923 0.898 0.881 0.877 0.821 PROSTATEx 0.890 0.907 0.887 0.869 0.779 도 9는 위로부터 아래로 각각 테스트 샘플, 본 발명의 실험예에 따라 설명 가능한 맵, 그리고 제2 클래스 분포 외 데이터 탐지 실험을 기반으로 한 바닐라 EBM의 사진들을 예시로 각각 나타낸다. 도 9는 원본(Original), 원본의 회전(ROT), 원본의 리샘플링(RES) 및 원본의 히스토그램 균등화(HEQ) 이미지를 나타내었다. 이들 이미지 들은 각 설명 맵 Aθ에 대해 i ∈ {1,…,N}인 Aθ(i)를 그레이 스케일로 시각화하여 나타내었다. 표 6은 도 9의 이미지에서 바닐라 에너지 기반 생성 모델과 본 발명의 실험예에 따른 통합 모델의 분포 외 데이 터 검출 결과를 비교하여 나타낸다. 표 6에 기재한 바와 같이, 2차원 그레이 스케일 의료 이미지에 다양한 변 형이나 노이즈를 탐지하는 성능이 우수한 것을 확인할 수 있었다. 표 6 Dataset ACDC OOD 종류 NOI GBR MBR ROT RES HEQ Vanilla EBM 0.203 0.121 0.108 0.428 0.337 0.691 통합 모델 0.801 0.658 0.697 0.900 0.912 0.957 이상에서 본 개시의 실시예에 대하여 상세하게 설명하였지만 본 개시의 권리범위는 이에 한정되는 것은 아니고 다음의 청구범위에서 정의하고 있는 본 개시의 기본 개념을 이용한 당업자의 여러 변형 및 개량 형태 또한 본 개시의 권리범위에 속하는 것이다."}
{"patent_id": "10-2022-0077820", "section": "도면", "subsection": "도면설명", "item": 1, "content": "도 1은 본 발명의 일 실시예에 따른 의료 이미지 분할 학습 방법의 개략적인 개념도이다. 도 2는 도 1의 의료 이미지 분할 학습 방법의 개략적인 순서도이다. 도 3은 본 발명의 일 실시예에 따른 의료 이미지 분할 방법의 개략적인 개념도이다. 도 4는 도 3의 의료 이미지 분할 방법의 개략적인 순서도이다. 도 5는 도 2의 의료 이미지 분할 학습 방법을 구현하기 위한 의료 이미지 분할 학습 시스템의 개략적인 블록도이다. 도 6은 도 4의 의료 이미지 분할 방법을 구현하기 위한 의료 이미지 분할 시스템의 개략적인 블록도이다. 도 7은 본 발명의 실험예에 따른 ACDC 데이터 세트와 PROSTATEx 데이터 세트에 대한 분포 내 및 분포 외 샘플의 에너지 검출의 예시 사진들이다. 도 8은 본 발명의 실험예에 따른 ACDC 데이터 세트와 PROSTATEx 데이터 세트에서 각각 높은 점수의 샘플과 낮은 점수의 샘플의 예시 사진들이다. 도 9는 테스트 샘플, 본 발명의 실험예에 따라 설명 가능한 맵, 그리고 제2 클래스 분포 외 데이터 탐지 실험을 기반으로 한 바닐라 EBM의 예시 사진들이다."}
