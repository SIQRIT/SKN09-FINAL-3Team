{"patent_id": "10-2022-0135479", "section": "특허_기본정보", "subsection": "특허정보", "content": {"공개번호": "10-2024-0055328", "출원번호": "10-2022-0135479", "발명의 명칭": "피사계 심도 확장을 위한 이진위상필터 설계 및 영상 복원 방법 및 이를 수행하는 전자장치", "출원인": "연세대학교 산학협력단", "발명자": "주철민"}}
{"patent_id": "10-2022-0135479", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_1", "content": "전자장치에 의해 수행되는 피사계 심도(field of depth) 확장을 위한 이진위상필터(Binary Phase Filter) 설계및 영상 복원 방법에 있어서,이진위상필터에 설정된 이진위상구조에 기초하여 테스트 영상에 대해 깊이별 영상을 획득하는 단계;입력되는 영상을 복원하도록 학습된 모델에 기초하여 상기 깊이별 영상을 복원한 깊이별 복원 영상을 획득하는단계;상기 깊이별 복원 영상과 상기 테스트 영상을 비교하여 상기 깊이별 복원 영상의 손실값을 계산하는 단계;상기 손실값이 기 정의된 값 이하가 될 때까지 상기 이진위상구조를 업데이트하는 단계를 포함하는 방법."}
{"patent_id": "10-2022-0135479", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_2", "content": "제1항에 있어서,상기 손실값이 기 정의된 값 이하인 경우, 해당 이진위상구조를 가지는 이진위상필터를 목표 이진위상필터로 선정하는 단계를 더 포함하는 방법."}
{"patent_id": "10-2022-0135479", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_3", "content": "제1항에 있어서,상기 깊이별 영상을 획득하는 단계는,목표 피사계 심도 구간 내 깊이별 점확산함수(Point Spread Function)와 상기 테스트 영상의 합성곱 연산에 의해 상기 깊이별 영상 획득하는 단계를 포함하는 방법."}
{"patent_id": "10-2022-0135479", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_4", "content": "제3항에 있어서,상기 깊이별 영상을 획득하는 단계는,상기 이진위상구조의 위상값에 따라 상기 깊이별 점확산함수를 식별하는 단계를 포함하는 방법."}
{"patent_id": "10-2022-0135479", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_5", "content": "제1항에 있어서,상기 이진위상구조를 업데이트하는 단계는,이진위상구조의 위상값에 따라 극값을 가지는 페널티 함수(penalty function)를 적용하여 상기 이진위상구조를업데이트하는 단계를 포함하는 방법."}
{"patent_id": "10-2022-0135479", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_6", "content": "제1항에 있어서,상기 손실값을 계산하는 단계는,상기 깊이별 복원 영상 각각에 대해 계산한 손실값의 평균값을 계산하는 단계를 포함하는 방법."}
{"patent_id": "10-2022-0135479", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_7", "content": "피사계 심도(field of depth) 확장을 위한 이진위상필터(Binary Phase Filter) 설계 및 영상 복원을 수행하는공개특허 10-2024-0055328-3-전자장치에 있어서,이진위상필터에 설정된 이진위상구조에 기초하여 테스트 영상에 대해 깊이별 영상을 획득하고,입력되는 영상을 복원하도록 학습된 모델에 기초하여 상기 깊이별 영상을 복원한 깊이별 복원 영상을 획득하고,상기 깊이별 복원 영상과 상기 테스트 영상을 비교하여 상기 깊이별 복원 영상의 손실값을 계산하고,상기 손실값이 기 정의된 값 이하가 될 때까지 상기 이진위상구조를 업데이트하는 프로세서를 포함하는 전자장치."}
{"patent_id": "10-2022-0135479", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_8", "content": "제7항에 있어서,상기 프로세서는,상기 손실값이 기 정의된 값 이하인 경우, 해당 이진위상구조를 가지는 이진위상필터를 목표 이진위상필터로 선정하는 전자장치."}
{"patent_id": "10-2022-0135479", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_9", "content": "제7항에 있어서,상기 프로세서는,목표 피사계 심도 구간 내 깊이별 점확산함수(Point Spread Function)와 상기 테스트 영상의 합성곱 연산에 의해 상기 깊이별 영상 획득하는 전자장치."}
{"patent_id": "10-2022-0135479", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_10", "content": "제9항에 있어서,상기 프로세서는,상기 이진위상구조의 위상값에 따라 상기 깊이별 점확산함수를 식별하는 전자장치."}
{"patent_id": "10-2022-0135479", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_11", "content": "제7항에 있어서,상기 프로세서는,이진위상구조의 위상값에 따라 극값을 가지는 페널티 함수(penalty function)를 적용하여 상기 이진위상구조를업데이트하는 전자장치."}
{"patent_id": "10-2022-0135479", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_12", "content": "제7항에 있어서,상기 프로세서는,상기 깊이별 복원 영상 각각에 대해 계산한 손실값의 평균값을 계산하는 전자장치."}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "요약", "paragraph": 1, "content": "본 발명의 일 실시예에 따른 전자장치에 의해 수행되는 피사계 심도(field of depth) 확장을 위한 이진위상필터 (Binary Phase Filter) 설계 및 영상 복원 방법에 있어서, 이진위상필터에 설정된 이진위상구조에 기초하여 테스 트 영상에 대해 깊이별 영상을 획득하는 단계; 입력되는 영상을 복원하도록 학습된 모델에 기초하여 상기 깊이별 영상을 복원한 깊이별 복원 영상을 획득하는 단계; 상기 깊이별 복원 영상과 상기 테스트 영상을 비교하여 상기 깊이별 복원 영상의 손실값을 계산하는 단계; 상기 손실값이 기 정의된 값 이하가 될 때까지 상기 이진위상구조 를 업데이트하는 단계를 포함한다."}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "기술분야", "paragraph": 1, "content": "본 발명은 피사계 심도 확장을 위한 이진위상필터 설계 및 영상 복원 방법 및 이를 수행하는 전자장치에 관한 것이다."}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "배경기술", "paragraph": 1, "content": "검사장비, 현미경 등을 포함하는 영상 장치는 해상도(분해능)와 그 해상도를 깊이방향으로 유지할 수 있는 피사 계 심도(Field of depth) 사이에 트레이드 오프(trade-off) 관계를 가지고 있다. 즉, 높은 해상도를 가지는 장치는 필연적으로 짧은 심도를 가지고, 긴 심도를 보장하는 장치는 낮은 해상도를 가진다. 이는 피사계 심도는 렌즈의 개구수 혹은 조리개 값에 반비례하고, 분해능은 렌즈의 개구수에 비례하기 때문이다. 따라서, 피사계 심도를 확장하면서도 피사계 심도 및 해상도 간의 트레이드 오프 관계를 극복할 수 있는 개선된 솔루션이 필요한 실정이다."}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "해결하려는과제", "paragraph": 1, "content": "본 발명의 목적은 심도와 분해능 간의 트레이드 오프를 보다 효과적으로 극복하여 깊이 측정 범위를 확장하는 이진위상필터의 설계 방법을 제공하는 것이다. 본 발명의 목적은 본 발명에 따라 설계된 이진위상필터로부터 획득한 영상을 최적으로 복원하는 영상 복원 방법 을 제공하는 것이다."}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 1, "content": "본 발명의 일 실시예에 따른 전자장치에 의해 수행되는 피사계 심도(field of depth) 확장을 위한 이진위상필터 (Binary Phase Filter) 설계 및 영상 복원 방법에 있어서, 이진위상필터에 설정된 이진위상구조에 기초하여 테 스트 영상에 대해 깊이별 영상을 획득하는 단계; 입력되는 영상을 복원하도록 학습된 모델에 기초하여 상기 깊 이별 영상을 복원한 깊이별 복원 영상을 획득하는 단계; 상기 깊이별 복원 영상과 상기 테스트 영상을 비교하여 상기 깊이별 복원 영상의 손실값을 계산하는 단계; 상기 손실값이 기 정의된 값 이하가 될 때까지 상기 이진위 상구조를 업데이트하는 단계를 포함한다. 상기 방법은, 상기 손실값이 기 정의된 값 이하인 경우, 해당 이진위상구조를 가지는 이진위상필터를 목표 이진 위상필터로 선정하는 단계를 더 포함할 수 있다. 상기 깊이별 영상을 획득하는 단계는, 목표 피사계 심도 구간 내 깊이별 점확산함수(Point Spread Function)와 상기 테스트 영상의 합성곱 연산에 의해 상기 깊이별 영상 획득하는 단계를 포함할 수 있다. 상기 깊이별 영상을 획득하는 단계는, 상기 이진위상구조의 위상값에 따라 상기 깊이별 점확산함수를 식별하는 단계를 포함할 수 있다. 상기 이진위상구조를 업데이트하는 단계는, 이진위상구조의 위상값에 따라 극값을 가지는 페널티 함수(penalty function)를 적용하여 상기 이진위상구조를 업데이트하는 단계를 포함할 수 있다. 상기 손실값을 계산하는 단계는, 상기 깊이별 복원 영상 각각에 대해 계산한 손실값의 평균값을 계산하는 단계 를 포함할 수 있다. 본 발명의 일 실시예에 따르면, 피사계 심도(field of depth) 확장을 위한 이진위상필터(Binary Phase Filter) 설계 및 영상 복원을 수행하는 전자장치에 있어서, 이진위상필터에 설정된 이진위상구조에 기초하여 테스트 영 상에 대해 깊이별 영상을 획득하고, 입력되는 영상을 복원하도록 학습된 모델에 기초하여 상기 깊이별 영상을 복원한 깊이별 복원 영상을 획득하고, 상기 깊이별 복원 영상과 상기 테스트 영상을 비교하여 상기 깊이별 복원 영상의 손실값을 계산하고, 상기 손실값이 기 정의된 값 이하가 될 때까지 상기 이진위상구조를 업데이트하는 프로세서를 포함한다. 상기 프로세서는, 상기 손실값이 기 정의된 값 이하인 경우, 해당 이진위상구조를 가지는 이진위상필터를 목표 이진위상필터로 선정할 수 있다. 상기 프로세서는, 목표 피사계 심도 구간 내 깊이별 점확산함수(Point Spread Function)와 상기 테스트 영상의 합성곱 연산에 의해 상기 깊이별 영상 획득할 수 있다. 상기 프로세서는, 상기 이진위상구조의 위상값에 따라 상기 깊이별 점확산함수를 식별할 수 있다. 상기 프로세서는, 이진위상구조의 위상값에 따라 극값을 가지는 페널티 함수(penalty function)를 적용하여 상 기 이진위상구조를 업데이트할 수 있다. 상기 프로세서는, 상기 깊이별 복원 영상 각각에 대해 계산한 손실값의 평균값을 계산할 수 있다."}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명의효과", "paragraph": 1, "content": "본 발명의 일 실시예에 따르면, 복원된 영상이 테스트 영상과 최대한 동일할 수 있도록 이진위상필터의 이진위 상구조를 업데이트하는 바, 최적의 이진위상필터를 제공할 수 있다. 본 발명의 일 실시예에 따르면, 이진위상필터 설계와 함께 영상 복원을 위한 파라미터를 동시에 수정하는 바, 이진위상필터의 설계의 최적화에 맞추어 설계된 이진위상필터에 최적화된 영상 복원을 수행할 수 있다. 본 발명의 일 실시예에 따르면, 이진 위상(Binary phase) 구조를 이용하여 광학계의 피사계 심도를 확장할 수 있고, 피사계 심도와 분해능 간 트레이트 오프를 극복할 수 있다."}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 1, "content": "이하, 본 발명에 따른 바람직한 실시 형태를 첨부된 도면을 참조하여 상세하게 설명한다. 첨부된 도면과 함께 이하에 개시될 상세한 설명은 본 발명의 예시적인 실시형태를 설명하고자 하는 것이며, 본 발명이 실시될 수 있 는 유일한 실시형태를 나타내고자 하는 것이 아니다. 도면에서 본 발명을 명확하게 설명하기 위해서 설명과 관 계없는 부분은 생략할 수 있고, 명세서 전체를 통하여 동일 또는 유사한 구성 요소에 대해서는 동일한 참조 부 호를 사용할 수 있다. 도 1은 본 발명의 일 실시예에 따른 이진위상필터를 이용하여 피사계 심도가 향상됨을 도시한 도면이다. 도 1에는 이진위상필터(Binary Phase Filter, BPF), 피사체 및 이진위상필터를 이용하여 촬영된 피사체가 도시되어 있다. 이때, 피사체는 서로 다른 거리로 배치되어 있는 바, 이진위상필터가 없는 기존 영상 시스템을 이용하 여 촬영하는 경우, 피사체의 위치에 따라 다른 분해능을 제공할 수 있다. 본 발명에서는, 분해능의 저하를 방지하거나 최소화하면서 피사계 심도를 확장하기 위해 이진위상필터가 적 용되었다. 본 발명의 일 실시예에 따르면, 이진위상필터는 입사되는 빛을 이진 위상(binary phase) 방식으로 지연하여 통과시키는 필터로서, 이진위상구조에 따라 필터에 입사되는 빛을 0˚ 혹은 180˚(0 혹은 π)의 위상만큼 지연 하여 출사할 수 있다. 이진위상필터는 도 1에 도시된 바와 같이 서로 이격된 복수의 패턴을 포함할 수 있고, 복수의 패턴은 반경 방향으로 이격된 서로 다른 폭을 가지는 동심의 환형 패턴일 수 있다. 이진위상필터는 0 혹은 π를 나타내 는 부분을 통과하는 광이 임의의 광경로차이를 가지거나, 빛을 투과하거나 반사시키는 이진 구조일 수 있다. 이 때, 이진위상필터의 이진위상구조는 다양하게 설계될 수 있을 것이다. 실제 설계를 통해 제작된 이진위상필 터의 일 예는 도 7에 도시되어 있다. 본 발명의 일 실시예에 따르면, 이진위상필터를 채용하는 경우, 피사계 심도가 확장되어 서로 다른 거리에 있는 피사체들도 촬영된 피사체와 같이 선명하게 결상됨을 확인할 수 있다. 본 발명의 일 실시예에 따른 이진위상필터는 광학계를 구성하는 광학요소와 상호작용할 수 있으며, 광축을 따라 배열된 렌즈 사이에 배치될 수 있다.영상 시스템은 이진위상필터를 포함함으로써, 심도 밖 그리고 심도 범위에 있는 모든 피사체를 높은 해상도 로 촬상할 수 있다. 본 발명에서는 피사계 심도를 확장하면서도 보다 효과적으로 피사계 심도와 분해능 간 트레이드 오프를 극복할 수 있는 이진위상필터의 설계 방법에 대해 제안한다. 본 발명에서는 머신러닝 (machine learning, ML), 신경망 (neural network, NN)학습을 기반으로 이진위상필터 를 생성하며, 공동으로 학습(jointly-optimized / end-to-end optimized)된 최적의 영상 처리 방법에 대해서도 제안한다. 이와 같이, 이진위상필터의 설계 및 영상 복원 방법은 전자장치에 의해 수행될 수 있으며, 전자장치는 컴퓨터, 서버, 노트북, 스마트 폰, 태블릿 PC 등으로 구현될 수 있다. 이하, 도면들을 참조하여 본 발명의 일 실시예에 따른 피사계 심도 확장을 위한 이진위상필터 설계 및 영상 복 원 방법, 이를 수행하는 전자장치의 구성 및 동작에 대해 구체적으로 설명한다. 도 2는 본 발명의 일 실시예에 따른 전자장치의 구성을 도시한 블럭도이다. 본 발명의 일 실시예에 따른 전자장치는 입력부, 통신부, 표시부, 메모리, 및 프로세 서를 포함한다. 입력부는 전자장치의 사용자 입력에 대응하여 입력데이터를 발생시킨다. 예를 들어, 사용자 입력은 전자장치의 동작을 시작하게 하는 사용자 입력, 손실값의 기준값을 설정하는 사용자 입력일 수 있으며, 이 외에도 이진위상필터를 설계 및 영상 복원하는데 필요한 사용자 입력인 경우 제한하지 않고 적용 가능하다. 입력부는 적어도 하나의 입력수단을 포함한다. 입력부는 키보드(key board), 키패드(key pad), 돔 스 위치(dome switch), 터치패널(touch panel), 터치 키(touch key), 마우스(mouse), 메뉴 버튼(menu button) 등 을 포함할 수 있다. 통신부는 테스트 영상, 영상 복원 모델 등을 수신하기 위해 서버 등 외부장치와의 통신을 수행한다. 이를 위해, 통신부는 5G(5th generation communication), LTE-A(long term evolution-advanced), LTE(long term evolution), Wi-Fi(wireless fidelity) 등의 통신을 수행할 수 있다. 표시부는 전자장치의 동작에 따른 표시 데이터를 표시한다. 표시부는 이진위상필터를 표시하는 화면, 깊이별 영상을 표시하는 화면, 깊이별 복원 영상을 표시하는 화면, 사용자 입력을 수신하기 위한 화면 등 을 표시할 수 있다. 표시부는 액정 디스플레이(LCD; liquid crystal display), 발광 다이오드(LED; light emitting diode) 디 스플레이, 유기 발광 다이오드(OLED; organic LED) 디스플레이, 마이크로 전자기계 시스템(MEMS; micro electro mechanical systems) 디스플레이 및 전자 종이(electronic paper) 디스플레이를 포함한다. 표시부 는 입력부와 결합되어 터치 스크린(touch screen)으로 구현될 수 있다. 메모리는 전자장치의 동작 프로그램들을 저장한다. 메모리는 전원의 제공 유무와 무관하게 데이 터(정보)를 보존할 수 있는 비휘발성 속성의 스토리지(storage)와, 프로세서에 의해 처리되기 위한 데이터 가 로딩되며 전원이 제공되지 않으면 데이터를 보존할 수 없는 휘발성 속성의 메모리(memory)를 포함한다. 스토 리지에는 플래시메모리(flash-memory), HDD(hard-disc drive), SSD(solid-state drive) ROM(Read Only Memory) 등이 있으며, 메모리에는 버퍼(buffer), 램(RAM; Random Access Memory) 등이 있다. 메모리는 외부장치로부터 수신한 영상 복원 모델을 저장하거나, 깊이별 영상을 획득, 깊이별 영상을 복원, 깊이별 복원 영상의 손실값 계산, 이진위상구조 업데이트 등을 수행하는 과정에서 필요한 연산 프로그램 등을 저장할 수 있다. 프로세서는 프로그램 등 소프트웨어를 실행하여 전자장치의 적어도 하나의 다른 구성요소(예: 하드웨 어 또는 소프트웨어 구성요소)를 제어할 수 있고, 다양한 데이터 처리 또는 연산을 수행할 수 있다. 프로세서는 이진위상필터에 설정된 이진위상구조에 기초하여 테스트 영상에 대해 깊이별 영상을 획득하고, 입력되는 영상을 복원하도록 학습된 모델에 기초하여 상기 깊이별 영상을 복원한 깊이별 복원 영상을 획득하고, 상기 깊이별 복원 영상과 상기 테스트 영상을 비교하여 상기 깊이별 복원 영상의 손실값을 계산하고, 상기 손실 값이 기 정의된 값 이하가 될 때까지 상기 이진위상구조를 업데이트한다.한편, 프로세서는 상기 동작들을 수행하기 위한 데이터 분석, 처리, 및 결과 정보 생성 중 적어도 일부를 규칙 기반 또는 인공지능(Artificial Intelligence) 알고리즘으로서 기계학습, 신경망 네트워크(neural network), 또는 딥러닝 알고리즘 중 적어도 하나를 이용하여 수행할 수 있다. 신경망 네트워크의 예로는, CNN (Convolutional Neural Network), DNN (Deep Neural Network), RNN (Recurrent Neural Network)과 같은 모델 을 포함할 수 있다. 도 3은 본 발명의 제1실시예에 따른 전자장치의 동작 흐름도를 도시한 도면이다. 본 발명의 일 실시예에 따르면, 프로세서는 이진위상필터에 설정된 이진위상구조에 기초하여 테스트 영상 에 대해 깊이별 영상을 획득한다(S10). 본 발명의 일 실시예에 따르면, 맨 처음 이진위상필터 설계를 시작할 때, 이진위상구조는 초기값을 가질 수 있 다. 이때, 초기값은 임의의 값 혹은 특정 함수로 선정될 수 있다. 이후, 이진위상필터의 이진위상구조는 품질 평가에 따라 가장 적합한 이진위상구조를 가질 때까지 지속적으로 업데이트될 수 있다. 본 발명의 일 실시예에 따르면, 테스트 영상은 원본 영상으로써 추후 복원된 영상의 품질을 평가하는데 기준이 되는 영상일 수 있다. 프로세서는 초기로 선정된 이진위상구조(업데이트 된 이후에는 업데이트된 이진위상구조, 이하 편의상 이 진위상구조라 한다.)에 기초하여 테스트영상에 대해 깊이별 영상을 획득한다. 프로세서는 광학계로부터 산출되는 점확산함수(point spread function, PSF)와 테스트 영상의 합성곱 연산 에 의해 깊이별 영상을 획득할 수 있다. 점확산함수는 이진위상필터를 포함한 광학계를 구성하는 광학요소들에 의해 결정된다. 예를 들어, 영상 시스템 을 구성하는 렌즈, 조리개, 필터 등에 의해 변화될 수 있다. 이때, 점확산함수는 깊이별로 산출하여 테스트 영 상과 각각 합성곱 연산을 하여 깊이별 영상을 획득한다. 깊이별 영상을 획득하는 과정은 도 4를 참조하여 구체 적으로 설명한다. 이때, 영상을 획득하는 것은 영상을 모사하는 것이라고도 한다. 본 발명에서는 최적의 이진위상필터와 영상복원 알고리즘을 설계하기 위하여 이진위상필터가 포함된 영상 시스템의 영상 결과를 모사한다. 이때, 영상 모사를 시뮬레이션하는 종래의 다양한 방법이 본 실시예에 적용될 수 있다. 본 발명의 일 실시예에 따르면, 프로세서는 입력되는 영상을 복원하도록 학습된 모델에 기초하여 깊이별 영상을 복원한 깊이별 복원 영상을 획득한다(S20). 본 발명의 일 실시예에 따르면, 깊이별 영상은 점확산함수와의 합성곱에 의해 테스트 영상보다 화질이 낮아졌을 것이므로, 프로세서는 깊이별 영상을 복원하여 개선한다. 이때, 영상 복원은 예를 들어, 신경망을 이용하 여 복원될 수 있으나, 학습이 필요한 별도의 매개변수를 가지는 다양한 영상 복원 알고리즘이 이용될 수 있다. 본 발명의 일 실시예에 따르면, 입력되는 영상을 복원하도록 학습된 모델은 외부로부터 수신하거나, 프로세서 에 의해 학습될 수 있다. 모델을 학습하는 과정은 도 6을 참조하여 구체적으로 설명한다. 본 발명의 일 실시예에 따르면, 서로 다른 깊이의 복수의 영상이 획득된 경우, 각 개별 이미지에 대해 동일한 영상 복원을 수행한다. 본 발명의 일 실시예에 따르면, 프로세서는 깊이별 복원 영상과 테스트 영상을 비교하여 깊이별 복원 영상 의 손실값을 계산한다(S30). 프로세서는 깊이별 복원 영상의 품질을 비교, 평가함으로써 손실(비용)을 산출할 수 있다. 일반적으로 발 생한 손실은 테스트 영상과 복원 영상 간의 유사도가 높을 때, 낮은 값을 가진다. 따라서, 손실값이 0에 가까울 수록 복원 영상이 원본 영상과 유사함을 나타낸다. 프로세서는 깊이별 복원 영상 각각에 대해 손실값을 계산하고, 그 손실값들의 평균값을 해당 깊이별 복원 영상의 손실값으로 식별할 수 있다. 본 발명의 일 실시예에 따른 최적의 이진위상필터는 복원 영상과 테스트 영상이 일치하여 발생하는 손실이 기 정의된 값 이하일 때의 이진위상구조를 가지는 필터를 의미한다. 이때, 기 정의된 값은 0일 수 있으나, 어느 하나에 한정되지 않으며 구체적인 값 이외에 범위를 가질 수 있다. 기 정의된 값은 사용자에 의해 설정될 수도 있 다. 이때, 영상복원 결과가 원본영상과 일치하여 낮은 손실을 발생시키기 위해서, 이진위상필터는 서로 다른 깊이에 서 동일한 영상을 제공하여야 한다. 같은 목적에서 영상복원 모델은 서로 다른 깊이의 영상을 하나의 복원방법 만을 사용하여 원본 영상으로 복원 가능하여야 한다. 본 발명의 일 실시예에 따르면, 프로세서는 손실값이 기 정의된 값 이하가 될 때까지 이진위상구조를 업데 이트한다(S40). 프로세서는 손실값이 기 정의된 값보다 큰 경우, 해당 이진위상필터가 적합하지 않은 것으로 판단하고 다 시 이진위상구조를 업데이트할 수 있다. 본 발명에서 업데이트는 이진위상필터를 정의하는 변수들의 값을 조정 하는 것을 의미한다. 본 발명에서는 이진위상구조를 업데이트하는 최적 설계법으로 경사하강법을 제안한다. 경사하강법은 복원된 영 상에 대해 발생한 손실이 최소가 되도록 매회 반복마다 설계 변수를 수정하는 알고리즘이며, 그 대표적으로 stochastic gradient decont(SGD), momentum, AdaGrad, 등이 사용될 수 있다. 다만, 경사하강법에 기초한 알고리즘은 모든 연산과정에서 미분이 가능하여야 하나, 본 발명에서 최적화하고자 하는 이진위상필터는 반경방향(radial coordinate)으로 이산적(discrete) 구조를 가짐으로 미분이 불가하다. 따라서, 본 발명에서는 이진위상구조의 위상값에 따라 극값을 가지는 페널티 함수(penalty function)를 적용하 여 이진위상구조의 업데이트가 가능하게 한다. 이진위상필터에 페널티 함수를 이용하면 이진위상필터의 변조 값 에 대해 미분이 가능하다. 이때, 이진위상필터의 변조 값은 광 위상차, 광흡수율, 광반사율, 등이 될 수 있다. 본 발명의 일 실시예에 따르면, 복원된 영상이 테스트 영상과 최대한 동일할 수 있도록 이진위상필터의 이진위 상구조를 업데이트하는 바, 최적의 이진위상필터를 제공할 수 있다. 도 4는 본 발명의 제2실시예에 따른 전자장치의 동작 흐름도를 도시한 도면이다. 본 발명의 일 실시예에 따른 전자장치의 동작 흐름도는 도 3과 다소 중복될 수 있는 바, 중복되는 내용에 대해 서는 구체적인 설명을 생략한다. 본 발명의 일 실시예에 따르면, 프로세서는 목표 피사계 심도 구간 내 깊이별 점확산함수와 테스트 영상의 합성곱 연산에 의해 깊이별 영상을 획득한다(S410). 보다 구체적으로, 프로세서는 이진위상필터로부터 목표 피사계 심도 구간에 있는 피사체를 모사할 수 있는 적어도 하나의 점확산함수를 도출할 수 있다. 예를 들어, 목표 피사계 심도 구간이 광학계로부터 d1 내지 d2의 거리에 있을 때, 프로세서는 이진위상필 터부터 d1, d1+(d2-d1)*1/n, d1+(d2-d1)*2/n, ..., d1+(d2-d1)*(n-1)/n, d2의 거리에 있는 피사체를 모사할 수 있는 n+1개의 점확산함수를 산출할 수 있다. 프로세서는 목표 피사계 심도 구간에 대응하는 복수의 점확산함수와 테스트 영상의 합성곱을 수행하여, 촬 상장치로부터 목표 피사계 심도에 대응하는 거리 범위에 있는 테스트 영상을 모사할 수 있다. 본 발명의 일 실시예에 따르면, 프로세서는 입력되는 영상을 복원하도록 학습된 모델에 기초하여 깊이별 영상을 복원한 깊이별 복원 영상을 획득한다(S420). 본 발명의 일 실시예에 따르면, 프로세서는 손실값이 기 정의된 값 이하인지 여부를 확인한다(S430). 이때, 영상의 품질은 모사된 영상으로부터 영상 품질과 관련된 평가값으로 정량화될 수 있다. 영상 품질을 정량 화 하는 방법은 1) 원본(왜곡 없는 영상)을 참조하는 완전 참조(full-reference) 평가법 또는 2) 원본 영상을 참조하지 않는 무참조(no-reference) 평가법을 포함할 수 있다. 보다 구체적으로, 1) 완전참조평가법은 RMSE(root mean square error), PSNR(peak signal to noise ratio), SSIM(structure similarity) 등을 포함할 수 있고, 2) 무참조 평가법은 BRISQUE(Blind/Referenceless Image Spatial Quality Evaluator), NIQE(Natural Image Quality Evaluator), PIQE(Perception based Image Quality Evaluator) 등을 포함할 수 있다. 본 발명의 일 실시예에 따르면, 프로세서는 손실값이 기 정의된 값 이하인 경우(S430의 Yes), 해당 이진위 상구조를 가지는 이진위상필터를 목표 이진위상필터로 선정한다(S440). 본 발명의 일 실시예에 따르면, 프로세서는 손실값이 기 정의된 값 이하가 아닌 경우(S430의 No), 이진위 상구조를 업데이트하고(S450), 다시 S410으로 돌아간다. 앞서 도 3의 S40과 관련하여 서술한 바와 같이, 본 발명에서는 경사하강법에 기초하여 이진위상구조를 업데이트 한다. 이를 식으로 나타내면 다음과 같다. 수학식 1"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 2, "content": "여기서 는 t회 째의 이진위상필터의 위상값 행렬이며, 은 손실 함수이다. 이때, 손실 함수는 에 대해 서 미분 가능하여야 하고, 수학식 2와 같이 표현 가능하다. 수학식 2"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 3, "content": "여기서 는 페널티 함수가 적용된 이진위상필터로 본 실시예에서 제안하는 설계법이 미분 가능한 바, 경사 하강법을 적용할 수 있음을 알 수 있다. 도 5는 본 발명의 일 실시예에 따른 이진위상필터 설계 및 영상 복원 방법을 전체적으로 도시한 개략도이다. 도 5는 도 3 및 도 4에서 설명한 내용을 도식화하여 보여주고 있다. 크게 깊이별 영상을 획득하는 단계( Imaging system), 깊이별 영상을 복원하는 단계(Image reconstruction system), 복원된 영상과 원본 영상을 비교하는 단계(Loss function)로 나눌 수 있다. 각 단계를 구체적으로 살펴보면 다음과 같다. Imaging system 광학시스템의 영상은 점확산함수를 이용하여 수학식 3과 같이 표현 가능하며, 원본 영상과 점확산함수의 합성곱 은 결상된 영상을 나타낸다. 수학식 3"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 4, "content": "여기서 I는 결상된 영상, I*은 원본 영상, h는 점확산함수이다. 점확산함수는 수차가 없는 이상적인 광학시스템을 가정할 때, 수학식 4와 같이 표현 가능하다. 수학식 4"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 5, "content": "여기서 시스템은 단파장 광학계를 대상으로 하며, P(ρ)는 광학계의 Pupil 함수이다. 광학시스템은 서로 다른 깊이에 있는 영상을 모사 가능하다. 특정 깊이의 영상은 aperture에 'quadratic phase wave-front error'를 더하여 표현할 수 있으며, 깊이 조건을 정량화 하기위해 매개변수 ψ를 도입한다. 매개변 수 ψ는 수학식 5와 같이 정의된다. 수학식 5"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 6, "content": "여기서 △z는 초점면으로부터 피사체의 이동거리이고, NA는 렌즈의 개구수, λ는 파장, n는 매질의 굴절률이다. 매개변수 ψ는 aperture 최외곽의 wave-front error이며, 수학식 6과 같이 Pupil 함수에 적용 가능하다. 수학식 6"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 7, "content": "여기서 는 깊이 z에 대응하는 aperture이며, ρ는 정규화 된 radial coordinate이다. 본 발명에서 설계하고자 하는 이진위상필터(phase mask, )는 회의 반복을 통해 학습된다. 이때 이진위상필 터의 설계변수는 이진위상필터의 위상지연 값()이다. 는 radial 방향으로 i개의 원소를 가지는 행렬로, 매회 학습을 통해 값이 변경 가능하다. 이진위상필터는 수 학식 7과 같이 aperture의 위상을 조작함으로써 점확산점수를 변화시킬 수 있다. 수학식 7"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 8, "content": "여기서 는 이진위상필터가 적용된 aperture이며, 는 학습하고자 하는 이진위상필터이고, 연산자 는 성분곱(hadamard product)을 나타낸다. 본 발명에서 이진위상필터는 매회 반복하며 연속 위상 구조로부터 최적의 이진위상필터 디자인을 제공하기 위해 페널티 함수가 적용된다. 깊이별 영상 획득, 영상 복원, 비교 과정은 매 회 순전파(forward pass)와 역전파 (backward pass)를 반복하며 위상값에 대한 기울기를 연산하며, 페널티 함수가 극값을 이루는 지점에서 수렴 가 능하다. 이를 수학식 8을 통해 표현할 수 있다.수학식 8"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 9, "content": "여기서 는 위상필터의 위상값이며, 는 페널티 함수, (a,b,c)는 함수의 매개변수를 나타낸다. 앞서 도 3의 S10과 관련하여 서술한 바와 같이, 이진위상필터의 초기값은 임의의 값 혹은 특정 함수로 선정될 수 있다. 수학식 9는 그 구체적 예시를 나타낸다. 수학식 9"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 10, "content": "여기서 N(0,σ)는 평균 0, 분산 σ인 잡음 함수이며, 는 심도확장 성능을 가지는 것으로 알려져 있는 Spherical aberration 함수를 나타낸다. 본 기술이 해결하고자 하는 깊이에 따라 변화하는 점확산함수는 상기 기술한 다양한 요소들을 결합하여 수학식 10과 같이 표현할 수 있다. 수학식 10"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 11, "content": "여기서 h(x,y;z)는 깊이 z에 대응하는 점확산함수이며, 수학식 1과 동일하게 깊이 z에 대응하는 영상을 모사를 수학식 11과 같이 표현 가능하다. 수학식 11"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 12, "content": "여기서 는 출력 이미지, y는 원본 이미지, h(x,y;z)는 깊이 z에 대응하는 점확산함수이다. Image reconstruction system 앞서 도 3의 S40과 관련하여 서술한 최적설계법은 이진위상필터를 설계하는 것과 설계된 이진위상필터에 대응하 는 영상 복원 방법을 동시에 제시한다. 관련하여 구체적인 내용은 도 6을 통해 설명한다. Loss function 본 방법은 t회 반복마다 이진위상필터 설계와 영상 복원 방법을 모두 학습하기 위해 제안되었다. 이진위상필터 와 영상복원방법은 손실함수(loss function)를 최소화하는 것을 목표로 학습된다. 손실 함수는 알고리즘에 입력된 원본 영상(y)과 복원 영상() 간의 비교를 수행한다. 손실 함수는 표 1과 같이 RMSE, SSIM을 이용할 수 있 으나, 이에 한정되는 것은 아니다. 표 1"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 13, "content": "여기서 N은 영상의 총 pixel 개수, y와 는 각각 원본 그리고 복원 영상, μ와 σ는 각각 평균과 분산이며 c 는 발산을 방지하기 위한 상수이다. 복원 영상은 여러 깊이(z)에서 존재하기 때문에 손실 함수는 깊이에 따라 변하지 않는 영상품질을 가지는 대한 이상위상필터를 추구할 수 있다. 또한, 복원 영상의 밝기 또는 동적범위(dynamic range)와 무관하게 원본 영상과 유사성을 산출할 수 있는 SSIM 과 같은 영상품질점수가 활용될 수 있다. 도 6은 본 발명의 일 실시예에 따른 영상을 복원하는 모습을 도시한 도면이다. 영상 복원은 다양한 방법을 통해 수행될 수 있으며, 점확산함수 기반 영상 복원의 예시로 점확산함수의 역합성 곱(디컨볼루션)을 통해 영상을 복원할 수 있다. 구체적인 수식은 수학식 12와 같다. 수학식 12"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 14, "content": "여기서 와 는 각각 깊이 z 에서의 복원 전, 복원 후 영상이며 는 학습 가능한 매개변수이다. 다른 예로, 입력되는 영상을 복원하도록 학습된 모델에 기초하여 깊이별 영상을 복원한 깊이별 복원 영상을 획 득할 수 있다. 이때, 학습 모델은 합성곱 신경망(convolution neural network, CNN), DNN, DNN 중에서도 U- net, Resnet 등을 이용할 수 있다. 학습 모델은 입력 이미지 에 대해 출력이미지 를 생성한다. 본 발명에서는, 복원된 영상의 노이즈를 감소시키는 정규화 파라미터(regularization parameter, )를 영상 복원 모델과 함께 학습시켜 더욱 영상 복원 성능을 높일 수 있다. 이때, 디컨볼루션 방법과 학습 모델 방법은 동시에 혹은 각각 적용될 수 있으며, 어느 하나에 한정되는 것은 아 니다. 도 6에 도시된 알고리즘은 계속 반복하며 이진위상필터 설계와 함께 영상 복원을 위한 파라미터를 동시에 수정 한다. 따라서, 이진위상필터의 설계의 최적화에 맞추어, 설계된 이진위상필터에 최적화된 영상 복원을 수행할 수 있다. 도 7은 본 발명의 일 실시예에 따라 설계된 이진위상필터를 촬영한 사진이다. 이진위상필터는 위상 공간광변조기(spatial light modulator) 격자 및 밸브(grating light valve) 등으로 구현 될 수 있다. 이진위상필터는 0 혹은 π를 나타내는 부분을 통과하는 광이 임의의 광경로차이를 가질 수 있으며, 광경로 차이는 0 혹은 π를 나타내는 두 부분의 물리적 단차에 의해 구현될 수 있다. 0 혹은 π를 나타내는 물리적 단 차는 임프린팅(imprinting), 박막 증착(thin film deposition), 습식/건색 에칭(wet/dry etching), 홀로그램 필름 부착 등의 방법을 통해 구현될 수 있다. 본 기술의 설계 결과를 물리적 수치로 변환하기 위해 수학식 13을 활용할 수 있다. 그리고, 도 7에 도시된 이진 위상필터의 구현에 있어서 활용된 수치는 표 2와 같다. 수학식 13"}
{"patent_id": "10-2022-0135479", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 15, "content": "표 2"}
{"patent_id": "10-2022-0135479", "section": "도면", "subsection": "도면설명", "item": 1, "content": "도 1은 본 발명의 일 실시예에 따른 이진위상필터를 이용하여 피사계 심도가 향상됨을 도시한 도면이다. 도 2는 본 발명의 일 실시예에 따른 전자장치의 구성을 도시한 블럭도이다. 도 3은 본 발명의 제1실시예에 따른 전자장치의 동작 흐름도를 도시한 도면이다. 도 4는 본 발명의 제2실시예에 따른 전자장치의 동작 흐름도를 도시한 도면이다. 도 5는 본 발명의 일 실시예에 따른 이진위상필터 설계 및 영상 복원 방법을 전체적으로 도시한 개략도이다. 도 6은 본 발명의 일 실시예에 따른 영상을 복원하는 모습을 도시한 도면이다. 도 7은 본 발명의 일 실시예에 따라 설계된 이진위상필터를 촬영한 사진이다."}
