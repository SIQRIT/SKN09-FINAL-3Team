{"patent_id": "10-2021-0051331", "section": "특허_기본정보", "subsection": "특허정보", "content": {"공개번호": "10-2022-0144687", "출원번호": "10-2021-0051331", "발명의 명칭": "듀얼 어텐션 다중 인스턴스 학습 방법", "출원인": "재단법인대구경북과학기술원", "발명자": "박상현"}}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_1", "content": "3D 이미지에 대한 분석을 위한 다중 인스턴스 학습 장치로서,다중 인스턴스 학습 모델이 저장된 메모리; 및상기 메모리와 전기적으로 연결된 적어도 하나의 프로세서를 포함하고,상기 다중 인스턴스 학습 모델은,입력되는 3D 이미지의 2D 인스턴스들(instances) 각각의 특징 맵(Feature Map)을 도출하는 합성곱(Convolution) 블록;상기 합성곱 블록으로부터 도출된 상기 특징 맵으로부터 상기 인스턴스들의 공간 어텐션 맵(Spatial AttentionMap)을 도출하는 공간 어텐션 블록;상기 특징 맵과 상기 공간 어텐션 맵의 합성 결과를 입력 받아 인스턴스마다의 어텐션 스코어를 도출하고, 상기어텐션 스코어에 따라 인스턴스들의 임베딩들(embeddings)을 종합하여 상기 3D 이미지에 대한 총합 임베딩(aggregated embedding)을 도출하는 인스턴스 어텐션 블록(Instance Attention Block); 및상기 총합 임베딩에 기초하여 상기 3D 이미지에 대한 분석 결과를 출력하는 출력 블록을 포함하는,다중 인스턴스 학습 장치."}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_2", "content": "제 1 항에 있어서,상기 프로세서는, 상기 학습 모델의 훈련 페이즈에서, 상기 분석 결과에 대한 실제값(Ground-Truth)으로 레이블링된 3D 이미지를 포함한 훈련 데이터를 이용하여 상기 학습 모델의 전체 손실 함수(L)가 최소값을 가지도록 상기 학습 모델을 훈련시키는 동작을 수행하며,상기 전체 손실 함수는 상기 출력 블록의 결과에 대한 모음 레벨(Bag Level)의 손실 함수(LB) 및 상기 인스턴스임베딩들과 상기 총합 임베딩 사이의 대조 손실 함수(LF)의 조합인,다중 인스턴스 학습 장치."}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_3", "content": "제 2 항에 있어서,상기 다중 인스턴스 학습 모델을 훈련시키는 동작은, 상기 다중 인스턴스 학습 모델의 전체 손실 함수(L)가 최소값을 가지도록 상기 합성곱 블록, 상기 공간 어텐션 블록, 상기 인스턴스 어텐션 블록의 파라미터들을 조정하는 동작을 포함하는,다중 인스턴스 학습 장치."}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_4", "content": "제 2 항에 있어서,상기 전체 손실 함수(L)는 아래의 수학식 1로 표현되는,공개특허 10-2022-0144687-3-다중 인스턴스 학습 장치.수학식 1는 0과 1사이의 값으로 모음 레벨의 손실 함수의 가중치를 나타내는 파라미터"}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_5", "content": "제 2 항에 있어서,상기 모음 레벨(Bag Level)의 손실 함수(LB)는 아래의 수학식 2로 표현되고, 상기 대조 손실 함수(LF)는 아래의수학식 3으로 표현되는,다중 인스턴스 학습 장치.수학식 2는 인스턴스 레이블, 는 상기 3D 이미지의 레이블이 가 될 확률수학식 3는 인스턴스 레벨의 특징이고, 는 모음 레벨의 특징이고, 로 k가 i와 같지 않으면 1의값을 가지고 k=i인 경우 0의 값을 가지며, 는 온도 파라미터, 는 유사도 함수, N은 3D 이미지의 인스턴스들의 수"}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_6", "content": "3D 이미지에 대한 분석을 위한 다중 인스턴스 학습 장치로서,적어도 하나의 명령어를 저장하는 메모리; 및상기 메모리와 연동되어 상기 명령어를 실행하는 적어도 하나의 프로세서를 포함하되,상기 명령어는 상기 프로세서에 의해 실행될 때, 상기 프로세서로 하여금,다중 인스턴스 학습 모델에 입력되는 3D 이미지의 2D 인스턴스들(instances) 각각의 특징 맵(Feature Map)을 도출하는 동작;도출된 상기 특징 맵으로부터 상기 인스턴스들의 공간 어텐션 맵(Spatial Attention Map)을 도출하는 동작;상기 특징 맵과 상기 공간 어텐션 맵의 합성 결과를 입력 받아 인스턴스마다의 어텐션 스코어를 도출하는 동작;상기 어텐션 스코어에 따라 인스턴스들의 임베딩들(embeddings)을 종합하여 상기 3D 이미지에 대한 총합 임베딩(aggregated embedding)을 도출하는 동작; 및상기 총합 임베딩에 기초하여 상기 3D 이미지에 대한 분석 결과를 출력하는 동작을 수행하도록 하는, 공개특허 10-2022-0144687-4-다중 인스턴스 학습 장치."}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_7", "content": "제 6 항에 있어서,상기 프로세서는, 상기 다중 인스턴스 학습 모델의 훈련 페이즈에서, 상기 분석 결과에 대한 실제값(Ground-Truth)으로 레이블링된 3D 이미지를 포함한 훈련 데이터를 이용하여 상기 다중 인스턴스 학습 모델의 전체 손실함수(L)가 최소값을 가지도록 상기 다중 인스턴스 학습 모델을 훈련시키는 동작을 수행하며,상기 전체 손실 함수는 상기 출력 블록의 결과에 대한 모음 레벨(Bag Level)의 손실 함수(LB) 및 상기 인스턴스임베딩들과 상기 총합 임베딩 사이의 대조 손실 함수(LF)의 조합인,다중 인스턴스 학습 장치."}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_8", "content": "제 7 항에 있어서,상기 다중 인스턴스 학습 모델을 훈련시키는 동작은, 상기 다중 인스턴스 학습 모델의 전체 손실 함수(L)가 최소값을 가지도록 상기 특징 맵을 도출하는 동작, 상기 공간 어텐션 맵을 도출하는 동작, 상기 어텐션 스코어를도출하는 동작, 상기 총합 임베딩을 도출하는 동작에서 사용되는 파라미터들을 조정하는 동작을 포함하는,다중 인스턴스 학습 장치."}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_9", "content": "제 7 항에 있어서,상기 전체 손실 함수(L)는 아래의 수학식 1로 표현되는,다중 인스턴스 학습 장치.수학식 1는 0과 1사이의 값으로 모음 레벨의 손실 함수의 가중치를 나타내는 파라미터"}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_10", "content": "제 7 항에 있어서,상기 모음 레벨(Bag Level)의 손실 함수(LB)는 아래의 수학식 2로 표현되고, 상기 대조 손실 함수(LF)는 아래의수학식 3으로 표현되는,다중 인스턴스 학습 장치.수학식 2공개특허 10-2022-0144687-5-는 인스턴스 레이블, 는 상기 3D 이미지의 레이블이 가 될 확률수학식 3는 인스턴스 레벨의 특징이고, 는 모음 레벨의 특징이고, 로 k가 i와 같지 않으면 1의값을 가지고 k=i인 경우 0의 값을 가지며, 는 온도 파라미터, 는 유사도 함수, N은 3D 이미지의 인스턴스들의 수"}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_11", "content": "컴퓨팅 장치 또는 컴퓨팅 네트워크에서 적어도 하나의 프로세서에 의해 수행되는 3D 이미지 분석을 위한 다중인스턴스 학습 방법으로서,다중 인스턴스 학습 모델에 입력되는 3D 이미지의 2D 인스턴스들(instances) 각각의 특징 맵(Feature Map)을 도출하는 단계;도출된 상기 특징 맵으로부터 상기 인스턴스들의 공간 어텐션 맵(Spatial Attention Map)을 도출하는 단계;상기 특징 맵과 상기 공간 어텐션 맵의 합성 결과를 입력 받아 인스턴스마다의 어텐션 스코어를 도출하는 단계;상기 어텐션 스코어에 따라 인스턴스들의 임베딩들(embeddings)을 종합하여 상기 3D 이미지에 대한 총합 임베딩(aggregated embedding)을 도출하는 단계; 및상기 총합 임베딩에 기초하여 상기 3D 이미지에 대한 분석 결과를 출력하는 단계를 포함하는, 다중 인스턴스 학습 방법."}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_12", "content": "제 11 항에 있어서,상기 3D 이미지는 상기 분석 결과에 대한 실제값(Ground-Truth)으로 레이블링되고,상기 다중 인스턴스 학습 방법은,상기 다중 인스턴스 학습 모델의 훈련 페이즈에서, 레이블링된 상기 3D 이미지를 포함한 훈련 데이터를 이용하여 상기 다중 인스턴스 학습 모델의 전체 손실 함수(L)가 최소값을 가지도록 상기 다중 인스턴스 학습 모델을훈련시키는 단계를 더 포함하고,상기 전체 손실 함수는 상기 출력 블록의 결과에 대한 모음 레벨(Bag Level)의 손실 함수(LB) 및 상기 인스턴스임베딩들과 상기 총합 임베딩 사이의 대조 손실 함수(LF)의 조합인,다중 인스턴스 학습 방법."}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_13", "content": "제 12 항에 있어서,상기 다중 인스턴스 학습 모델을 훈련시키는 단계는, 상기 다중 인스턴스 학습 모델의 전체 손실 함수(L)가 최소값을 가지도록 상기 특징 맵을 도출하는 단계, 상기 공간 어텐션 맵을 도출하는 단계, 상기 어텐션 스코어를공개특허 10-2022-0144687-6-도출하는 단계, 상기 총합 임베딩을 도출하는 단계에서 사용되는 파라미터들을 조정하는 단계를 포함하는,다중 인스턴스 학습 방법."}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_14", "content": "제 12 항에 있어서,상기 전체 손실 함수(L)는 아래의 수학식 1로 표현되는,다중 인스턴스 학습 방법.수학식 1는 0과 1사이의 값으로 모음 레벨의 손실 함수의 가중치를 나타내는 파라미터"}
{"patent_id": "10-2021-0051331", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_15", "content": "제 12 항에 있어서,상기 모음 레벨(Bag Level)의 손실 함수(LB)는 아래의 수학식 2로 표현되고, 상기 대조 손실 함수(LF)는 아래의수학식 3으로 표현되는,다중 인스턴스 학습 방법.수학식 2는 인스턴스 레이블, 는 상기 3D 이미지의 레이블이 가 될 확률수학식 3는 인스턴스 레벨의 특징이고, 는 모음 레벨의 특징이고, 로 k가 i와 같지 않으면 1의값을 가지고 k=i인 경우 0의 값을 가지며, 는 온도 파라미터, 는 유사도 함수, N은 3D 이미지의 인스턴스들의 수"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "요약", "paragraph": 1, "content": "본 발명은 3D 이미지에 대한 분석을 위한 다중 인스턴스 학습 장치로서, 다중 인스턴스 학습 모델이 저장된 메모 리, 메모리와 전기적으로 연결된 적어도 하나의 프로세서를 포함하고, 다중 인스턴스 학습 모델은, 입력되는 3D 이미지의 2D 인스턴스들(instances) 각각의 특징 맵(Feature Map)을 도출하는 합성곱(Convolution) 블록, 합성 곱 블록으로부터 도출된 특징 맵으로부터 인스턴스들의 공간 어텐션 맵(Spatial Attention Map)을 도출하는 공간 어텐션 블록, 특징 맵과 공간 어텐션 맵의 합성 결과를 입력 받아 인스턴스마다의 어텐션 스코어를 도출하고, 어 텐션 스코어에 따라 인스턴스들의 임베딩들(embeddings)을 종합하여 3D 이미지에 대한 총합 임베딩(aggregated embedding)을 도출하는 인스턴스 어텐션 블록(Instance Attention Block)을 포함할 수 있다."}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "기술분야", "paragraph": 1, "content": "본 발명은 듀얼 어텐션 다중 인스턴스 학습 방법에 관한 것으로, 더 상세하게는 비지도 보완 손실을 이용하는 다중 인스턴스 학습 방법에 관한 것이다."}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "배경기술", "paragraph": 1, "content": "흉부 컴퓨터 단층촬영(Chest Computed Tomography: Chest CT) 기반의 진단 및 분석은 코로나바이러스 질환 2019(COVID-19)과 같이 전세계적으로 빠르게 확산되는 팬더믹 발생에 대항하는데 주요한 역할을 한다.그러나, 감염된 영역들에 대한 주석(annotation), 대용량 데이터세트들의 분류 및 구조화, 진단하려는 질환과 다른 질환들 사이의 미세한 불일치의 구분에 있어서 어려움으로 인해 정확한 스크리닝이 도전적인 과제가 된다. 또한, 자동화된 스크리닝의 민감도가 제한되어 있고 방사선적인 레벨에서의 성능과 동등하지 못할 수 있다는 문 제가 있다. 따라서, 흉부 CT에 기반한 강인한 스크리닝 방법들을 개발하고 향상시켜야할 긴급한 필요가 있다. 한편, 딥러닝(deep learning) 기반 솔루션들은, 임상 데이터세트들로부터 풍부한 피쳐들(features)을 추출할 수 있고 장기 세그멘테이션 및 질병 진단 등과 같은 넓은 분야에서의 적용 분야를 가질 수 있다는 장점에 의해 의 료 이미지 분석에서 상당한 성공을 보여왔다. 예를 들어, 한국공개특허 제2021-0030730호는 의료 영상을 해석하는 인공지능 모델을 이용한 폐암 발병 가능성 예측 방법 및 의료 영상 분석 장치에 대해 개시한다. 다만, 딥러닝 기반 솔루션들이 유망한 성능을 보여주고 있기는 하나, 대부분의 방법들이 지도학습의 방식이고 상당한 양의 레이블링 노력이 필요하다는 문제점이 있다. 따라서, 과도한 데이터 프리-프로세싱(Pre-Processing) 및/또는 강한 사전 지식을 필요로 하지 않는 비지도 방 식 또는 약하게 지도가 필요한 학습 방법들이 정확한 진단을 위해 선호되는 옵션이 될 수 있다."}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "해결하려는과제", "paragraph": 1, "content": "상기와 같은 문제점을 감안한 본 발명이 해결하고자 하는 과제는, 다중 인스턴스 학습(Multiple Instance Learning: MIL)에 기반하여 신속한 진단을 위해 어텐션(attention)-기반의 종단간(end-to-end) 약한 지도방식 프레임워크를 제공하는 것이다. 또한, 본 발명이 해결하고자 하는 과제는, 공간적 및 잠재적 컨텍스트들 모두에 있어서 적용되는 어텐션을 이용 하는 비지도 방식의 대조적 학습(unsupervised contrastive learning) 방법을 제공하고, 이중 어텐션 대조 기 반 MIL(Dual Attention Contrastive based MIL: DA-CMIL)을 제공하는 것이다. 또한, 본 발명이 해결하고자 하는 과제는, 질병의 진단 결정을 위해 (a) 패치-기반, (b) 슬라이스-기반, (c) 3D CT-기반 방법들을 제공하는 것이다. 또한, 본 발명이 해결하고자 하는 과제는, 신규한 종단간 어텐션-기반의 약한 지도방식 프레임워크를 제공하는 것으로, 정확한 질병 진단을 위해 피쳐들에 대한 MIL 및 자가-지도 대조 학습(self-supervised contrastive learning)을 이용하는 방법을 제공하는 것이다."}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 1, "content": "상기와 같은 기술적 과제를 해결하기 위한 본 개시의 실시예에 따른 3D 이미지에 대한 분석을 위한 다중 인스턴 스 학습 장치는, 다중 인스턴스 학습 모델이 저장된 메모리 및 메모리와 전기적으로 연결된 적어도 하나의 프로 세서를 포함하고, 다중 인스턴스 학습 모델은, 입력되는 3D 이미지의 2D 슬라이스(slice)/패치(patch)인 인스턴 스들(instances) 각각의 특징 맵(Feature Map)을 도출하는 합성곱(Convolution) 블록, 합성곱 블록으로부터 도 출된 상기 특징 맵으로부터 상기 인스턴스들의 공간 어텐션 맵(Spatial Attention Map)을 도출하는 공간 어텐션 블록, 특징 맵과 상기 공간 어텐션 맵의 합성 결과를 입력 받아 인스턴스마다의 어텐션 스코어를 도출하고, 어 텐션 스코어에 따라 인스턴스들의 임베딩들(embeddings)을 종합하여 상기 3D 이미지에 대한 총합 임베딩 (aggregated embedding)을 도출하는 인스턴스 어텐션 블록(Latent Attention Block) 및 총합 임베딩에 기초하 여 상기 3D 이미지에 대한 분석 결과를 출력하는 출력 블록을 포함할 수 있다. 또한, 프로세서는, 다중 인스턴스 학습 모델의 훈련 페이즈에서, 분석 결과에 대한 실제값(Ground-Truth)으로 레이블링된 3D 이미지를 포함한 훈련 데이터를 이용하여 상기 학습 모델의 전체 손실 함수(L)가 최소값을 가지 도록 상기 학습 모델을 훈련시키는 동작을 수행할 수 있다. 여기서, 전체 손실 함수는 출력 블록의 결과에 대한 모음 레벨(Bag Level)의 손실 함수(LB) 및 인스턴스 임베딩 들과 총합 임베딩 사이의 대조 손실 함수(LF)의 조합일 수 있다."}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명의효과", "paragraph": 1, "content": "본 발명은 과도한 데이터 프리-프로세싱(Pre-Processing) 및/또는 강한 사전 지식을 필요로 하지 않는 비지도 방식 또는 약하게 지도가 필요한 학습 방법들을 제공하면서도 3D 이미지에 대한 보다 정확한 분석을 가능하게 한다. 또한, 지도학습과 대조 손실을 함께 사용함으로써, 본 발명의 모델은 더 작은 데이터 세트들 상에서 훈련되는 경우에도 오버피팅(overfitting)을 피할 수 있으며 정확성을 희생시키지 않으면서 인스턴스 레벨에서 특징 강인 성(feature robustness)을 향상시킬 수 있다. 또한, 본 발명의 다중 인스턴스 학습 방법은 인스턴스(예를 들어, 슬라이스/패치) 카운트가 달라지는 경우의 상 이한 CT 사이즈들에 대해서도 강인성을 가질 수 있다."}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 1, "content": "본 발명의 구성 및 효과를 충분히 이해하기 위하여, 첨부한 도면을 참조하여 본 발명의 바람직한 실시예들을 설 명한다. 그러나 본 발명은 이하에서 개시되는 실시예에 한정되는 것이 아니라, 여러가지 형태로 구현될 수 있고 다양한 변경을 가할 수 있다. 단지, 본 실시예에 대한 설명은 본 발명의 개시가 완전하도록 하며, 본 발명이 속"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 2, "content": "하는 기술분야의 통상의 지식을 가진 자에게 발명의 범주를 완전하게 알려주기 위하여 제공되는 것이다. 첨부된 도면에서 구성요소는 설명의 편의를 위하여 그 크기를 실제보다 확대하여 도시한 것이며, 각 구성요소의 비율은 과장되거나 축소될 수 있다. '제1', '제2' 등의 용어는 다양한 구성요소를 설명하는데 사용될 수 있지만, 상기 구성요소는 위 용어에 의해 한정되어서는 안 된다. 위 용어는 하나의 구성요소를 다른 구성요소로부터 구별하는 목적으로만 사용될 수 있다. 예를 들어, 본 발명의 권리범위를 벗어나지 않으면서 '제1구성요소'는 '제2구성요소'로 명명될 수 있고, 유사하게 '제2구성요소'도 '제1구성요소'로 명명될 수 있다. 또한, 단수의 표현은 문맥상 명백하게 다르게 표현 하지 않는 한, 복수의 표현을 포함한다. 본 발명의 실시예에서 사용되는 용어는 다르게 정의되지 않는 한, 해당"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 3, "content": "기술분야에서 통상의 지식을 가진 자에게 통상적으로 알려진 의미로 해석될 수 있다. 본 개시에 따른 다중 인스턴스 학습 장치 및 방법에서는 이중 어텐션 블록을 이용하고 모음 레벨 손실 함수에 더하여 대조 손실 함수를 이용하여 보다 정확한 영상 분석이 가능하도록 한다. 본 개시에 따른 다중 인스턴스 학습 장치 및 방법은 다양한 3D 이미지 분석에 사용될 수 있으나, 이하에서는 3D CT 이미지를 분석하여 코로나로 인한 폐렴과 세균성 폐렴을 구분하는 경우를 예시로 사용하여 본 발명의 개념을설명한다. 본 개시에 따른 다중 인스턴스 학습은 이중 어텐션 대조 기반 MIL(DA-CMIL: Dual Attention Contrastive based Multiple Instance Learning)이라고 지칭될 수 있다. DA-CMIL은 3D CT 이미지로부터 도출되는 환자 CT 슬라이 스들(인스턴스들의 모음으로 취급됨)을 입력 받고 단일 레이블을 출력할 수 있다. 어텐션 기반 풀링(Pooling)이 잠재적 공간에서 주요 슬라이스들을 선택하는데 적용될 수 있고, 공간 어텐션은 해석가능한 진단을 위해 슬라이스 공간의 컨택스트를 학습할 수 있다. 대조 손실(Contrastive Loss)은 대표적으 로 풀링된 환자 CT의 특징들에 대하여 동일한 환자 CT로부터 유사한 특징들을 인코딩하도록 인스턴스 레벨에서 적용될 수 있다. DA-CMIL의 목표는 다중의 2D 슬라이스들의 CT 볼륨이 입력으로 주어졌을 때 환자 CT에 하나의 카테고리 레이블 (예를 들어, 코로나 폐렴 또는 세균성 폐렴)을 할당하는 것이다. 일반적으로 각각의 환자 CT 스캔은 양성 또는 음성일 수 있는 인스턴스들의 모음(bag of instances)로 생각될 수 있다. 또한, 감염된 영역의 위치를 식별하는 것과 함께 어떤 슬라이드들/인스턴스들이 최종 환자 진단에 기 여하는지를 식별하는 것이 유익할 것이다. 본 개시에서는 환자 CT에 대한 단일의 대표적 특징(feature)을 획득하도록 슬라이스들을 풀링하기 위한 어텐션 기반의 치환-불변(permutation-invariant) MIL 방법을 제안할 것이다. 추가로, 공간 어텐션이 감염 영역을 발견하기 위한 공간적 특징들을 학습하기 위해 함께 적용될 수 있다. 본 개 시의 다중 인스턴스 학습 방법에서는 환자 레벨의 총합 특징과 동일 환자로부터의 인스턴스 특징들이 의미론적 으로 유사하도록 인스턴스 레벨에서 비지도 방식으로 대조 학습을 이용할 수 있다. 이를 위해 학습 모델의 훈련 동안 비지도 방식의 대조 손실이 지도 방식의 손실에 대한 환자 카테고리 레이블들 과 함께 사용될 수 있다. 기존의 상이한 도메인들에 적용되는 MIL을 사용한 작업들은 인스턴스 레벨 학습과 모음 레벨 학습을 2-스텝 프 로시져로 분리시킨다. 예를 들어, 먼저 인스턴스 레벨 인코더들을 학습시키고, MIL 풀링과 함께 훈련된 인코더 들을 사용하여 추론을 위한 총합 모델들을 학습시킨다. 그러나, 인스턴스 레이블들의 불확실성과 노이즈로 인하 여 강인한 인코더를 훈련시키는 것이 도전적인 과제일 수 있다. 따라서, 본 개시에 따른 다중 인스턴스 학습 모델은 종단 학습을 통해 위의 과제를 해결하고, 정확한 환자 레이 블들에만 집중된 모델 최적화와 함께 CT 슬라이스들의 어텐션 기반 풀링을 통해 인스턴스 선택이 달성될 수 있 다. 본 개시에서는 약한 지도 방식의 코로나 폐렴과 세균성 폐렴의 분류(classification)를 위한 신규한 종단간 모 델을 제안하고, MIL 세팅에서 인스턴스 특징들과 환자 레벨 특징들의 대조 학습이 함께 가능하다는 것을 보여준 다. 도 1은 본 개시의 일 실시예에 따른 다중 인스턴스 학습 장치와 다중 인스턴스 학습 모델의 프레임워크를 도시 한다. 본 실시예에서는 흉부 CT 데이터 세트 D = {S1, …, Sn}를 고려하며, 학습 모델은 S × Y로 정의된 결합 분포 (joint distribution)에서 가져온 m 개의 레이블이 지정된 예제 스캔들 의 세트를 수신할 수 잇 다. 여기서, Si는 인스턴스들(예를 들어, 2D CT 슬라이스들 또는 패치들)이 있는 환자 CT 스캔이고, Y는 환자-레벨 레이블들의 레이블 세트로, COVID-19 및 다른 경우의 이진 분류를 위해 {0, 1}으로 나타낼 수 있다. 또한, Si는 S1 = {s1, s2, …, sN}이 있는 인스턴스의 모음(bag)으로 간주될 수 있으며, 여기서 N은 모음의 총 인스턴스 수를 나타낼 수 있다. 각 인스턴스 sn에는 레이블 yn ∈ {0, 1}이 있다고 가정할 수 있지만, 모든 인스턴스가 음성(negative)이거나 양 성(positive)인 것은 아닐 수 있다. 더욱이, 스캔의 모든 슬라이스가 진단에 중요한 감염 영역을 표시하는 것은 아니다. 기타 다른 슬라이스들은 학 습에 유용하지 않은 노이즈가 많은 아티팩트(artifact)일 수 있기 때문이다. 따라서, 본 실시예에서, MIL은 모음(bag) Si가 음성이면 모든 해당 인스턴스가 음성이여야 한다고 가정할 수 있 고, 양성인 모음(bag)의 경우 하나 이상의 인스턴스가 양성일 것이라는 제약 조건을 충족해야 한다. 이는 수학 식 1과 같이 나타낼 수 있다. 수학식 1"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 4, "content": "본 실시예에서 고려되는 모음(bag)의 두 세트들(예를 들어, COVID-19 폐렴 및 기타 폐렴)이 모두 음성 및 양성 인스터스(병변)를 포함하고 있다는 점을 감안할 때 상기의 조건은 엄격하게 적용되지 않을 수도 있다. 따라서, 본 실시예에서는 상기 제약요건의 좀 더 완화된 버전을 고려하고, 내재적(implicitly)으로 인스턴스에 가중치를 부여하여 해당 레이블을 학습하기 위해 어텐션 메커니즘을 적용할 수 있다. 본 실시예에서는, 하나의 종단간(end-to-end) 프레임 워크에서 COVID-19 폐렴과 다른 폐렴 사이의 환자 CT 스캔 레벨에서의 진단을 위한 CNN 모델이 구현되도록 할 수 있다. 본 실시예에서는, 비지도 대조 학습(DA-CMIL)을 이 용한 듀얼 어텐션 다중 인스턴스 학습 심층 모델이 적용될 수 있다. 도 1에서 도시된 바와 같이, 본 실시예에서는, 레이블이 지정되지 않은 인스턴스들을 가지는 CT 스캔을 입력으 로 사용하고, 주요 의미 표현(key semantic representation)을 학습할 수 있다. 또한 본 실시예에서는, 어텐션 기반 풀링 방법을 사용하여 환자 인스턴스들을 최종 예측을 위한 단일 모음(bag) 대표자(representation)로 변 환할 수 있다. 그리고 본 실시예에서, 비지도 대조 학습은 모음(bag)의 인스턴스들이 훈련 중 모음(bag) 대표자와 의미상 유사 하도록 하기 위해 사용될 수 있다. 한편 본 실시예에서 제안하는 프레임 워크에서, 백본 CNN 모델 는 CT 모음(bag)의 j번째 인스턴스를 형상 (shape) C×H×W의 공간 차수(spatial dimension)를 가진 저차원 임베딩 으로 변환하기 위한 특징 맵 추출기로 구현될 수 있다. 여기서, C는 채널의 크기, H는 높이, W는 너비를 나타낼 수 있다. 그리고 본 실시예에서, gij는 공간 대표 특징들을 학습하고, C = 1로 인스턴스 당 1×H*×W* 크기의 공간 어텐션 맵들을 출력하기 위해 공간 어텐션 모듈 에 제공될 수 있다. 이때 획득한 맵들은 주요 영역들을 강조할 수 있으며, 모든 초기 인스턴스들의 특징들에 가중치를 부여하는데 사용되어 단일 공간 풀링 특징 , 을 얻을 수 있다. 여기서, D는 특징 맵의 치수 (dimension size)를 의미할 수 있다."}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 5, "content": "이때, 어텐션 맵과 백본 특징 맵 사이의 요약 연산은 아인슈타인 요약(Einstein Summation)을 통해 달성될 수 있다. 본 실시예에서는, 각 CT 스캔에 대한 인스턴스 특징 을 집계(aggregate)하기 위해, 일관성을 위해 동일한 차 원을 갖는 단일 모음(bag) 표현 , 를 얻기 위해 어텐션 기반 순열 불변 풀링 (permutation invariant pooling)을 수행하는 두번째 모듈 를 구현할 수 있다. 그리고 본 실시예에서, zn은 전체 모음(bag) 에 대한 예측을 얻기 위해 환자 레벨 분류기 로 전 달될 수 있으며, 여기서 는 CT 스캔이 COVID-19 폐렴 또는 기타 폐렴으로 라벨링 될 확률을 의미할 수 있다. 한편, 본 실시예에서는, 수학식 2에 표현된 바와 같이, 교차 엔트로피를 이용하여 모음(bag) 손실 을 사용할 수 있다. 수학식 2"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 6, "content": "듀얼 어텐션 기반 학습 MIL 세팅 하에서 강인한 특징들을 학습하는데 어텐션은 필수적일 수 있다. 특히 어텐션 기반 풀링은 최대 또는 평균과 같은 기존 풀링 방법보다 선호될 수 있는데, 이는 기존 방법이 종단간 모델 업데이트에 있어 미분 가능 하지 않거나(not differentiable), 적용될 수 없기(not applicable) 때문이다. 본 실시예에서는, 각 모듈들(블록들)을 통해 공간 임베딩() 및 잠재 임베딩() 기반 어텐션 풀링을 모두 이용한다. 공간 모듈에서, 입력 가 주어지면, 각각 쌍곡 탄젠트(tanh) 및 시그모이드(sigm) 비선 형성이 뒤 따르는 두 개의 컨볼루션 레이어를 사용할 수 있다. 본 실시예에서, 특징 맵들 gij는 각 모듈에 연속적으로 전달된 다음, 감염의 존재를 나타내는 단일 채널 출력을 갖는 최종 컨볼루션 레이어로 전달될 수 있다. 특히, 본 실시예에서는, 공간 스코어들 을 얻기 위해 최종 레이어에 전달하기 전에 컨볼루션 레이 어(또는 합성곱 계층)들의 각 분기(branch) 출력간에 요소 별 곱셈(element-wise multiplication)을 수행할 수 있다. 다음으로, 공간 스코어들은 소프트 맥스 연산에 의해 정규화될 수 있으며, 이는 높이와 무게 치수 (dimension) 모두에서 총합 행렬 곱셈(예를 들어, , 여기서 이며, 일관성을 위해 를 로 함)을 통해 얻은 최종 공간 풀링 특징 들을 의미할 수 있다. 이때, 본 실시예에서, 초기 백본 특징들에 일반적으로 적용되는 글로벌 평균 풀링(GAP) 대신 게이트 공간 어텐 션(gated spatial attention)을 구현했다는 점에 주목할 필요가 있다. 또한, 초기 정규화된 공간 맵들을 사용하여 모델이 결정을 내리기 위해 집중하는 영역을 시각적으로 보여줄 수 있다. 한편, 본 실시예에서, 특징들 을 집계하기 위해, 인스턴스 어텐션 모듈 에서 어텐션 기반 풀링을 사용할 수 있다. 즉 본 실시예에서는, 인스턴스 임베딩들에 어텐션이 적용되기 때문에 모든 컨볼루션 레이어가 풀리- 커넥티드(fully-connected) 레이어로 대체된다는 점을 제외하고는 초기 백본 특징 맵에서 게이트 공간 어텐션을 위해 이전에 적용된 동일한 아키텍처 디자인을 고려할 수도 있다. 본 실시예에서는, , 를 N개의 인스턴스 특징들이 있는 모음(bag)으로 표현할 수 있다. 그리고 본 실시예에서는, 게이팅 메커니즘(gating mechanism)을 사용한 어텐션 기반 풀링 MIL을 수학 식 3 및 수학식 4와 같이 나타낼 수 있다. 수학식 3 수학식 4"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 7, "content": "여기서, , 및 는 훈련 가능한 파라미터들이다. 그리고 tanh(*)와 sigm(*) 는 요소별 비선형성을 나타낼 수 있으며, 는 요소별 곱셈을 나타낼 수 있다. 또한, an은 전체 모음(bag) 예측 에 대한 주어진 인스턴스의 관련성을 나타내는 인스턴스당 어텐션 점수를 의미할 수 있다. 기술적 관점에서, 어텐션 기반 풀링을 사용하면 인스턴스에 다른 가중치를 할당할 수 있으므로, 명시적 인스턴 스 선택의 필요성이 줄어들 수 있다. 또한 최종 모음(bag) 표현이 더 많은 정보를 줄 수 있다(informative). 즉 본 실시예에서는, 공간 및 어텐션 기반 풀링의 시너지 조합을 통해 강력하고 해석 가능한(interpretable) 특징 들을 학습하기 위한 향상된 훈련을 가능하게 할 수 있다. 대조(contrastive) MIL 도 2는 본 개시의 일 실시예에 따른 다중 인스턴스 학습 세팅에 적용되는 대조 학습을 설명하기 위한 도면이다. 본 실시예에서는, 인스턴스 레벨 특징 맵들의 학습을 향상시키기 위해, 위에서 제시한 MIL 방법에 더하여 비지 도 대비 손실을 통합하여 구현할 수 있다. 본 실시예의 모델은 잠재 공간에서 대조적인 손실값을 통해 동일한 환자의 인스턴스 특징 맵들과 집계된 모음(bag) 특징 맵 간의 합치(agreement)를 최대화하는 표현을 학습할 수 있다. 도 2는 본 실시예에서 적용된 기술의 전체 개념을 도시한다고 할 수 있다. 대조 손실값을 사용하는 이전에 제안된 자가-지도 프레임 워크에 따르면, 확률적 데이터 증강이 2D 데이터 샘플 에 적용되어 동일한 예에 대한 두 개의 상관된 보기를 생성한다. 증강에는 무작위 자르기(random cropping), 색 상 왜곡(color distortion) 및 무작위 가우시안 블러링(random Gaussian bluring) 등이 포함될 수 있다. 또한, 대조 손실값은 레이블이 지정되지 않은 샘플에 대한 대조 예측 작업을 정의하기 위해 적용될 수 있으며, 주어진 샘플에 대해 양성 및 음성 쌍이 식별될 수 있다. 즉 본 실시예에서는 대조 손실이 잠재 공간에 적용되 기 때문에 확률적 데이터 증가가 생략될 수 있다. 또한, 본 실시예에서는, 주어진 환자 CT 스캔에 대해, 각 슬 라이스는 전체 환자 특성의 의사(pseudo) 증강으로 간주될 수 있다. 따라서, 본 실시예에서는, 예를 들어, 동일 한 환자에 대한 다른 관점(view)와 같이, 확률적 증강이 잠재적으로 적용되는 것으로 간주할 수 있다. 본 실시예에서는, z`를 환자의 잠재 인스턴스 레벨 특징으로, z를 위에서 제안된 모듈을 통해 얻은 환자 모음 (bag) 수준 특징으로 나타낼 수 있다. 그리고 z` 및 z 특징들의 l2 정규화 후 대조 손실 함수를 다음 수학식 5와 같이 정의할 수 있다. 수학식 5"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 8, "content": "여기서, 는 1(iff k ≠ i)로 산출되는 인디케이터(indicator) 함수(function)이고, 는 온도 파라미터(temperature parameter)를 나타낼 수 있다. 온도 파라미터는 유사도의 차이가 로스에 반영되는 정도를 조절하는 파라미터이며, 모델의 실시형태에 따라 경험적으로 임의의 숫자를 넣으며 찾아지는 최적변수이다. 그 리고 은 유사도 함수(similarity function)일 수 있으며, 예를 들어, 코사인 유사도(cosine similarity)일 수 있다. 여기서, zi, zj는 i번째 패치(슬라이스)의 특징, j번째 패치(슬라이스)의 특징을 의미할 수 있다. 또한, N은 학습 페이즈에서 정의되는 배치사이즈이며, 도 2와 같이 두 데이터를 함께 비교하는 경 우 배치사이즈가 2N이 되어 시그마에는 2N이 기재될 수 있다. 를 구하기 위해 각 인스턴스들(i=1, …, 총 인스턴스 수)과 각 모음(bag) 레벨 특징 맵들과 비교를 하게 되고 실질적으로 이 비교 값들을 모두 합한 값에 기초하여 가 결정될 수 있다. 손실(loss)은 모든 환자 슬라이스 특징들 및 각각의 모음(bag) 레벨 특징들에 걸쳐 계산될 수 있으며, 본 실시예에서는 미니 배치(mini-batch) 당 증강으로 간주될 수 있다. 본 실시예의 전 체 프레임 워크의 최종 손실 함수(전체 손실 함수)는 다음 수학식 6과 같이 정의할 수 있다. 수학식 6"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 9, "content": "여기서, 는 모음(bag) 손실과 대조 손실의 기여도에 따라 가중치를 부여하는 파라미터이며 0과 1사이의 값이다. 상술한 내용에 대한 자세한 알고리즘은 하기의 알고리즘 테이블을 참조할 수 있다. [알고리즘 테이블]"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 10, "content": "본 실시예에서는 한국, 대구에 위치한 영남 대학 메디컬 센터(YUMC)에서 173개의 샘플들로 구성된 흉부 CT 데이 터세트를 수집하였다. 데이터세트는 2020년 2월에서 4월 사이에 수집된 COVID-19이 있는 환자들에 대한 75개의 CT 샘플들과 세균성 폐렴이 있는 환자들에 대한 98개의 CT 샘플들을 포함한다. 본 실시예에 따른 MIL 프레임워크에서 2D CT 슬라이스 또는 패치들이 인스턴스들로서 사용되며, 슬라이스의 경 우와 패치인 경우 모두에 대해 본 실시예에 따른 학습 모델을 평가한다. 추가로, 3D CT 볼륨 데이터세트는 완전 한 지도학습 세팅들 하에서 3D 기반 방법들을 훈련하고 테스트하기 위해 처리된다. 프리-프로세싱을 위해, 모든 CT 샘플들에 대하여 폐 영역들이 세그먼트화되었다. 이를 위해, 세그멘테이션 훈련 과 추론을 위한 ResNeSt 모델을 이용할 수 있다. 도 3은 본 개시의 일 실시예에 따른 다중 인스턴스 학습 방법에서 프리-프로세싱되는 CT 이미지들의 예시이다. 도 3에서 상부의 이미지들은 프리-프로세싱된 COVID-19 폐렴이 있는 환자의 폐 CT 슬라이스(왼쪽 3개) 및 패치 샘플들(가장 오른쪽 2개)이고, 도 3에서 하부의 이미지들은 프리-프로세싱된 세균성 폐렴이 있는 환자의 폐 CT 슬라이스(왼쪽 3개) 및 패치 샘플들(가장 오른쪽 2개)이다. 모든 데이터세트들은 환자 ID에 의해 훈련, 검증 및 테스팅을 위한 데이터로 분류되었고 각각의 비율은 0.5, 0.1 및 0.4이다. 단지 잘리진 폐 영역들을 이용하는 모든 버전들에서 모든 데이터세트 변종들에 대해 동일한 분 류가 사용되었다. CT 샘플들은 슬라이스들, 패치들 및 3D CT 볼륨 세트들에 있어서 각각 사이즈가 512×512, 128×128 및 256×256×256일 수 있다. 각각의 CT 슬라이스는 512×512에서 256×256으로 리사이징될 수 있고, 패치 슬라이스들은 256 에서 128로 리사이징될 수 있다. 특히, 슬라이스들 세트는 약 14,000 개의 슬라이스들을 포함하고, 패치버전은 64,000개의 패치들을 포함할 수 있으며, 이들은 폐 조직의 30% 이상을 주로 보여줄 수 있 다. 3D CT 볼륨들의 경우, 하나의 환자에 속하는 모든 슬라이스들은 희망하는 입력 사이즈들을 획득하도록 적용 되는 최근접 이웃 샘플링(nearest neighbor smapling)을 이용하여 볼륨을 구축하는데 사용될 수 있다. 본 개시의 모델은 Pytorch에서 구현될 수 있다. ImageNet 사전훈련 가중치로부터 미세조종된 ResNet-34가 모음 분류기 로 이용되는 단일 풀리-커넥티드 레이어와 함께 특징 추출 모듈 로 사용될 수 있다. 피쳐들의 차 원은 512로 고정될 수 있고 이는 C=512인 512×8×8을 가지는 로부터 획득되는 피쳐 맵들을 포함할 수 있다. 공간 풀링에 이어서, 피쳐들은 512로 다시 리쉐이핑될 수 있다. 본 실시예에 따른 방법의 효과를 평가하기 위해서, DeepAttention MIL, ClassicMIL 및 JointMIL과 같은 최근 MIL 기반 방법들과의 비교가 이루어진다. 또한, 최근 3D 기반 방법인 DeCovNet 및 Zhang3DCNN도 비교에 포함된 다. 대중적으로 이용가능한 구현들이 사용된 3D 방법들 외에는 공정한 평가를 위해, 동일한 백본 특징 추출기가 사용된다. 본 개시의 실시예에 따라 제안된 방법의 정량적이고 정성적인 결과들이 이하에서 제시된다. 또한, 모음의 크기, 대조 학습이 있거나 없는 경우의 어텐션 모듈들, 가중치 파라미터 의 효과들에 대한 절삭 연구들이 이루어진 다. 표 1은 본 개시의 실시예에 따라 대조 손실 를 가지는 DA-CMIL이 98.6%의 정확도 및 98.4%의 AUC(Area Under the curve)로 최고의 전체 성능을 달성함을 보여준다. 훈련 중에 가 적용되지 않는 경우에도, 본 개 시의 실시예에 따른 모델이 93%(JointMIL 비교 +2.9)의 정확도 및 93.4%(JointMIL 비교 +2.5)의 AUC를 보여주 어 가장 우수한 약한 방식의 지도학습 방법인 JointMIL보다 우수함을 알 수 있다. 표 1"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 11, "content": "본 개시의 실시예에 따른 방법을 더 검증하기 위해 DA-CMIL을 CT 샘플들의 랜덤하게 잘라진 패치들에 적용할 수 있다. 표 2를 참고하면 패치들의 경우에도 비교 방법들보다 본 개시의 실시예에 따른 DA-CMIL 방법이 더 우수한 성능을 지속적으로 보인다는 것을 알 수 있다.표 2"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "item": 12, "content": "도 4는 본 개시의 일 실시예에 따른 다중 인스턴스 학습 모델과 다른 학습 모델들의 특성을 비교하는 그래프를 도시한다. 도 4는 서로 다른 데이터세트들 상에 비교되는 방법들의 수신측 동작 특성(receiver operating characteristic: ROC) 커브들을 도시한다. 도 5는 본 개시의 일 실시예에 따른 다중 인스턴스 학습 모델과 다른 학습 모델들의 예측 성능을 비교하는 그래프를 도시한다. 도 6은 본 개시의 다른 실시예에 따른 다중 인스턴스 학습 모델과 다른 학습 모델들의 예측 성능을 비교하는 그래프를 도시한다. 도 4를 살펴보면, 전체적으로 본 개시의 실시예에 따른 방법이 모든 세팅들에서 더 높은 TPR(True Positive Rate), 더 낮은 FPR(False Positive Rate)을 보인다. 이는 도 5 및 도 6에서 나타나는 비교 방법들에 대한 혼"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 13, "content": "동 행렬들의 요약들에서도 증명될 수 있다. 도 5 및 도 6에서 CP(Common Pneumonia)는 일반적인 폐렴을 의미하 고, 본 실시예에서는 세균성 폐렴을 의미할 수 있으며, NCP는 COVID-19 폐렴을 의미한다. 모음 사이즈, 가중치 파라미터 , 및 학습상 이중 어텐션 모듈의 효과 본 개시의 실시예에 따른 방법의 훈련 동안 모음 사이즈(bag size)의 효과를 평가하기 위해 각각의 모음이 최대 k개의 인스턴스들(슬라이스들/패치들)로 구성되는 경우 k를 변화시키면서 모음을 구성하고 절삭 연구를 수행할 수 있다. 표 3에서 도시된 바와 같이 모음 사이즈가 증가할수록 DA-CMIL 성능도 향상하는 것을 알 수 있다. 표 3"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 14, "content": "DA-CMIL은 손실들의 효과를 균형잡기 위하여 가중치 파라미터 를 가지는 다중 인스턴스들의 대조 특징 학습을 이용할 수 있다. 표 4를 참조하면, 가중치 파라미터 =1.0인 경우, 즉 를 사용하지 않는 경우, 는 학 습에서 아무런 효과도 가지지 못하며 를 사용하는 경우에 비해 93%의 더 낮은 성능을 보인다. 표 4"}
{"patent_id": "10-2021-0051331", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 15, "content": "본 실시 예의 프레임워크에서, 어텐션의 효과를 평가하기 위해 대조 모듈과 어텐션 모듈이 모두 사용되거나 사 용되지 않는 여러 설정을 고려할 수 있다(표 1 및 표 2 참조) 본 실시예의 프레임 워크에서, 어텐션을 제외하면 다음과 같은 두 가지 측면에서 수정이 필요할 수 있다. 공간 어텐션 기반 특징 맵()의 풀링 없이, 단순성을 위해 인스턴스 특징 맵의 글로벌 평균 풀링(GAP)을 기 본으로 사용하고, ( )를 통한 어텐션 기반 모음(bag) 레벨 특징의 집계(aggregation) 없이, 인스턴스 특징들의 평균을 사용하여 z`와 함께 전체 모음(bag) 수준 특징 z를 얻을 수 있다. 이러한 수정 후 평가를 보다 쉽게 수행할 수 있을 것이다. 분명히, 와 가 학습의 일부일 때 최고의 성능을 달성함을 확인할 수 있다. 반면에 어텐션 모듈을 제외 하면 전체 성능이 현저히 감소함을 확인할 수 있다(최고 성능 방법에 비해 -20%). 그리고 유사한 성능 저하가 CT 패치 데이터 세트에서도 나타날 수 있다. 어텐션 모듈 없이 대조 특징 손실만 사용하면 비교 방법에 비해 성능 향상 없이 결과가 악화됨을 확인할 수 있 다. 이것은 본 실시예의 기술의 조합(즉, 어텐션과 특징 맵 손실 모두)이 이점이 있음을 확인할 수 있으며, 보 완 학습을 통해 개선된 결과가 나타남을 확인할 수 있다. 정성적 결과 도 7은 본 개시의 실시예에 따른 다중 인스턴스 학습 모델에서 도출되는 공간 어텐션 맵과 인스턴스 어텐션 스 코어를 도시한다 도 7을 참조하면, 공간 어텐션 맵들과 어텐션 스코어 각각을 기반으로 정성적 결과를 확인할 수 있다. 이는 DA- CMIL이 거친 맵들(coarse map)을 사용하여 감염된 영역과 관련된 주요 슬라이스를 찾을 수 있음을 보여줄 수 있 다. 이때 감염된 영역이 없는 노이즈가 많은 슬라이스들/아티팩트들과 같은 슬라이스들에 대해 낮은 어텐션 스 코어가 관찰되어 본 실시예의 방법의 유용성을 더 나타낼 수 있다. 또한, 어텐션 맵들은 임상 결과와 일치하는 간유리음영(ground-glass opacities) 및 강화(consolidations)와 같은 주요 영역에 중점을 둔다는 것을 확인할 수 있다. 또한, 대조 학습이 적용되지 않는 경우 어텐션 맵을 강조 표시할 수 있다. 일반적으로 결과들은 손실이 적용된 경우와 유사한 맵을 보여줄 수 있다. 그러나, 일부 CT 슬라이스의 경우 공간 맵과 스코어 모두 약간의 변화가 있는 반면, 주요 영역의 국소화는 특히 어텐션 스코어의 큰 차이로 인해 저하됨을 볼 수 있다. 이는 대조 손실이 피사체의 대표적인 특징 간의 유사성을 장려하기 위한 것이기 때문인 것으로 크게 예측될 수 있다. 두 손실을 모두 사용하는 이점은 분류 성능의 정량적 평가를 통해 더 잘 검증될 수 있다. 즉 본 실시예의 어텐션 메커니즘은 두 경우 모두에서 관련이 있으며 임상 평가에 매우 유용하게 적용될 수 있다. 하엽(lower lobes)의 측면(lateral)의 다 초점(multi-focal) 간유리음영(ground-glass opacities, GGO)은 CT에 서 가장 일반적인 초기 발견이며, 흉막 비후와 같은 다른 특성은 심각도 단계에 따라 영상 발현에서 덜 일반적 으로 관찰될 수 있다. 이것은 대부분의 공간 어텐션 맵이 주로 낮은 영역에 집중되어 있는 것과 일치할 수 있다. 일반적으로 CAM(Class Activation Maps)은 해결 문제로 인해 정확한 병변 위치를 나타내지 않을 수 있다. 더욱 이, 본 실시예에서는, 특히 약하게 감독되는(weakly supervised) 설정에서, 실제 병변 위치에 접근하지 않으면 조직이 제한된 맵을 생성하도록 모델을 강제하는 것(enforcing)이 어려울 수 있다. 본 실시예에서는, 맵이 조직 영역으로만 정규화되는 경우에도 현재 결과에 확신을 가지고 있으며, 고밀도 영역 은 병변 및/또는 GGO에 해당하는 임상적으로 관련된 영역임이 분명할 수 있다. RT-PCR은 COVID-19 진단의 표준 방법이지만, 테스트하는데 걸리는 시간이 길어 결과를 얻기까지 많은 시간이 소 요될 수 있다. 따라서 몇 분 안에 결과를 얻을 수 있는 CT를 통한 검사 방법은, 테스트 방법에 대한 합리적인 대안으로 간주될 수 있다. 이에, 본 실시예에서는, 임상적 의미(clinical implication)와 함께 약한 감독(weak supervision) 하에서 COVID-19 진단을 위한 딥러닝(CNN)에 대한 새로운 접근 방식을 구현할 수 있다. 신속한 평가를 위해서는 실제 환경에서 완전히 자동화되고 해석 가능한 방법을 사용하는 것이 중요하다. 더욱이 COVID-19와 다른 폐렴은 굉장 히 미세한 차이가 있어 현장 전문가들도 구분하기 어렵기 때문에, 영상 특성 측면에서 정확한 진단이 매우 중요 하다. 본 실시예의 방법은, 종래의 방법에서 일반적인 것처럼 병변 감염된 관심 영역 없이 환자 진단 레이블만 사용할 수 있는 데이터 세트를 통해 평가될 수 있다. 또한 상술하는 본 실시예의 접근 방식을 더욱 검증하기 위해, 본 실시예에서는, 어텐션 스코어와 함께 거친 (coarse) 어텐션 맵을 통해 모델이 초점을 맞춘 영역을 질적으로 확인할 수 있다. 본 실시예의 방법은 98.4 % 의 AUC, 98.6 %의 정확도 및 96.8 %의 TPR(true positive rate)을 달성함을 확인할 수 있다. 또한, 본 실시예 에서, 획득한 어텐션 맵은 주요 조각에 해당하는 어텐션 스코어와 함께 대부분의 샘플에서 주요 감염 영역을 강 조 표시할 수 있다. 또한, 본 실시예에서는 환자 레이블의 감독 학습을 보완하기 위해 비지도 대조 손실을 사용하는 이점을 경험적 으로 보여줄 수 있으며, 더 복잡한 방법을 위한 기반이 될 수 있다. 또한, 본 실시예의 방법은 3D 기반 방법을 크게 능가함을 확인할 수 있다. 이는 대규모 코호트를 사용하여 수집한 3D CT 볼륨 데이터 세트의 제한된 크기 때문일 수 있다. 또한, DeCovNet는 처음부터 학습되었으며 맞춤형 심층 아키텍처를 갖추고 있기 때문에 성능이 떨어짐을 확인할 수 있다. 그리고, ZhangCNN의 성능은 나중(the later)보다 상당히 향상되었지만 모델이 더 많은 시간 동안 훈련되어도 여 전히 비슷한 성능을 얻지 못했음을 확인할 수 있다. 즉, COVID-19와 세균성 폐렴이 유사한 특성을 나타내기 때문에 기존의 광범위한 증강으로 훈련된 모델이 평가 지표 전반에서 상당한 개선을 달성하지 못했다는 점에 주목할 필요가 있다. 도 8은 본 개시의 실시예에 따른 다중 인스턴스 학습 모델에서의 임베딩 공간에 표현된 CT 슬라이스들을 도시한 다. 단일 주제에 대한 전체 통계를 캡처할 때, 본 실시예의 기술의 이점을 추가로 보여주기 위해 도 8은 2D 공간에 표시된 인스턴스와 대표적인 특징을 도시하였다. 특히 집계된 특징 맵(그림의 왼쪽 상단: 파란색 점)은 함께 잘 클러스터링 된 다른 슬라이스의 잡음이 있는 아티팩트를 무시하는 중요한(key) 슬라이스(빨간색)의 기능을 캡처 할 수 있다. 이는 인스턴스 검색에 명시적인 레이블이 사용되지 않지만 본 실시예의 모델은 환자 분류에 유용한 슬라이스를 효과적으로 학습할 수 있음을 보여줄 수 있다. 본 실시예에서는, 흉부 CT에서 COVID-19와 세균성 폐렴의 서브 타입(sub-type)을 구별하기 위해 다중 인스턴스 학습(MIL) 프레임 워크 하에서 이중 어텐션 모듈과 대조 특징 맵 학습이 포함된 2D CNN 프레임 워크를 적용할 수 있다. CT 패치 및 슬라이스 기반 데이터 세트 버전 모두에서 본 실시예의 방법에 대한 성능을 확인할 수 있 다. 또한 절삭(ablation) 실험은 훈련 중에 큰 모음(bag) 크기를 사용하는 이점과 안정적인 학습을 위한 가중치 손실의 효과를 보여줄 수 있다. 따라서 본 실시예에서는, COVID-19 검사를 위해 약하게 감독되는(weakly supervised) 방법에 기반한 다중 인스턴스 학습을 통해 보다 정확하게 COVID-19와 세균성 페렴을 구별할 수 있 다. 도 9는 본 개시의 실시예에 따른 다중 인스턴스 학습 모델의 학습 방법을 설명하는 순서도를 도시한다. 본 개시의 실시예에 따른 3D 이미지 분석을 위한 다중 인스턴스 학습 방법은 컴퓨팅 장치 또는 컴퓨팅 네트워크 에서 적어도 하나의 프로세서에 의해 수행될 수 있다. 도 1을 참고하면, 본 개시의 실시예에 따른 다중 인스턴스 학습 방법은 다중 인스턴스 학습 장치의 프로세 서에 의해 수행될 수 있다. 다중 인스턴스 학습 장치는 프로세서와 메모리를 포함할 수 있으며, 메모리에는 다중 인스 턴스 학습 모델 및 여러 명령어들이 저장되어 있을 수 있다. 도 1에서는 하나의 메모리만 개시되었으나, 다중 인스턴스 학습 모델이 저장된 메모리와 여러 명령어들이 저장된 메모리는 별도로 구성될 수도 있다. 본 개시의 실시예에 따른 다중 인스턴스 학습 방법에 따르면, 프로세서는 다중 인스턴스 학습 모델에 입력 되는 3D 이미지의 2D 인스턴스들(instances) 각각의 특징 맵(Feature Map)을 도출할 수 있다(S100). 이러한 특 징 맵 도출을 위한 블록 또는 모듈은 합성곱 레이어(컨볼루션 레이어)를 포함할 수 있으며, 합성곱 모듈 또는 블록이라고 지칭될 수 있다. 프로세서는 합성곱 블록으로부터 도출된 상기 특징 맵으로부터 상기 인스턴스들의 공간 어텐션 맵(Spatial Attention Map)을 도출할 수 있다(S200). 이러한 공간 어텐션 맵을 도출하는 블록 또는 모듈은 공간 어텐션 블 록이라고 지칭될 수 있다. 공간 어텐션 맵은 각각의 인스턴스에서 본 모델이 판단하고자 하는 바를 분석하기 위 해 강조되어야 할 부분이 어디인지를 판단할 수 있다. 다만, 초기 공간 어텐션 블록의 파라미터는 랜덤하게 정 해질 수 있으나, 상술된 바와 같은 훈련 과정을 거치면서 최적화될 수 있다.이후, 프로세서는 특징 맵과 공간 어텐션 맵의 합성 결과를 입력 받아 인스턴스마다의 어텐션 스코어를 도 출할 수 있다(S300). 여기서, 특정 맵과 공간 어텐션 맵의 합성은 요소별 곱셈(element-wise multiplication) 일 수 있다. 또한, 프로세서는 어텐션 스코어에 따라 인스턴스들의 임베딩들(embeddings)을 종합하여 (aggregate) 3D 이미지에 대한 총합 임베딩(aggregated embedding)을 도출할 수 있다(S400). 이러한 동작들은 인스턴스 어텐션 블록(또는 잠재 어텐션 블록)에 의해 수행될 수 있다. 다만, 초기 인스턴스 어텐션 블록의 파 라미터는 랜덤하게 정해질 수 있으나, 상술된 바와 같은 훈련 과정을 거치면서 최적화될 수 있다. 프로세서는 총합 임베딩에 기초하여 상기 3D 이미지에 대한 분석 결과를 출력할 수 있다(S500). 여기서, 분석 결과는 상술된 바와 같이 CT 스캔 이미지가 COVID-19으로 인한 폐렴을 나타내는지 다른 질병으로 인한 폐 렴을 나타내는지가 될 수도 있고, 기타 다른 질병 또는 이미지가 나타내는 의미가 될 수 있음은 물론이다. 이 러한 출력은 출력 블록에 의해 수행될 수 있다. 한편, 다중 인스턴스 학습 모델의 훈련 과정에서는 입력되는 2D 인스턴스의 3D 이미지가 실제값(Ground- Truth)로 레이블링된 데이터일 수 있다. 여기서, 레이블링은 3D 이미지에만 모음(bag) 레벨에서 이루어진 것이 고, 각각의 2D 슬라이스에는 레이블링이 이루어되지 않은 상태이다. 상술된 바와 같이 3D 이미지가 COVID-19 폐 렴으로 레이블링된 이미지라 하더라도 2D 인스턴스 중 일부는 COVID-19 폐렴의 병변을 전혀 나타내지 않을 수 있다. 프로세서는 다중 인스턴스 학습 모델을 훈련시키기 위해 레이블링된 3D 이미지를 포함하는 훈련 데이터를 이용하여 다중 인스턴스 학습 모델 전체 손실 함수값이 최소가 되도록 학습을 수행할 수 있다(S600). 여기서, 학습을 수행한다는 것은 다중 인스턴스 학습 모델의 전체 손실 함수(L)가 최소값을 가지도록 특징 맵을 도출하는 단계, 공간 어텐션 맵을 도출하는 단계, 어텐션 스코어를 도출하는 단계, 총합 임베딩을 도출하는 단 계에서 사용되는 블록들에서 설정된 파라미터들을 조정하는 것을 의미할 수 있다. 한편, 전체 손실 함수는 상기 출력 블록의 결과에 대한 모음 레벨(Bag Level)의 손실 함수(LB) 및 상기 인스턴 스 임베딩들과 상기 총합 임베딩 사이의 대조 손실 함수(LF)의 조합일 수 있다. 상술된 바와 같이, 본 개시에서는 공간적인 어텐션 구조와 인스턴스 어텐션 구조를 동시에 활용하여 중요한 인 스턴스와 함께 인스턴스 내부에서 어떤 부분이 분류에 주요한 역할을 하는지를 자동으로 추출해줄 수 있는 기법 을 제안하였다. 또한 대조손실(contrastive loss) 함수를 모음 레벨 손실함수와 함께 최소화시키는 방향으로 학습을 수행함으로 써 인스턴스를 대표하는 임베딩과 각 인스턴스들간의 구분이 잘 이루어지도록 딥러닝 네트워크를 학습한다. 제 안하는 기법을 사용하게 되면 모음 레벨 분류성능을 높여주기 위한 인스턴스들이 잘 선택되고 선택된 인스턴스 들의 클래스 내 변형은 줄어들고, 다른 클래스의 인스턴스들의 거리는 커지도록 특징들이 임베딩되게 된다. 따라서, 이렇게 추출된 특징들을 바탕으로 최종 백레벨 분류를 수행하였을 때 보다 우수한 결과를 얻을 수 있다. 또한, 공간적인 어텐션 구조와 인스턴스 레벨 어텐션 구조를 하나의 네트워크에 사용함으로써 영상단위 레이블만 가지고도 이상병변 부위를 보다 정확하게 찾아낼 수 있음을 정성적으로 확인할 수 있었다. 이상 설명된 본 발명에 따른 실시예는 컴퓨터 상에서 다양한 구성요소를 통하여 실행될 수 있는 컴퓨터 프로그 램의 형태로 구현될 수 있으며, 이와 같은 컴퓨터 프로그램은 컴퓨터로 판독 가능한 매체에 기록될 수 있다. 이 때, 매체는 하드 디스크, 플로피 디스크 및 자기 테이프와 같은 자기 매체, CD-ROM 및 DVD와 같은 광기록 매체, 플롭티컬 디스크(floptical disk)와 같은 자기-광 매체(magneto-optical medium), 및 ROM, RAM, 플래시 메모리 등과 같은, 프로그램 명령어를 저장하고 실행하도록 특별히 구성된 하드웨어 장치를 포함할 수 있다. 한편, 상기 컴퓨터 프로그램은 본 발명을 위하여 특별히 설계되고 구성된 것이거나 컴퓨터 소프트웨어 분야의 당업자에게 공지되어 사용 가능한 것일 수 있다. 컴퓨터 프로그램의 예에는, 컴파일러에 의하여 만들어지는 것 과 같은 기계어 코드뿐만 아니라 인터프리터 등을 사용하여 컴퓨터에 의해서 실행될 수 있는 고급 언어 코드도 포함될 수 있다. 본 발명의 명세서(특히 특허청구범위에서)에서 \"상기\"의 용어 및 이와 유사한 지시 용어의 사용은 단수 및 복수 모두에 해당하는 것일 수 있다. 또한, 본 발명에서 범위(range)를 기재한 경우 상기 범위에 속하는 개별적인 값 을 적용한 발명을 포함하는 것으로서(이에 반하는 기재가 없다면), 발명의 상세한 설명에 상기 범위를 구성하는 각 개별적인 값을 기재한 것과 같다.본 발명에 따른 방법을 구성하는 단계들에 대하여 명백하게 순서를 기재하거나 반하는 기재가 없다면, 상기 단 계들은 적당한 순서로 행해질 수 있다. 반드시 상기 단계들의 기재 순서에 따라 본 발명이 한정되는 것은 아니 다. 본 발명에서 모든 예들 또는 예시적인 용어(예들 들어, 등등)의 사용은 단순히 본 발명을 상세히 설명하기 위한 것으로서 특허청구범위에 의해 한정되지 않는 이상 상기 예들 또는 예시적인 용어로 인해 본 발명의 범위 가 한정되는 것은 아니다. 또한, 당업자는 다양한 수정, 조합 및 변경이 부가된 특허청구범위 또는 그 균등물의 범주 내에서 설계 조건 및 팩터에 따라 구성될 수 있음을 알 수 있다. 이상에서 본 발명에 따른 실시예들이 설명되었으나, 이는 예시적인 것에 불과하며, 당해 분야에서 통상적 지식 을 가진 자라면 이로부터 다양한 변형 및 균등한 범위의 실시예가 가능하다는 점을 이해할 것이다. 따라서, 본 발명의 진정한 기술적 보호 범위는 다음의 청구범위에 의해서 정해져야 할 것이다."}
{"patent_id": "10-2021-0051331", "section": "도면", "subsection": "도면설명", "item": 1, "content": "도 1은 본 개시의 일 실시예에 따른 다중 인스턴스 학습 장치와 다중 인스턴스 학습 모델의 프레임워크를 도시 한다. 도 2는 본 개시의 일 실시예에 따른 다중 인스턴스 학습 세팅에 적용되는 대조 학습을 설명하기 위한 도면이다. 도 3은 본 개시의 일 실시예에 따른 다중 인스턴스 학습 방법에서 프리-프로세싱되는 CT 이미지들의 예시이다. 도 4는 본 개시의 일 실시예에 따른 다중 인스턴스 학습 모델과 다른 학습 모델들의 특성을 비교하는 그래프를 도시한다. 도 5는 CT 슬라이스 데이터세트에서 본 개시의 일 실시예에 따른 다중 인스턴스 학습 모델과 다른 학습 모델들 의 예측 성능을 비교하는 그래프를 도시한다. 도 6은 CT 패치 데이터세트에서 본 개시의 다른 실시예에 따른 다중 인스턴스 학습 모델과 다른 학습 모델들의 예측 성능을 비교하는 그래프를 도시한다. 도 7은 본 개시의 실시예에 따른 다중 인스턴스 학습 모델에서 도출되는 공간 어텐션 맵과 인스턴스 어텐션 스 코어를 도시한다. 도 8은 본 개시의 실시예에 따른 다중 인스턴스 학습 모델에서의 임베딩 공간에 표현된 CT 슬라이스들을 도시한 다. 도 9는 본 개시의 실시예에 따른 다중 인스턴스 학습 모델의 학습 방법을 설명하는 순서도를 도시한다."}
