{"patent_id": "10-2022-0184659", "section": "특허_기본정보", "subsection": "특허정보", "content": {"공개번호": "10-2024-0102535", "출원번호": "10-2022-0184659", "발명의 명칭": "방사선 촬영에 의해 획득된 영상에 포함된 노이즈를 저감하기 위한 영상 처리 방법 및 장치", "출원인": "주식회사 디알텍", "발명자": "신철우"}}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_1", "content": "방사선 촬영에 의해 얻어지는 영상에 대해 순환 필터링 방식으로 노이즈 저감 처리를 수행하는 영상 처리 장치에 있어서,상기 방사선 촬영에 의해 얻어진 프레임 별 영상을 입력받는 영상 입력 유닛,현재 프레임 영상과 이전 프레임 영상의 차분에 의해 얻어진 차분 맵의 각 픽셀에 대한 모션 감지 정보를 포함하는 모션 맵을 생성하는 모션 맵 생성 유닛,상기 생성된 모션 맵과 이전 프레임까지 누적된 모션 맵을 기초로 누적 모션 맵을 생성하는 누적 모션 맵 생성유닛,상기 누적 모션 맵의 각 픽셀에 대해 상기 각 픽셀의 모션 확률을 나타내는 통계값을 할당하여 형성되는 통계값맵을 생성하는 통계값 맵 생성 유닛, 그리고상기 누적 모션 맵을 기초로 상기 현재 프레임 영상과 상기 이전 프레임의 출력 영상을 혼합하여 상기 현재 프레임의 출력 영상을 생성하는 출력 영상 생성 유닛을 포함하는 영상 처리 장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_2", "content": "제1항에 있어서,상기 모션 맵 생성 유닛은 상기 통계값 맵을 활용하여 상기 모션 맵을 생성하도록 구성되는 영상 처리 장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_3", "content": "제1항에 있어서,상기 모션 맵 생성 유닛은상기 현재 프레임 영상과 상기 이전 프레임 영상의 차분에 의해 상기 차분 맵을 생성하는 차분 맵 생성 유닛,그리고상기 차분 맵의 각 픽셀의 픽셀값에 대한 임계값 처리를 통해 상기 각 픽셀의 상기 모션 감지 정보를 포함하는상기 모션 맵을 생성하는 임계값 처리 유닛을 포함하는 영상 처리 장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_4", "content": "제3항에 있어서,상기 임계값 처리 유닛은 상기 통계값 맵의 통계값의 크기에 따라 크기가 변하는 적응적 임계값을 통해 상기 차분 맵의 임계값 처리를 수행하도록 구성되는 영상 처리 장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_5", "content": "제3항에 있어서,상기 임계값 처리 유닛은 상기 통계값 맵의 대응하는 픽셀의 상기 통계값이 나타내는 모션 확률이 클수록 상기임계값 처리를 위한 상기 각 픽셀의 임계값을 낮게 설정하도록 구성되는 영상 처리 장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_6", "content": "제1항에 있어서,상기 통계값 맵 생성 유닛은 상기 누적 모션 맵의 각 픽셀을 포함하는 복수의 픽셀을 포함하는 픽셀 마스크의단위로 상기 통계값을 산출하여 상기 각 픽셀의 통계값으로 할당하여 상기 통계값 맵을 생성하도록 구성되는 영공개특허 10-2024-0102535-3-상 처리 장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_7", "content": "제6항에 있어서,상기 통계값은 상기 픽셀 마스크의 복수의 픽셀의 픽셀값의 엔트로피, 분산 또는 표준편차인 영상 처리 장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_8", "content": "제1항에 있어서,상기 출력 영상 생성 유닛은 상기 통계값 맵을 이용하여 갱신된 누적 모션 맵을 기초로 상기 현재 프레임 영상과 상기 이전 프레임의 출력 영상을 혼합하는 비율을 결정하도록 구성되는 영상 처리 장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_9", "content": "제8항에 있어서,상기 누적 모션 맵 생성 유닛은 상기 통계값 맵에 대해 임계치 처리를 수행하고 상기 임계치 처리된 통계값 맵을 이용하여 상기 누적 모션 맵의 픽셀들의 픽셀값을 선택적으로 증감하여 상기 누적 모션 맵을 갱신하도록 구성되는 영상 처리 장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_10", "content": "제1항에 있어서,상기 차분 맵은 상기 현재 프레임 영상과 이전 프레임들 중 하나 이상의 영상을 이용하여 얻어지는 영상 처리장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_11", "content": "제1항에 있어서,상기 이전 프레임 영상은 상기 이전 프레임의 출력 영상인 영상 처리 장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_12", "content": "제1항에 있어서,상기 누적 모션맵 생성 유닛은 상기 통계값 맵을 이용하여 상기 누적 모션 맵을 갱신하도록 구성되는 영상 처리장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_13", "content": "제12항에 있어서,상기 출력 영상 생성 유닛은 상기 갱신된 누적 모션 맵을 기초로 상기 현재 프레임 영상과 상기 이전 프레임의출력 영상을 혼합하는 비율을 결정하도록 구성되는 영상 처리 장치."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_14", "content": "방사선 촬영에 의해 얻어지는 영상에 대해 순환 필터링 방식으로 노이즈 저감 처리를 수행하는 영상 처리 방법에 있어서,상기 방사선 촬영에 의해 얻어진 프레임 별 영상을 입력받는 단계,현재 프레임 영상과 이전 프레임 영상의 차분에 의해 얻어진 차분 맵의 각 픽셀에 대한 모션 감지 정보를 포함하는 모션 맵을 생성하는 단계,상기 생성된 모션 맵과 이전 프레임까지 누적된 모션 맵을 기초로 누적 모션 맵을 생성하는 단계,상기 누적 모션 맵의 각 픽셀에 대해 상기 각 픽셀을 포함하는 복수의 픽셀의 모션 확률을 나타내는 통계값을할당하여 형성되는 통계값 맵을 생성하는 단계, 그리고공개특허 10-2024-0102535-4-상기 누적 모션 맵을 기초로 상기 현재 프레임 영상과 상기 이전 프레임의 출력 영상을 혼합하여 상기 현재 프레임의 출력 영상을 생성하는 단계를 포함하는 영상 처리 방법."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_15", "content": "제14항에 있어서,상기 모션 맵을 생성하는 단계에서 상기 모션 맵은 상기 통계값 맵을 활용하여 생성되는 영상 처리 방법."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_16", "content": "제14항에 있어서,상기 모션 맵 생성 단계에서 상기 차분 맵의 각 픽셀의 픽셀값에 대한 임계값 처리를 통해 상기 각 픽셀의 상기모션 감지 정보를 포함하는 상기 모션 맵이 생성되고, 상기 임계값 처리는 상기 통계값 맵의 통계값의 크기에따라 크기가 변하는 적응적 임계값을 통해 수행되도록 구성되는 영상 처리 방법."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_17", "content": "제14항에 있어서,상기 모션 맵 생성 단계에서 상기 차분 맵의 각 픽셀의 픽셀값에 대한 임계값 처리를 통해 상기 각 픽셀의 상기모션 감지 정보를 포함하는 상기 모션 맵이 생성되고, 상기 임계값 처리를 위한 상기 각 픽셀의 임계값은 상기통계값 맵의 대응하는 픽셀의 상기 통계값이 나타내는 모션 확률이 클수록 낮게 설정되는 영상 처리 방법."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_18", "content": "제14항에 있어서,상기 통계값 맵 생성 단계에서 상기 통계값 맵은 상기 누적 모션 맵의 각 픽셀을 포함하는 복수의 픽셀을 포함하는 픽셀 마스크의 단위로 상기 통계값을 산출하여 상기 각 픽셀의 통계값으로 할당하여 생성되는 영상 처리방법."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_19", "content": "제14항에 있어서,상기 통계값은 상기 픽셀 마스크의 복수의 픽셀의 픽셀값의 엔트로피, 분산 또는 표준편차인 영상 처리 방법."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_20", "content": "제14항에 있어서,상기 출력 영상을 생성하는 단계는상기 통계값 맵을 이용하여 상기 누적 모션 맵을 갱신하는 단계, 그리고상기 갱신된 누적 모션 맵을 기초로 상기 현재 프레임 영상과 상기 이전 프레임의 출력 영상을 혼합하는 비율을결정하는 단계를 포함하는 영상 처리 방법."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_21", "content": "제20항에 있어서,상기 누적 모션 맵을 갱신하는 단계에서, 상기 통계값 맵에 대해 임계치 처리를 수행하고 상기 임계치 처리된통계값 맵을 이용하여 상기 누적 모션 맵의 픽셀들의 픽셀값을 선택적으로 증감하여 상기 누적 모션 맵을 갱신하도록 구성되는 영상 처리 방법."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_22", "content": "제14항에 있어서,상기 차분 맵은 상기 현재 프레임 영상과 이전 프레임들 중 하나 이상의 영상을 이용하여 얻어지는 영상 처리공개특허 10-2024-0102535-5-방법."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_23", "content": "제14항에 있어서,상기 차분 맵은 상기 현재 프레임 영상과 이전 프레임의 출력 영상의 차분에 의해 얻어지는 영상 처리 방법."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_24", "content": "제14항에서,상기 통계값 맵을 이용하여 상기 누적 모션 맵을 갱신하는 단계를 더 포함하는 영상 처리 방법."}
{"patent_id": "10-2022-0184659", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_25", "content": "제24항에서,상기 출력 영상을 생성하는 단계에서, 상기 현재 프레임 영상과 상기 이전 프레임의 출력 영상을 혼합하는 비율은 상기 갱신된 누적 모션 맵을 기초로 결정되는 영상 처리 방법."}
{"patent_id": "10-2022-0184659", "section": "발명의_설명", "subsection": "요약", "paragraph": 1, "content": "방사선 촬영에 의해 얻어지는 영상에 대해 순환 필터링 방식으로 노이즈 저감 처리를 수행하는 영상 처리 장치는 상기 방사선 촬영에 의해 얻어진 프레임 별 영상을 입력받는 영상 입력 유닛, 현재 프레임 영상과 이전 프레임 영상의 차분에 의해 얻어진 차분 맵의 각 픽셀에 대한 모션 감지 정보를 포함하는 모션 맵을 생성하는 모션 맵 생성 유닛, 상기 생성된 모션 맵과 이전 프레임까지 누적된 모션 맵을 기초로 누적 모션 맵을 생성하는 누적 모 션 맵 생성 유닛, 상기 누적 모션 맵의 각 픽셀에 대해 상기 각 픽셀의 모션 확률을 나타내는 통계값을 할당하여 형성되는 통계값 맵을 생성하는 통계값 맵 생성 유닛, 그리고 상기 누적 모션 맵을 기초로 상기 현재 프레임 영 상과 상기 이전 프레임의 출력 영상을 혼합하여 상기 현재 프레임의 출력 영상을 생성하는 출력 영상 생성 유닛 을 포함한다."}
{"patent_id": "10-2022-0184659", "section": "발명의_설명", "subsection": "기술분야", "paragraph": 1, "content": "본 발명은 방사선 촬영에 의해 획득된 영상에 포함된 노이즈를 저감하기 위한 영상 처리 방법 및 장치에 관한 것이다."}
{"patent_id": "10-2022-0184659", "section": "발명의_설명", "subsection": "배경기술", "paragraph": 1, "content": "X선과 같은 방사선을 이용하는 방사선 촬영 장치에 촬영된 영상에 기초하여 다양한 의학적 진단과 치료가 수행 되고 있다. 일반적으로 X선을 사용하여 획득한 의료 영상에는 피사체, 즉 인체의 해부학적 정보뿐만 아니라 촬 영 환경과 기기 성능 등에 따라 발생하는 노이즈도 포함되어 있다. 이러한 노이즈들은 해당 영상을 열화시켜 환 자에 대한 해부학적 판독 능력을 저하시키는 원인이 된다. 영상의 열화 정도는 여러 가지 요인들에 의해 결정되 며, 예를 들어 센서 자체의 노이즈에 의한 영상의 열화, 그리고 X선량에 따라 발생하는 노이즈에 의한 영상의 열화가 있다. 한편 X선 영상 촬영 시 발생하는 방사선에 장시간 노출되면 방사선 피폭에 의한 부작용이 발생할 수 있다. 이러 한 이유로 방사선 노출을 최소화하기 위해 저선량의 X선을 조사하여 X선 영상을 촬영하는 것이 요구되고 있다. 그러나 저선량의 X선을 조사하여 촬영하는 경우 입사되는 X선의 광자 밀도가 작아짐에 따라 광자얼룩(quantum mottle)의 농도가 훨씬 커져 영상의 품질이 저하되는 문제가 있다. 이러한 이유들로 인해 저선량의 X선을 이용하면서도 획득된 영상의 노이즈를 효과적으로 제거하기 위한 여러 방 안들이 소개되었다. 한 예로, 대한민국 등록특허 제10-1432864호에서는, 현재 프레임의 영상과 이전 프레임의 영상의 차분에 의해 얻어지는 차분 맵에 대해 임계값 처리와 축소 처리를 통해 노이즈 성분 영상을 획득하고 이 를 현재 프레임의 영상과 가산하여 현재 프레임의 출력 영상을 생성하고, 노이즈가 저감된 출력 영상을 메모리 에 저장함으로써 순환 필터링을 통한 노이즈 저감 기술이 소개되었다. 그러나 순환 필터링 방식을 이용한 노이즈 저감 기술은 라인(line) 노이즈를 제거하고 모션이 없는 고정된 피사 체에 적용하기에는 매우 효과적이지만 피사체의 모션이 클수록 노이즈 저감 성능이 떨어지는 문제를 가지고, 특 히 피사체의 모션을 잘못 판별하는 경우 모션 블러(motion blur)가 발생하는 영상의 품질을 떨어뜨리는 문제를 가진다. 따라서 순환 필터링 방식에서 현재 프레임과 이전 프레임의 차분 맵에서 피사체의 모션과 노이즈를 판 별하기 위한 임계값 설정은 매우 중요하다. 상기한 대한민국 등록특허 제10-1432864호에서는 차분 맵의 각 픽셀 의 절대값이 노이즈의 표준편차보다 큰 값으로 미리 설정된 임계값을 초과하면 피사체의 모션이 있는 것으로 판 정하고 그렇지 않으면 피사체의 모션이 없는 것으로 판정한다. 그러나 X선 영상의 특성상 촬영 시 선량 조건, 피사체의 밀도, 피사체의 모션 정도에 따라 노이즈의 강도와 편차가 크게 바뀌기 때문에 임계값의 범위 또한 커 져서 적절한 임계값을 설정하는데 어려움이 있다. 또한 피사체의 모션이 있는 경우 순환 필터링의 효과가 억제 되어 노이즈 저감 효과 역시 떨어진다.선행기술문헌 특허문헌 (특허문헌 0001) 대한민국 등록특허 제10-1432864호 (공고일: 2014년 08월 26일) (특허문헌 0002) 일본 등록특허 특허제6744440호 (발행일: 2020년 08월 19일)"}
{"patent_id": "10-2022-0184659", "section": "발명의_설명", "subsection": "해결하려는과제", "paragraph": 1, "content": "본 발명이 해결하고자 하는 과제는 차분 맵에서 모션 비교 결과에 기반하여 노이즈 저감 처리가 이루어진 영상 을 시간순으로 누적시킨 누적 모션 맵을 이용하여 노이즈를 효과적으로 저감할 수 있는 방안을 제공하는 것이다."}
{"patent_id": "10-2022-0184659", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 1, "content": "본 발명의 실시예에 따른 영상 처리 장치는 방사선 촬영에 의해 얻어지는 영상에 대해 순환 필터링 방식으로 노 이즈 저감 처리를 수행한다. 영상 처리 장치는 상기 방사선 촬영에 의해 얻어진 프레임 별 영상을 입력받는 영 상 입력 유닛, 현재 프레임 영상과 이전 프레임 영상의 차분에 의해 얻어진 차분 맵의 각 픽셀에 대한 모션 감 지 정보를 포함하는 모션 맵을 생성하는 모션 맵 생성 유닛, 상기 생성된 모션 맵과 이전 프레임까지 누적된 모 션 맵을 기초로 누적 모션 맵을 생성하는 누적 모션 맵 생성 유닛, 상기 누적 모션 맵의 각 픽셀에 대해 상기 각 픽셀의 모션 확률을 나타내는 통계값을 할당하여 형성되는 통계값 맵을 생성하는 통계값 맵 생성 유닛, 그리 고 상기 누적 모션 맵을 기초로 상기 현재 프레임 영상과 상기 이전 프레임의 출력 영상을 혼합하여 상기 현재 프레임의 출력 영상을 생성하는 출력 영상 생성 유닛을 포함한다. 상기 모션 맵 생성 유닛은 상기 통계값 맵을 활용하여 상기 모션 맵을 생성하도록 구성될 수 있다. 상기 모션 맵 생성 유닛은 상기 현재 프레임 영상과 상기 이전 프레임 영상의 차분에 의해 상기 차분 맵을 생성 하는 차분 맵 생성 유닛, 그리고 상기 차분 맵의 각 픽셀의 픽셀값에 대한 임계값 처리를 통해 상기 각 픽셀의 상기 모션 감지 정보를 포함하는 상기 모션 맵을 생성하는 임계값 처리 유닛을 포함할 수 있다. 상기 임계값 처리 유닛은 상기 통계값 맵의 통계값의 크기에 따라 크기가 변하는 적응적 임계값을 통해 상기 차 분 맵의 임계값 처리를 수행하도록 구성될 수 있다. 상기 임계값 처리 유닛은 상기 통계값 맵의 대응하는 픽셀의 상기 통계값이 나타내는 모션 확률이 클수록 상기 임계값 처리를 위한 상기 각 픽셀의 임계값을 낮게 설정하도록 구성될 수 있다. 상기 통계값 맵 생성 유닛은 상기 누적 모션 맵의 각 픽셀을 포함하는 복수의 픽셀을 포함하는 픽셀 마스크의 단위로 상기 통계값을 산출하여 상기 각 픽셀의 통계값으로 할당하여 상기 통계값 맵을 생성하도록 구성될 수 있다. 상기 통계값은 상기 픽셀 마스크의 복수의 픽셀의 픽셀값의 엔트로피, 분산 또는 표준편차일 수 있다. 상기 출력 영상 생성 유닛은 상기 통계값 맵을 이용하여 갱신된 누적 모션 맵을 기초로 상기 현재 프레임 영상 과 상기 이전 프레임의 출력 영상을 혼합하는 비율을 결정하도록 구성될 수 있다. 상기 누적 모션 맵 생성 유닛은 상기 통계값 맵에 대해 임계치 처리를 수행하고 상기 임계치 처리된 통계값 맵 을 이용하여 상기 누적 모션 맵의 픽셀들의 픽셀값을 선택적으로 증감하여 상기 누적 모션 맵을 갱신하도록 구 성될 수 있다. 상기 차분 맵은 상기 현재 프레임 영상과 이전 프레임들 중 하나 이상의 영상을 이용하여 얻어질 수 있다. 상기 이전 프레임 영상은 상기 이전 프레임의 출력 영상일 수 있다. 한편, 상기 누적 모션맵 생성 유닛은 상기 통계값 맵을 이용하여 상기 누적 모션 맵을 갱신하도록 구성될 수 있 다.본 발명의 실시예에 따르면, 상기 출력 영상 생성 유닛은 상기 통계값 맵을 이용하여 갱신된 누적 모션 맵을 기 초로 상기 현재 프레임 영상과 상기 이전 프레임의 출력 영상을 혼합하는 비율을 결정하도록 구성될 수 있다. 방사선 촬영에 의해 얻어지는 영상에 대해 순환 필터링 방식으로 노이즈 저감 처리를 수행하는 본 발명의 실시 예에 따른 영상 처리 방법은, 상기 방사선 촬영에 의해 얻어진 프레임 별 영상을 입력받는 단계, 현재 프레임 영상과 이전 프레임 영상의 차분에 의해 얻어진 차분 맵의 각 픽셀에 대한 모션 감지 정보를 포함하는 모션 맵 을 생성하는 단계, 상기 생성된 모션 맵과 이전 프레임까지 누적된 모션 맵을 기초로 누적 모션 맵을 생성하는 단계, 상기 누적 모션 맵의 각 픽셀에 대해 상기 각 픽셀을 포함하는 복수의 픽셀의 모션 확률을 나타내는 통계 값을 할당하여 형성되는 통계값 맵을 생성하는 단계, 그리고 상기 누적 모션 맵을 기초로 상기 현재 프레임 영 상과 상기 이전 프레임의 출력 영상을 혼합하여 상기 현재 프레임의 출력 영상을 생성하는 단계를 포함한다. 상기 모션 맵을 생성하는 단계에서 상기 모션 맵은 상기 통계값 맵을 활용하여 생성될 수 있다. 상기 모션 맵 생성 단계에서 상기 차분 맵의 각 픽셀의 픽셀값에 대한 임계값 처리를 통해 상기 각 픽셀의 상기 모션 감지 정보를 포함하는 상기 모션 맵이 생성될 수 있고, 상기 임계값 처리는 상기 통계값 맵의 통계값의 크 기에 따라 크기가 변하는 적응적 임계값을 통해 수행되도록 구성될 수 있다. 상기 모션 맵 생성 단계에서 상기 차분 맵의 각 픽셀의 픽셀값에 대한 임계값 처리를 통해 상기 각 픽셀의 상기 모션 감지 정보를 포함하는 상기 모션 맵이 생성될 수 있고, 상기 임계값 처리를 위한 상기 각 픽셀의 임계값은 상기 통계값 맵의 대응하는 픽셀의 상기 통계값이 나타내는 모션 확률이 클수록 낮게 설정될 수 있다. 상기 통계값 맵 생성 단계에서 상기 통계값 맵은 상기 누적 모션 맵의 각 픽셀을 포함하는 복수의 픽셀을 포함 하는 픽셀 마스크의 단위로 상기 통계값을 산출하여 상기 각 픽셀의 통계값으로 할당하여 생성될 수 있다. 상기 통계값은 상기 픽셀 마스크의 복수의 픽셀의 픽셀값의 엔트로피, 분산 또는 표준편차일 수 있다. 상기 출력 영상을 생성하는 단계는 상기 통계값 맵을 이용하여 상기 누적 모션 맵을 갱신하는 단계, 그리고 상 기 갱신된 누적 모션 맵을 기초로 상기 현재 프레임 영상과 상기 이전 프레임의 출력 영상을 혼합하는 비율을 결정하는 단계를 포함할 수 있다. 상기 누적 모션 맵을 갱신하는 단계에서, 상기 통계값 맵에 대해 임계치 처리를 수행하고 상기 임계치 처리된 통계값 맵을 이용하여 상기 누적 모션 맵의 픽셀들의 픽셀값을 선택적으로 증감하여 상기 누적 모션 맵을 갱신 하도록 구성될 수 있다. 상기 차분 맵은 상기 현재 프레임 영상과 이전 프레임의 출력 영상의 차분에 의해 얻어질 수 있다. 한편, 본 발명의 다른 실시예에 따른 영상 처리 방법은 상기 통계값 맵을 이용하여 상기 누적 모션 맵을 갱신하 는 단계를 더 포함할 수 있다. 본 발명의 실시예에 따르면, 상기 출력 영상을 생성하는 단계에서, 상기 현재 프레임 영상과 상기 이전 프레임 의 출력 영상을 혼합하는 비율은 상기 갱신된 누적 모션 맵을 기초로 결정될 수 있다."}
{"patent_id": "10-2022-0184659", "section": "발명의_설명", "subsection": "발명의효과", "paragraph": 1, "content": "본 발명에 의하면, 누적 모션 맵을 통해 노이즈가 저감된 영상을 생성할 수 있다."}
{"patent_id": "10-2022-0184659", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 1, "content": "아래에서 첨부된 도면을 참조하여 본 발명의 실시예에 대해 본 발명이 속하는 기술분야에서 통상의 지식을 가지 는 자가 용이하게 실시할 수 있도록 상세히 설명한다. 그러나 본 발명은 여러 가지 상이한 형태로 구현될 수 있 으며 설명된 실시예에 한정되지 않는다. 도 1에는 본 발명의 실시예에 따른 노이즈 저감 기능을 갖는 영상 처리 장치가 적용된 C암 형태의 방사선 촬영 장치의 한 예가 도시되어 있다. 본 발명의 실시예에 따른 영상 처리 장치는 도 1에 예시적으로 도시된 것과 같 은 영상 촬영 장치의 일부로 적용될 수도 있으며 영상 촬영 장치와 별도의 장치로 구성되어 영상 처리 기능을 수행할 수도 있다. 본 발명의 실시예에 따른 영상 처리 장치가 적용될 수 있는 영상 촬영 장치는 예를 들어 도 1에 도시된 바와 같 은 C암 형태로 구성되어 동영상을 획득할 수 있는 촬영 장치로 구성될 수 있으며 예를 들어 X선과 같은 방사선 을 이용하여 촬영대상인 피사체(S)의 관심 영역을 촬영할 수 있도록 구성될 수 있다. 도 1을 참조하면, 방사선 촬영 장치는 방사선, 예를 들어 X선을 출력하는 방사선 조사부와 피사체(S)를 투 과한 방사선을 검출하여 영상 데이터를 획득하는 영상 획득부를 구비할 수 있으며, 방사선 조사부와 영상 획득부는 C암의 양측 단부에 지지될 수 있다. 예를 들어, 방사선 촬영 장치는 모바일 형태의 C 암 X선 이미징 장치, 중재적 X선 장치(interventional X-ray device), 중재적 혈관조영술 C암 X선 장치 (interventional angiography C-arm X-ray device) 등에 적용될 수 있다. 지지 구조는 방사선 조사부와 영상 획득부를 지지하며 피조사체(S)의 이미징 위치 및 각도 등의 변경을 위해 방사선 조사부와 영상 획득부의 공간상 위치 및 회전 위치의 변경이 가능하도록 구성된 다. 예를 들어, 지지 구조는 지지 바디, 상하 방향(D1)으로 이동 가능하게 지지 바디에 체결되 는 리프트 칼럼, 그리고 리프트 칼럼과 함께 상하 방향으로 이동 가능하면서 리프트 칼럼에 대 해 수평 방향(D2)으로 상대 이동 가능하게 리프트 칼럼에 체결되는 전후진 암을 포함할 수 있다. C암이 전후진 암에 대해 적어도 하나의 회전 방향으로 상대 회전 가능하게 전후진 암에 체결되 고, 방사선 조사부와 영상 획득부가 C암의 양측 단부에 각각 체결된다. 이때, C암은 전후 진 암과 함께 상하 방향의 승강 이동 및 수평 방향으로 전후진 이동이 가능하면서 전후진 암에 대해 적어도 하나의 회전 방향, 예를 들어 오비탈 회전 방향(R1) 및 전후진 암의 수평 이동 방향과 나란한 방향 을 중심으로 하는 축 회전 방향(R2) 중 적어도 하나의 회전 방향으로 상대 회전 가능하게 전후진 암에 체 결될 수 있다. 도면에 도시되지 않았으나, 지지 구조는 리프트 칼럼의 상항 방향 이동, 전후진 암 의 수평 방향 이동, 및 C암의 회전을 위한 모터와 같은 액추에이터를 포함할 수 있다. 방사선 조사부 와 영상 획득부를 지지하는 지지 멤버인 C암을 지지하고 구동하기 위한 요소들, 즉 전후진 암 , 리프트 칼럼, 및 이들에 구비되는 액추에이터들은 C암을 구동하기 위한 구동요소라고 할 수 있고 이들의 조합은 C암을 구동하기 위한 구동부라 할 수 있다. 또한 전후진 암의 가로방향 회전을통해 C암의 패닝 회전(panning rotation)이 가능하도록 구성될 수도 있다. 지지 멤버의 형태는 C자 형상에 한정되지 않으며, 본 발명의 다른 실시예에서는 C자 형상 대신 U자 형상, G자 형상 등의 암이 지지 멤버로 사용 될 수도 있다. 표시부는 실시간 위치정보, 영상데이터, 기준 위치정보, 방사선 출력 정보 중 적어도 하나 이상을 표시할 수 있도록 구성된다. 표시부는 정보 및 영상 표시가 가능한 임의의 장치일 수 있으며, 예를 들어 프린터, CRT 디스플레이, LCD 디스플레이, PDP 디스플레이, OLED 디스플레이, FED 디스플레이, LED 디스플레이, DLP 디 스플레이, PFD 디스플레이, 3D 디스플레이, 투명 디스플레이 등일 수 있다. 또한 표시부는 사용자로부터 입력을 받을 수 있는 터치스크린과 같은 정보 표시 및 입력이 가능한 형태로 구현될 수도 있다. 본 발명의 실시예에 따른 영상 처리 장치는 정보 처리 및 연산이 가능한 하나 또는 복수의 컴퓨터와 같은 정보 처리 장치의 형태로 구현될 수 있다. 예를 들어 컴퓨터는 CPU와 같은 제어 수단, ROM(read only memory) 또는 RAM(random access memory)과 같은 기억 수단, GPU(graphics processing unit)와 같은 그래픽 제어 수단 을 포함할 수 있다. 컴퓨터는 또한 네트워크 카드와 같은 통신 수단, 키보드, 디스플레이 또는 터치 스크린과 같은 입출력 수단을 포함할 수 있다. 이와 같은 컴퓨터의 구성 요소는 알려진 바와 같이 버스를 통해 접속될 수 있고 기억 수단에 저장된 프로그램의 실행에 의해 작동되고 제어될 수 있다. 정보 처리가 가능한 컴퓨터의 형태로 구현될 수 있는 영상 처리 장치는 도 1에 도시된 방사선 영상 촬영 장 치에 설치되어 영상 처리 기능을 수행하도록 구성될 수 있으며, 이 경우 방사선 영상 촬영 장치의 일부로서 촬 영된 영상을 수신하여 처리하고 처리된 영상이 방사선 촬영 장치의 영상 표시 수단에 표시되도록 구성될 수 있 다. 한편, 도 2를 참조하면, 본 발명의 실시예에 따른 영상 처리 장치는 노이즈 저감 처리를 위한 복수의 기능 적 구성, 즉 영상 입력 유닛, 차분 유닛, 임계값 처리 유닛, 누적 모션 맵 생성 유닛, 그리고 출력 영상 생성 유닛을 포함한다. 이때, 차분 유닛과 임계값 처리 유닛의 연속적 작용에 의해 모션 맵이 생성되며, 이러한 의미에서 차분 유닛과 임계값 처리 유닛을 모션 맵 생성 유닛으로 볼 수 있다. 도 3을 참조하면, 영상 처리 장치에 의해 수행될 수 있는 본 발명의 한 실시예에 따른 영상 처리 방법은 영 상 획득 단계(S31), 차분 맵 생성 단계(S34), 모션 맵 생성 단계(S35), 누적 모션 맵 생성 단계(S36), 통계값 맵(예를 들어 엔트로피 맵) 생성 단계(S38) 그리고 영상 출력 단계(S37)를 포함할 수 있다. 영상 처리 방법은 순환 필터링 방식을 통해 노이즈가 저감된 출력 영상을 생성한다. 영상 입력 유닛은 입력 영상을 외부로부터 입력받는다. 예를 들어, 영상 입력 유닛은 앞에서 설명한 영 상 획득부에 의해 획득된 동영상의 각 프레임을 시간에 따라 순차적으로 입력받을 수 있다. 피사체를 포함 하는 영역의 복수의 픽셀로 이루어진 영상이 방사선 검출 패널인 영상 획득부에 의해 시간에 따라 방사선 동영상 시퀀스로 획득될 수 있으며, 획득된 방사선 동영상 시퀀스가 시간순으로 영상 입력 유닛으로 입력될 수 있다. 입력 영상은 복수의 프레임으로 이루어지는 동영상의 1프레임일 수 있다. 또한 입력 영상은 복수의 행(n행)과 복수의 열(m열)로 이루어지는 복수의 픽셀을 갖는 2차원 영상일 수 있으며, 촬영된 피사체와 함께 노이즈를 포 함할 수 있다. 예를 들어, 입력 영상에 포함된 노이즈는 미리 결정된 방향, 예를 들어 수평 방향 및/또는 수직 방향의 라인 노이즈(line noise) 및 랜덤 노이즈(random noise)를 포함할 수 있다. 차분 유닛에 의한 차분 맵 생성 및 임계값 처리 유닛에 의한 차분 맵의 임계값 처리를 통해 모션 맵이 생성된다. 이에 의해 도 5에 도시된 바와 같이 노이즈 처리된 현재 프레임 영상과 이전 프레임 영상, 예를 들어 이전 프레임의 출력 영상으로부터 모션 맵이 생성될 수 있다. 여기서 모션 맵은 현재 프레임 영상에서 이전 프 레임 영상을 차감하여 얻어진 데이터로부터 얻어지며 각 픽셀의 모션 여부에 대한 정보를 포함하고, 예를 들어 모션이 있는 픽셀은 '0'의 값을 갖고 모션이 없는 픽셀은 '1'의 값을 갖도록 설정될 수 있다. 즉 모션 맵의 모 든 픽셀은 0 또는 1의 픽셀 값을 갖고 0의 값을 갖는 픽셀들은 이전 프레임 영상을 기준으로 모션이 있는 것을 의미하고 1의 값을 갖는 픽셀들은 이전 프레임 영상을 기준으로 모션이 없는 것을 의미할 수 있다. 모션 여부의 판단은 임계값 처리를 기초로 이루어질 수 있으며, 본 발명의 실시예에서는 모션 판단을 위한 임계값 처리 시 통계값 맵, 예를 들어 엔트로피 맵을 이용한다. 차분 유닛은 현재 프레임 영상과 이전 프레임 영상, 예를 들어 이전 프레임의 출력 영상을 차분하여 차분 맵을 생성한다. 이때, 현재 프레임 영상과 이전 프레임의 출력 영상에 대해 노이즈 처리, 예를 들어 노이즈 저 감 및 노이즈 안정화 처리를 수행한 후 차분이 이루어지도록 할 수도 있다. 이전 프레임의 출력 영상을 현재 프레임에서의 차분 맵의 생성에 이용함으로써 소위 순환 필터링 구조의 노이즈 저감 처리가 이루어질 수 있다. 차 분 유닛은 현재 프레임 영상과 이전 프레임 영상 간의 모든 픽셀에 대해 동일한 위치의 각 픽셀의 픽셀값 차이를 산출하여 차분 맵을 생성할 수 있다. 즉 차분 맵은 프레임 영상과 동일한 수의 픽셀을 포함하며 차분 맵 의 각 픽셀의 값은 현재 프레임 영상과 이전 프레임 영상의 해당 픽셀의 차이값에 해당한다. 여기서, 이전 프레 임 영상은 현재 프레임의 직전의 프레임의 영상뿐만 아니라 그 이전의 프레임의 영상을 포함하는 개념임을 이해 해야 한다. 이때, 차분 맵은 현재 프레임의 영상, 예를 들어 입력 영상과 이전 프레임들 중 하나 이상의 프레임 의 영상, 예를 들어 출력 영상의 차분에 의해 얻어질 수 있다. 예를 들어, 차분 맵은 현재 프레임의 입력 영상 에서 이전 프레임들 중 어느 하나의 출력 영상을 차분하여 생성될 수도 있고, 현재 프레임의 입력 영상에서 이 전 프레임들 중 복수의 프레임의 출력 영상의 혼합에 의해 얻어진 혼합 영상을 차분하여 생성될 수 있다. 차분 맵은 피사체의 모션 정보, 그리고 잔류하는 노이즈 정보를 포함할 수 있다. 추가적으로, 생성된 차분 맵에 평균값 필터 또는 중간값 필터 등을 이용하여 차분 맵을 안정화할 수도 있다. 임계값 처리 유닛은 차분 맵의 모션 감지를 위한 임계값을 결정하고 결정된 임계값에 기초하여 임계값 처리 를 수행함으로써 각 픽셀의 모션 여부를 감지하고 그에 따라 모션 맵을 생성할 수 있다. 즉, 임계값 처리 유닛 은 임계값 처리를 통해 차분 맵의 각 픽셀의 모션 여부를 판별하고 그에 따라 각 픽셀의 모션 여부를 나타 내는 정보로 이루어지는 모션 맵을 생성한다. 모션 감지를 위한 임계값이 너무 낮게 설정되는 경우 모션 감지 민감도가 높아져서 노이즈 저감 수준이 떨어지고, 반대로 임계값이 너무 높게 설정되는 경우 모션 감지 민감도 가 낮아져서 모션 블러(끌림 현상)가 나타날 수 있다. X선 영상은 서로 다른 선량 조건과 피사체 특성 하에서 획득되기 때문에 획득 영상의 픽셀값을 예측하기 어렵고 픽셀값에 따라 적절한 임계값을 설정하는 것이 필요하 다 모션 감지를 위한 임계값은 통계적 방법, 실험적 방법, 산술적 방법 등 다양한 방법으로 결정될 수 있다. 도 4 는 정지 상태인 피사체의 동일한 입력 영상(이전 프레임과 현재 프레임)에 대해서 원신호의 차분 맵의 픽셀값의 분포와 엔스콤 변환 후 얻어진 차분 맵의 픽셀값의 분포를 비교적으로 보여준다. 도 4의 (a)는 원신호로부터 얻 어진 차분 맵의 픽셀값 분포를 보여주는 그래프이고, 도 4의 (b)는 원신호의 엔스콤 변환 후 얻어진 차분 맵의 픽셀값 분포를 보여주는 그래프이다. 도 4의 그래프에서 가로축(x축)은 픽셀값(강도)를 나타내고 세로축(y축)은 이전 프레임 영상과 현재 프레임 영상의 동일 위치의 픽셀의 픽셀값 차를 나타낸다. 정지 상태의 피사체이므로 임의의 x 값이 갖는 y축 방향 데이터 분포가 노이즈라고 할 수 있으며, y축 방향 데이터 분포가 노이즈 값 이상 일 경우 모션이 발생한 픽셀로 추정할 수 있다. 예를 들어 원신호의 차분 맵의 분포에서 픽셀값이 500인 경우 모션 판단을 위한 임계값은 100 정도가 적당하고 픽셀값이 2200일 경우 임계값은 170 정도가 적당하다. 이와 같이 픽셀값에 따라 모션 판단을 위한 적절한 임계 값이 큰 차이가 발생하기 때문에 임계값 결정에 어려움이 있다. 이에 반해, 도 4의 (b)와 같이 엔스콤 변환된 신호의 차분 맵의 분포에서는 픽셀값이 500인 경우 임계값은 5 정도가 적당하고 픽셀값이 2200일 경우 임계값은 4 정도가 적당하다. 이와 같이 엔스콤 변환된 신호를 차분하여 차분 맵을 생성하면 픽셀값에 따른 적절한 임계 값의 차이가 매우 작아져서 임계값 결정이 매우 쉬워진다. 이때, 예를 들어, 임계값은 특정 픽셀값에 대해 픽셀 값 차이의 분포의 대략 상위 70 내지 80 % 범위에 속하는 값으로 설정될 수 있다. 나아가, 엔스콤 변환된 신호로부터 차분 데이터를 산출하더라도 모든 픽셀값에 따라 동일한 임계값을 적용하기 에는 약간의 편차가 여전히 존재한다. 이 점을 감안하여 적응적 임계값 처리(adaptive thresholding)를 통해 전 체 픽셀값에 대한 노이즈 편차를 보다 공평하게 보정할 수 있다. 픽셀값에 따라 차분값이 비선형적으로 변하는 이유는 엔스콤 변환의 수학적 특성 때문이다. 임계값 처리 유닛은 차분 유닛에 의해 생성된 차분 맵에 대해 모션 감지를 위한 임계값 처리를 수행하 여 모션 맵을 생성한다. 임계값 처리 유닛은 뒤에서 설명할 통계값 맵(예를 들어, 엔트로피 맵) 생성 유닛 에 의해 생성된 통계값 맵, 예를 들어 엔트로피 맵에 따라 적응적 임계값을 적용하여 차분 맵으로부터 모션 맵을 생성한다. 적응적 임계값을 이용하여 모션 감지 여부를 판정하고 그에 따라 모션 맵을 생성하는 방법에 대 해서는 뒤에서 다시 설명한다. 임계값 처리 유닛은 차분 맵의 각 픽셀에 대해 픽셀값이 미리 정해진 임계값 이상이면 모션이 있는 픽셀로 판단하여 해당 픽셀에 모션을 나타내는 판정값, 예를 들어 '0'을 할당하고 이와 달리 픽셀값이 임계값보다 작으 면 모션이 없는 픽셀로 판단하여 해당 픽셀에 모션이 없음을 나타내는 판정값, 예를 들어 '1'을 할당할 수 있다. 임계값 처리 유닛은 차분 맵의 모든 픽셀에 대해 임계값을 이용한 이러한 모션 판단을 수행하고 그 결과에 따른 판정값을 해당 픽셀에 할당하여 모션 맵을 생성한다. 임계값 처리 유닛은 이러한 방식으로 차분 맵과 적응적 임계값을 나타내는 임계값 기준 곡선을 이용하여 모션 맵을 생성한다. 이에 따라 모션 맵은 입 력된 프레임 영상과 동일한 픽셀을 가지며 각 픽셀 별로 모션 여부를 나타내는 값을 갖는다. 한편, 본 발명의 다른 실시예에서는, 픽셀 단위로 임계값 처리가 이루어지는 것이 아니라, 복수의 인접 픽셀을 포함하는 마스크 단위로 임계값 처리가 이루어질 수도 있다. 예를 들어, 중심 픽셀을 둘러싸는 3*3, 9개의 픽셀 을 포함하는 마스크를 설정하고 해당 마스크 내의 픽셀들의 평균값 또는 중간값과 임계값을 비교하여 해당 중심 픽셀의 모션 여부를 판단할 수 있다. 이러한 방법으로 마스크를 옮겨가면서 마스크 단위로 모션 판단이 이루어 질 수 있고 그에 따라 모션 맵이 생성될 수 있다. 마스크 단위로 임계값 처리를 수행함으로써 특정 픽셀에 노 이즈가 포함되어 있는 경우에 해당 노이즈가 감소될 수 있다. 위에서 설명한 바와 같이 임계값 처리 유닛을 통해 각 픽셀에 대한 모션 여부를 판단하여 모션이 있는 것으 로 판단된 픽셀과 모션이 없는 것으로 판단된 픽셀에 다른 값을 할당함으로써 차분 맵의 모든 픽셀은 미리 정해 진 두 개의 값, 예를 들어 0 또는 1 중 하나의 값을 갖게 된다. 이렇게 얻어진 맵은 모든 픽셀의 모션 여부에 대한 정보를 포함하며, 이런 의미에서 이 맵을 모션 맵이라고 칭할 수 있다. 도 6은 이전 프레임 영상과 현재 프레임 영상에서 핸드 팬텀을 우측에서 좌측으로 움직였을 때 출력되는 모션 맵의 예를 보여준다. 도 6의 (a)는 핸드 팬텀을 포함하는 이전 프레임 영상을 보여주고 도 6의 (b)는 핸드 팬텀 을 우측에서 좌측으로 움직인 상태인 현재 프레임 영상을 보여준다. 도 6의 (c)는 차분 데이터의 각 픽셀에 대 한 모션 감지 결과를 보여주는 출력되는 모션 맵을 보여준다. 도 6의 (c)를 참조하면, 흰색으로 표시된 영역이 모션이 감지된 픽셀을 나타내고, 실제로 모션이 있는 핸드 팬 텀 내에서 이전 프레임과 대비가 큰 영역(뼈 영역의 가장자리)은 모션으로 감지되고 이전 프레임과 대비가 작은 영역(피부 영역, 도구 영역)은 모션으로 감지되지 않는다는 것을 알 수 있다. 이에 따라 후속 과정에서 최종 출 력 영상 생성 시 모션이 있는 부분은 현재 프레임 위주로 갱신하고 나머지 부분은 평균을 취하면 노이즈는 줄어 들고 에지는 강화되어 선예도가 향상되고 모션 블러를 방지하는 효과를 얻을 수 있다. 누적 모션 맵 생성 유닛은 모션 감지 결과에 기초하여 모션 맵을 시간순으로 별도의 메모리에 누적시키고 이를 합산하여 누적 모션 맵을 생성한다. 누적 모션 맵은 최종 출력 영상을 생성하기 위한 이전 프레임 영상과 현재 프레임 영상의 적절한 혼합 비율을 결정하기 위해 사용된다. 도 7은 모션 맵을 이용하여 누적 모션 맵을 생성하는 방법을 보여주는 도면이다. 누적 모션 맵 생성 유닛은 상기한 모션 감지를 통해 얻어진 모션 맵을 별개의 독립된 메모리에 매 프레임마다 시간순으로 누적적으로 저장 하여 누적 모션 맵을 생성하고 갱신할 수 있다. 도 7의 좌측의 이미지는 누적된 모션 맵을 나타내고 우측은 모 션 맵의 합산에 의해 얻어지는 누적 모션 맵을 나타낸다. 이전 프레임의 누적 모션 맵과 현재 프레임의 모션 맵 의 동일 픽셀의 값을 각각 합산하여 현재 프레임의 누적 모션 맵을 생성할 수 있다. 즉 특정 프레임의 누적 모 션 맵은 해당 프레임까지 얻어진 모든 모션 맵의 동일 픽셀의 픽셀값의 합산에 의해 얻어진 영상이 된다. 예를 들어, 도 7을 참조하면, 현재 프레임이 4번째 프레임인 경우, 현재까지의 4개의 프레임에서 얻어진 모션 맵에서 동일한 픽셀의 값의 합이 현재 프레임의 누적 모션 맵의 동일 픽셀의 값이 된다. 모션 맵에서 모션이 있는 것으로 판단된 픽셀의 값을 '0'으로 하여 밝게 표현하고 모션이 없는 것으로 판단된 픽셀의 값을 '1'로 하여 어둡게 표현한 경우, 누적 모션 맵의 각 픽셀은 해당 픽셀의 모션 감지 값들(0 또는 1)의 합에 해당하는 값을 갖게 되어 모션 판단 횟수에 따라 다른 값, 즉 다른 밝기를 갖게 된다. 예를 들어, 10 개의 프레임으로 이루어진 누적 모션 맵을 가정하는 경우, 해당 누적 모션 맵은 10개의 모션 맵의 합산에 의해 얻어지며 누적 모션 맵의 각 픽셀은 0부터 10 사이의 값 중 어느 하나를 갖게 된다. 여기서 모든 모션 맵의 동 일한 픽셀의 값들이 모두 0인 경우 누적 모션 맵의 해당 픽셀은 0의 값을 가지며, 모든 모션 맵의 동일한 픽셀 의 값들이 모두 1인 경우 누적 모션 맵의 해당 픽셀은 10의 값을 가진다. 이에 의해 도 8에 도시된 것처럼 누적 모션 맵의 각 픽셀들은 해당 프레임까지의 모션 맵의 동일한 픽셀의 모션 감지 횟수에 따른 픽셀 값, 즉 밝기를 갖는다. 이러한 의미에서 생성된 누적 모션 맵에서 픽셀값이 밝을수록 모션 확률이 높으며 어두울수록 모션 확률이 낮다 고 볼 수 있다. 예를 들면, 동일한 픽셀 위치에서 시간순으로 프레임이 진행되는 동안 모션이 감지될 경우 모션 확률이 높아지고 모션이 감지되지 않으면 모션 확률은 낮아진다. 누적 모션 맵의 각 픽셀의 값은 해당 픽셀의 모션의 정도, 모션 확률값을 나타낸다. 즉 각 프레임의 모션 맵에 서 모션이 있는 경우 '0', 모션이 없는 경우 '1'의 판정값이 할당되는 경우라면, 누적 모션 맵의 픽셀값이 작을 수록 해당 픽셀의 모션 확률이 크다는 것을 의미한다.한편, 본 발명의 다른 실시예에서는, 누적 모션 맵의 갱신 시 모션 맵의 픽셀 값을 누적하는 대신에, 임계치 처 리된 통계값 맵을 이용하여 누적 모션 맵의 픽셀들의 픽셀값을 선택적으로 증감하여 누적 모션 맵을 갱신하도록 구성될 수도 있다. 도 8에는 프레임의 진행에 따라 입력 영상에 따른 모션 맵 및 누적 모션 맵의 생성 과정의 예가 도시되어 있다. 각 프레임의 프레임 영상과 이전 프레임 영상의 차분에 의해 모션 맵이 생성되고 다시 생성된 모션 맵과 이전 프레임의 누적 모션 맵의 합산에 의해 현재 프레임의 누적 모션 맵이 생성될 수 있다. 한편, 본 발명의 실시예에 따르면, 엔트로피 맵 생성 유닛이 모션 맵의 생성에 사용되는 적응적 임계값 처 리를 위한 통계값 맵을 생성한다. 통계값 맵은 누적 모션 맵으로부터 생성되며, 누적 모션 맵과 동일한 수의 픽 셀을 갖도록 형성된다. 통계값 맵의 각 픽셀은 누적 모션 맵에서 해당 픽셀에서의 모션 발생 확률을 나타내는 통계값을 픽셀값으로 갖는다. 예를 들어, 누적 모션 맵에서 해당 픽셀을 포함하는 복수의 픽셀을 포함하는 마스 크를 설정하고 해당 마스크에서 모션의 발생 확률을 나타내는 통계값을 해당 픽셀의 통계값으로 설정할 수 있다. 예를 들어, 특정 픽셀에서의 모션의 발생 확률을 나타내는 통계값은 해당 특정 픽셀을 둘러싸는 복수의 픽셀의 픽셀값의 엔트로피 값, 표준편차 등일 수 있다. 이하에서는 엔트로피가 통계값으로 사용되는 경우를 예 시적으로 설명하고, 이런 의미에서 통계값 맵을 엔트로피 맵으로 칭한다. 엔트로피 맵은 통계학적 접근 방법인 엔트로피 개념을 활용하여 누적 모션 맵으로부터 생성된다. 생성된 엔트로피 맵은 별도 버퍼 메모리에 저장될 수 있고, 다음 프레임의 모션 맵의 생성을 위해 사용될 수 있다. 앞에서 설명한 현재 프레임의 모션 맵은 이전 프레임에서 생성된 엔트로피 맵을 이용하여 생성될 수 있으며, 필요 시 현재 프레임에서 생성된 엔트로피 맵을 이용하여 현재 프레임의 모션 맵을 다시 생성할 수도 있다. 이때, 현재 프레임의 모션 맵은 직전 프레임의 엔트 로피 맵 뿐만 아니라 이전 프레임들 중 어느 하나 이상의 엔트로피 맵을 이용하여 생성될 수도 있다. 모션 맵이 현재 프레임 영상과 이전 프레임 영상의 차분에 의해 얻어지는 차분 맵을 기초로 생성되기 때문에, 경우에 따라 피사체의 모션을 정확하게 감지하지 못할 수 있다. 예를 들어, 피사체가 얇을 경우 차분값, 즉 차 분 맵의 각 픽셀의 픽셀값이 노이즈 수준 이상으로 충분히 크기 않을 경우 모션을 감지하기 어려울 수 있으며, 예를 들어 얇고 예리한 바늘과 같은 물체가 환자의 두꺼운 부위를 지나갈 때 바늘의 모션을 감지하기 어려울 수 있다. 이러한 문제를 해결하기 위해, 본 발명의 실시예에서는 적응적 임계값 처리(adaptive thresholding)를 통 해 조건에 따라 각 픽셀 별로 다른 값을 가지는 임계값을 적용하여 모션 맵을 생성한다. 도 9는 정지 상태의 골반 팬텀 위를 막대 형태의 얇은 납이 지나가는 상황에서 얻어진 모션 맵과 출력 영상을 보여주며, 이 영상들은 본 발명의 실시예에 따른 적응적 임계값 처리가 적용되지 않고 얻어진 것들이다. 도 9의 (a)는 모션 맵을 보여주고 도 9의 (b)는 출력 영상을 보여준다. 도 9의 (b)에 표시된 화살표는 모션 방향을 나 타낸다. 도 9를 참조하면, 막대가 지나가는 영역 중 팬텀의 얇은 부위에서는 막대가 지나가기 전과 후의 차분값 이 충분히 커서 모션이 있는 픽셀로 잘 감지되었지만 두꺼운 뼈 영역을 지나갈 때는 차분값이 충분히 크지 않아 서 움직이는 픽셀로 감지되지 못하는 것을 알 수 있다. 이 경우 해당 픽셀들은 노이즈로 판단되어 출력 영상 생 성 시 평균화 되어서 결과적으로 막대가 끊어지는 형태로 출력 영상이 생성되었다. 도 10은 도 9와 동일 조건에서 얻어진 모션 맵을 보여준다. 도 10의 (a)는 모션 감지를 위한 임계값을 높인 경 우의 모션 맵을 보여주고, 도 10의 (b)는 임계값을 낮춘 경우의 모션 맵을 보여준다. 도 10의 (b)에 나타난 바 와 같이, 막대가 끊기지 않도록 모션 감지를 위한 임계값을 낮출 경우에는 노이즈가 움직인 픽셀로 간주되어 오 히려 노이즈가 강조되는 부작용이 나타남을 알 수 있다. 이와 같이 얇은 물체의 모션을 감지할 때 임계값에 따 른 트레이드 오프가 존재한다. 본 발명의 실시예는 이러한 문제점들을 해결하기 위해 통계학적 접근 방법인 엔트로피 개념을 활용한다. 엔트로 피는 확률분포가 가지는 정보의 확신도 또는 정보량을 수치로 표현한 것이다. 확률분포에서 특정한 값이 나올 확률이 높아지고 나머지 값의 확률은 낮아진다면 엔트로피가 작아지고, 반대로 여러가지 값이 나올 확률이 비슷 한 경우에는 엔트로피가 높아진다. 엔트로피는 확률분포의 분포 특성을 나타내는 특성값 중 하나로 볼 수 있다. 확률 또는 확률밀도가 특정값에 몰려 있으면 엔트로피가 작다고 할 수 있고 반대로 여러가지 값에 골고루 퍼져 있으면 엔트로피가 크다고 볼 수 있다. 즉, 엔트로피가 클수록 불균일하여 정보의 양이 많고 엔트로피가 작을수 록 균일하고 정보의 양이 적다고 할 수 있다. 주지된 바와 같이, 통계학에서 엔트로피(H)는 평균 정보량을 의미하며 이산 랜덤변수 X에 대해 다음의 수학식 1 과 같이 정의될 수 있다.[수학식 1]"}
{"patent_id": "10-2022-0184659", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 2, "content": "여기서, n은 X가 가질 수 있는 도수, 즉 모션 확률값의 수이고, P는 각 도수의 빈도수, 즉 각 모션 확률값의 빈 도수를 나타내는 확률질량함수이다. 누적 모션 맵의 각 픽셀에 대해 또는 복수의 픽셀의 집합 별로 모션 확률값의 엔트로피가 계산될 수 있으며, 계 산된 엔트로피를 각 픽셀 또는 복수의 픽셀의 집합에 할당함으로써 엔트로피 맵이 생성될 수 있다. 예를 들어, 누적 모션 맵에서 모든 픽셀에 대해 마스킹 영역을 선정하고 해당 마스킹 영역에 속하는 픽셀들의 모션 확률값 의 엔트로피 값을 산출하고, 산출된 엔트로피 값을 해당 픽셀의 픽셀값으로 할당하여 엔트로피 맵을 생성할 수 있다. 계산하려는 픽셀을 포함하는 충분히 큰 영역을 마스크로 잡고 해당 마스크 내의 모션 확률값에 대해 히스 토그램으로 엔트로피를 계산할 수 있다. 이때 히스토그램은 모션 확률값을 도수로 하고 각 모션 확률값의 출현 횟수를 빈도수로 하여 산출될 수 있으며, 이를 기초로 상기한 수학식 1에 의해 엔트로피를 산출할 수 있다. 예 를 들어, 누적 모션 맵이 1500*1500의 영상인 경우, 계산하고자 하는 중심 픽셀을 포함하는 300*300의 마스크를 설정하고 설정된 마스크 내의 엔트로피를 계산하여 해당 중심 픽셀의 엔트로피로 설정할 수 있다. 도 12는 누적 모션 맵에서 픽셀의 마스킹 연산으로 엔트로피를 계산하여 생성한 엔트로피 맵의 예시적으로 보여준다. 도 11의 (a)는 누적 모션 맵을 한 예를 보여주며, 마스크가 점선으로 표시되어 있다. 각 마스크에 대해 엔트로피가 계산 되며, 도 11의 (a)에 표시된 세 개의 마스크 중 가장 우측의 마스크가 밝은 픽셀, 즉 모션 확률이 큰 픽셀을 가 장 많이 포함하며, 이에 따라 가장 우측의 마스크에 속하는 픽셀들의 엔트로피가 가장 크다는 것을 예측할 수 있다. 그리고 도 11의 (a)에서 가장 좌측의 마스크가 어두운 픽셀, 즉 모션 확률이 작은 픽셀을 가장 많이 포함 하며, 이에 따라 가장 좌측의 마스크에 속하는 픽셀들의 엔트로피가 가장 작다는 것을 예측할 수 있다. 도 11의 (b)는 (a)의 누적 모션 맵에서 모든 픽셀에 대해 설정된 마스크에 대해 계산된 엔트로피에 의해 생성된 엔트로 피 맵의 예를 보여준다. 이로 인해 엔트로피 맵의 각 픽셀들은 해당 픽셀을 포함하는 마스크에 속하는 픽셀들의 모션 확률값의 엔트로피 값을 픽셀값으로 가진다. 이때 엔트로피가 큰 픽셀 또는 영역은 움직였을 확률이 크고 엔트로피가 작은 픽셀 또는 영역은 움직였을 확률이 작다는 것을 나타낸다고 볼 수 있다. 이러한 의미에서 엔트 로피는 모션 확률값의 혼잡도를 나타내는 척도라고 볼 수 있다. 본 발명의 실시예에서는, 이와 같이 생성된 엔트로피 맵이 모션 맵의 생성에 사용되며, 엔트로피 맵에 포함된 각 픽셀의 엔트로피를 이용하여 모션 감지를 위한 임계값을 조절한다. 생성된 모션 맵은 별도의 버퍼 메모리에 저장되고 다음 프레임에서의 모션 맵의 생성 시 이 엔트로피 맵, 즉 이전 프레임에서 생성된 엔트로피 맵을 기 반으로 적응적 임계치 처리가 이루어진다. 임계값 처리 유닛에 의해 수행되는 임계값 처리를 위한 각 픽셀의 임 계값을 엔트로피 맵의 대응하는 픽셀의 엔트로피의 크기에 반비례하도록 설정할 수 있다. 예를 들면, 모션 맵 생성 시 엔트로피가 높은 픽셀 또는 영역은 이전에도 움직였을 확률이 높기 때문에 모션 감지 임계값을 낮춰 모 션을 보다 민감하게 감지할 수 있고, 이와 달리 엔트로피가 낮은 픽셀 또는 영역은 이전에도 움직였을 확률이 낮기 때문에 모션 감지 임계값을 높여 보수적으로 감지할 수 있다. 이러한 적응적 임계값 처리를 통해 앞에서 언급한 임계값의 크기에 따른 트레이드 오프의 문제를 개선할 수 있다. 한편, 엔트로피 대신 분산이나 표준편차 가 통계값으로 사용되는 경우에는 분산이나 표준편차가 작은 픽셀 또는 영역이 이전에도 움직였을 확률이 높은 것으로 볼 수 있다. 이와 같이 엔트로피를 기초로 적응적 임계값 처리를 통해 모션 맵을 생성함으로써, 개별 프레임의 모션 감지 정 확도가 높아지는 효과와 더불어 매 프레임마다 정확한 모션 감지가 이루어지지 않더라도 프레임의 진행에 따라 정보양이 누적되어 움직이는 물체의 주변 픽셀의 임계값을 낮추는 방향으로 영역이 점점 더 확장되는 효과가 있 으며, 이에 의해 결과적으로 프레임이 진행될수록 얇은 물체의 모션 감지 정확도가 크게 향상된다. 한편, 도 12는 본 발명의 다른 실시예에 따른 모션 맵을 생성하는 방법을 보여준다. 앞에서 설명한 실시예에서 영상의 노이즈 수준에 따른 임계값 처리를 통한 모션 맵을 생성했음에도 불구하고 모션 맵에 노이즈 성분이 남 아 있을 수 있기 때문에, 이 실시예에서는 추가적인 노이즈 저감 처리가 수행된다. 이 실시예에서는, 피사체와 배경을 분리한 뒤 배경 영역을 모션 맵에서 제외하는 방법으로 남아 있는 노이즈를 제거한다. 현재 프레임 영상에서 실험적으로 임계값을 적용하거나 인공지능 학습을 통해 피사체를 제거한 배경 영상을 생성하고, 앞에서 설명한 실시예에 따라 생성된 모션 맵과 생성된 배경 영상을 합산 연산 또는 곱셈 연 산을 수행하여 노이즈 성분이 제거된 모션 맵을 생성한다. 이에 의해 배경에 남아 있는 노이즈 성분은 제거되고피사체의 모션에 대한 정보만을 포함하는 모션 맵이 생성될 수 있다. 이러한 방법은 모션 감지 임계값을 낮출 경우 영상 전체의 노이즈 수준은 작게 증가하면서 피사체의 모션은 민감하게 감지할 수 있는 이점을 갖는다. 한편, 본 발명의 또 다른 실시예에서는, 모션 감지를 위한 임계값을 설정 시에 배경과 피사체 영역을 구분하여 서로 다른 임계치를 적용하여 두 개의 모션 맵을 생성한 후 생성된 두 개의 모션 맵을 병합하여 최종적인 모션 맵을 생성할 수도 있다. 출력 영상 생성 유닛은 현재 프레임 영상과 이전 프레임 영상을 혼합하여 출력 영상을 생성한다. 이때, 출 력 영상 생성 유닛은 누적 모션 맵을 기반으로 현재 프레임 영상과 이전 프레임의 출력 영상을 적절한 혼합 비율로 혼합하여 최종 출력 영상을 생성한다. 누적 모션 맵의 각 픽셀의 값이 모션을 나타내는 정도가 클수록 현재 프레임 영상의 반영 비율이 상대적으로 커지도록 설정될 수 있다. 즉 누적 모션 맵에 포함된 픽셀 값에 의 해 결정되는 모션 확률이 높을수록 현재 프레임의 가중치가 높아지도록 혼합 비율을 결정할 수 있다. 예를 들어, 픽셀 단위로 누적 모션 맵의 픽셀 값이 모션을 나타내는 정도가 클수록 현재 프레임 영상의 반영 비율이 선형적으로 증가하도록 반영 비율이 결정될 수 있다. 구체적인 예로, 모션이 많은 픽셀에 대해서는 현재 프레임 영상의 해당 픽셀에 미리 정해진 가중치(α1), 예를 들어 0.8을 부여하고 누적된 이전 프레임까지의 출력 영상의 해당 픽셀에 가중치(1-α1), 예를 들어 0.2의 가중 치를 부여하고 모든 픽셀에 대해 이러한 혼합 과정을 수행함으로써, 현재 프레임 영상과 이전 프레임 출력 영상 을 혼합할 수 있다. 한편, 모션이 적은 픽셀에 대해서는 현재 프레임 영상의 해당 픽셀에 미리 정해진 가중치 (α2), 예를 들어 0.2를 부여하고 누적된 이전 프레임 영상의 해당 픽셀에 가중치(1-α2), 예를 들어 0.8의 가중 치를 부여하여 현재 프레임 영상과 이전 프레임 출력 영상을 혼합할 수 있다. 모션이 많은 픽셀에 대해 현재 프 레임의 가중치가 높아지면 모션 블러가 없는 영상을 얻을 수 있다. 결과적으로 최종 출력 영상은 모션 확률에 기초하여 모션이 많은 픽셀은 현재 프레임의 값을 더 많이 반영하여 갱신하고 모션이 적은 픽셀은 이전 프레임 의 값을 더 많이 반영하여 갱신함으로써, 시간에 따라 프레임이 누적되면서 노이즈 저감 성능이 향상될 수 있다. 최종적으로 노이즈가 저감된 영상을 출력한 후에는 그 결과가 메모리에 저장되고 다음 프레임의 출력 영상 생성 시 이전 프레임 영상으로 사용되어 순환 필터링 구조가 구현된다. 도 13은 본 발명의 다른 실시예에 따른 영상 처리 방법의 과정이 도시되어 있다. 도 13에 나타난 바와 같이, 누 적 모션 맵으로 생성한 엔트로피 맵이 현재 프레임 영상과 이전 프레임 영상의 혼합에 의해 출력 영상을 생성할 시에 사용된다. 앞에서 설명한 실시예에서와 같이 현재 프레임 영상과 이전 프레임 영상의 혼합 비율이 누적 모 션 맵에 의해 결정되는데, 엔트로피 값이 높은 픽셀은 이전 프레임의 묶음에서 모션이 발생했을 확률이 높다는 것을 의미한다. 엔트로피 맵의 임계치 처리를 통해 엔트로피 맵에서 모션이 발생한 것으로 판단하는 픽셀을 결정할 수 있다. 이 때, 임계치 처리를 위한 임계치의 결정은 사전에 실험적으로 결정할 수도 있고 사용자 인터페이스를 통해 실시 간으로 나타나는 영상 품질을 보면서 감도를 설정하도록 할 수도 있다. 예를 들어 엔트로피 맵의 생성 시 엔트 로피 산출을 위한 마스크 사이즈가 결정되면 엔트로피가 가질 수 있는 최대값이 결정되고, 엔트로피의 최대값의 하위 20% 값을 임계치로 설정할 수 있다. 이 실시예에서는 이와 같이 엔트로피 맵에 대해 임계치 처리를 수행하고, 도 14에 예시적으로 도시된 바와 같이 임계치 처리된 엔트로피 맵을 이용하여 누적 모션 맵을 갱신한다. 이상에서 본 발명의 실시예를 설명하였으나, 본 발명의 권리범위는 이에 한정되지 아니하며 본 발명의 실시예로"}
{"patent_id": "10-2022-0184659", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 3, "content": "부터 본 발명이 속하는 기술분야에서 통상의 지식을 가진 자에 의해 용이하게 변경되어 균등한 것으로 인정되는 범위의 모든 변경 및 수정 형태를 포함한다."}
{"patent_id": "10-2022-0184659", "section": "도면", "subsection": "도면설명", "item": 1, "content": "도 1은 본 발명의 실시예에 따른 영상 처리 장치가 적용된 C암 형태의 방사선 촬영 장치의 한 예를 개략적으로 도시하는 도면이다. 도 2는 본 발명의 실시예에 따른 영상 처리 장치의 블록도이다. 도 3은 본 발명의 실시예에 따른 영상 처리 방법의 순서도이다. 도 4는 정지 상태인 피사체의 동일한 입력 영상(이전 프레임과 현재 프레임)에 대해서 원신호의 차분 맵의 픽셀 값의 분포와 엔스콤 변환 후 얻어진 차분 맵의 픽셀값의 분포를 비교적으로 보여주는 그래프이다. 도 5는 본 발명의 실시예에 따른 영상 처리 방법의 알고리즘을 개략적으로 보여주는 도면이다. 도 6은 이전 프레임 영상과 현재 프레임 영상에서 핸드 팬텀을 우측에서 좌측으로 움직였을 때 출력되는 모션맵의 예를 보여준다. 도 7은 모션 맵을 이용하여 누적 모션 맵을 생성하는 방법을 보여주는 도면이다. 도 8은 프레임의 진행에 따라 입력 영상에 따른 모션 맵 및 누적 모션 맵의 생성을 보여주는 도면이다. 도 9는 정지 상태의 골반 팬텀 위를 막대 형태의 얇은 납이 지나가는 상황에서 얻어진 모션 맵과 출력 영상을 예시적으로 보여준다. 도 10은 도 9와 동일한 조건에서 모션 감지를 위한 임계값을 높인 경우와 낮춘 경우의 모션 맵을 예시적으로 보 여준다. 도 11은 누적 모션 맵에서 픽셀의 마스킹 연산으로 엔트로피를 계산하여 생성한 엔트로피 맵의 예시적으로 보여 준다. 도 12는 본 발명의 다른 실시예에 따른 모션 맵의 생성 방법을 보여주는 도면이다. 도 13은 본 발명의 다른 실시예에 따른 영상 처리 방법의 알고리즘을 개략적으로 보여주는 도면이다. 도 14는 도 13의 영상 처리 방법에서 임계치 처리된 엔트로피 맵을 이용하여 누적 모션 맵을 갱신하는 과정을 보여주는 도면이다."}
