{"patent_id": "10-2022-0134321", "section": "특허_기본정보", "subsection": "특허정보", "content": {"공개번호": "10-2024-0054054", "출원번호": "10-2022-0134321", "발명의 명칭": "MAC 어레이 프로세서 구조를 이용한 깊이방향 컨벌루션 가속장치", "출원인": "(주)네오와인", "발명자": "이효승"}}
{"patent_id": "10-2022-0134321", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_1", "content": "데이터 버퍼로부터 이미지의 각 로우(row)의 데이터를 입력받아 커널(kernel) 크기(N × N)에 따라 N-1번 시프트(shift) 시키면서 컨벌루션 연산블록들로 데이터를 입력시키는 데이터 출력부와,커널 버퍼로부터 커널 데이터를 입력받아 각 로우의 컨벌루션 연산블록들에 커널 데이터를 구성하는 가중치를순차적으로 입력시키되 로우가 증가하면서 계속해서 N 클럭씩 늦게 입력시키는 가중치 출력부를 포함하는 MAC어레이 프로세서 구조를 이용한 깊이방향 컨벌루션 가속장치."}
{"patent_id": "10-2022-0134321", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_2", "content": "제1항에 있어서,상기 데이터 출력부는 컬럼별 배치되어 이미지의 각 로우의 데이터를 동시에 입력받아 시프트시키는 복수의 시프트 레지스터를 포함하는 것을 특징으로 하는 MAC 어레이 프로세서 구조를 이용한 깊이방향 컨벌루션가속장치."}
{"patent_id": "10-2022-0134321", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_3", "content": "제1항에 있어서,상기 가중치 출력부는 로우별 배치되어 커널 데이터를 입력받아 선입선출(FIFO) 방식으로 출력시키는 복수의 가중치 출력블록을 포함하는 것을 특징으로 하는 MAC 어레이 프로세서 구조를 이용한 깊이방향 컨벌루션가속장치."}
{"patent_id": "10-2022-0134321", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_4", "content": "동일한 컬럼에 있는 컨벌루션 연산블록들에는 동일한 이미지 데이터가 동시에 입력되고, 동일한 로우에 있는 컨벌루션 연산블록들에는 동일한 커널 데이터가 입력되되 각 로우에 있는 컨벌루션 연산블록들에는 커널 데이터가이전 로우의 컨벌루션 연산블록들보다 커널(kernel) 크기(N × N)에 따른 N 클럭만큼 더 늦게 입력되는 것을 특징으로 하는 MAC 어레이 프로세서."}
{"patent_id": "10-2022-0134321", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_5", "content": "제4항에 있어서,상기 각 로우에 있는 컨벌루션 연산블록들로 커널 데이터의 입력이 시작되기 전이거나 입력이 완료된 후에는 0값이 입력되는 것을 특징으로 하는 MAC 어레이 프로세서."}
{"patent_id": "10-2022-0134321", "section": "발명의_설명", "subsection": "요약", "paragraph": 1, "content": "본 발명에 따른 MAC 어레이 프로세서 구조를 이용한 깊이방향 컨벌루션 가속장치는 데이터 버퍼로부터 이미지의 각 로우(row)의 데이터를 입력받아 커널(kernel) 크기(N × N)에 따라 N-1번 시프트(shift) 시키면서 컨벌루션 연산블록들로 데이터를 입력시키는 데이터 출력부와, 커널 버퍼로부터 커널 데이터를 입력받아 각 로우 컨벌루션 연산블록들에 커널 데이터를 구성하는 가중치를 순차적으로 입력시키되 로우가 증가하면서 N 클럭씩 늦게 입력시 키는 가중치 출력부를 포함하는 것을 특징으로 한다."}
{"patent_id": "10-2022-0134321", "section": "발명의_설명", "subsection": "기술분야", "paragraph": 1, "content": "본 발명은 MAC 어레이 프로세서 구조를 이용한 깊이방향 컨벌루션 가속장치에 관한 것이다."}
{"patent_id": "10-2022-0134321", "section": "발명의_설명", "subsection": "배경기술", "paragraph": 1, "content": "영상처리용 인공지능 연산자(operator)의 종류는 100여 가지에 이르지만 인공지능 연산의 90% 이상은 컨벌루션 (convolution)으로 이루어져 있다. 도 1에 도시된 바와 같이, 일반적으로 컨벌루션은 이미지(I)의 각 화소값에 대하여 커널(K)의 각 값을 곱한 값 들을 합하여 계산하는 방식이다. 도 1을 참조하면, 7×7 사이즈의 이미지가 3×3 사이즈의 커널(kernel)에 의해 컨벌루션되어 5×5 사이즈의 특 징 맵(feature map)으로 출력되는 과정이 도시되어 있다. 대부분의 컨벌루션에서 커널(필터)의 종류가 많기 때문에 동일한 이미지 데이터를 읽어서 여러 종류의 필터값에 대한 연산을 한 번에 처리하는 방식이 데이터 읽기 동작(read operation) 측면에서 매우 효율적이다. 이러한 컨벌루션이 하드웨어에서 처리될 때 MAC 어레이 프로세서 구조를 가진 가속기에서 처리된다. 인공지능 가속기 중에서 대부분의 CNN(Convolution Neural Network)용 NPU(Neural Processing Unit)는 MAC 어레이 프로 세서(MAC Array Processor) 구조를 사용한다. MAC 어레이 프로세서는 시스톨릭 어레이(systolic array) 구조로 설계되기도 하고, 입력 데이터가 모든 컬럼 (Column) 혹은 로우(Row)에 동시에 입력되는 벡터 프로세싱 방식으로 설계되기도 한다. 벡터 프로세싱 방식의 경우, 어레이 구조의 상단에 입력되는 데이터는 이미지의 화소 데이터로서 컬럼상에 있는 모든 프로세서에 동시에 입력된다. 마찬가지로 어레이 구조의 좌측에서 입력되는 가중치(NPU에서 필터값 대신 가중치라고 함)는 여러 종류의 커널 에 해당하는 값이 입력되고 같은 로우(row)에 있는 모든 프로세서에 동시에 동일한 가중치가 입력된다. 따라서 MAC 어레이 프로세서 구조에서 동일한 컬럼에 있는 프로세서들은 동일한 이미지 데이터를 처리하고, 동 일한 로우에 있는 프로세서들은 동일한 필터값에 대하여 연산처리를 하는 것이 일반적이다. 컨벌루션은 크게 컨벌루션 3d, 컨벌루션 1x1, 깊이방향 컨벌루션(Depthwise Convolution) 등으로 나누어진다. 컨벌루션 3d 및 컨벌루션 1x1는 하나의 이미지에 여러 종류의 커널이 사용되어 연산 처리가 유사하므로 MAC 어 레이 프로세서에서 효율적으로 처리되지만, 깊이방향 컨벌루션은 하나의 이미지에 대해 하나의 커널만 사용되므 로 MAC 어레이 프로세서 구조가 적합하지 않다. 즉, 깊이방향 컨벌루션은 하나의 이미지에 하나의 필터가 일대일 대응되는 연산이어서 로우 별로 다른 필터값을 입력시킬 수가 없기 때문에 MAC 어레이 프로세서 구조가 그리 적합하지 않다. 이에 따라 대부분의 NPU는 깊이방 향 컨벌루션을 별도의 가속기로 설계하여 사용한다. 일례로 종래의 NPU에서는 32x32 MAC 어레이 프로세서와 별도로 깊이방향 컨벌루션을 위하여 96개의 프로세서를 구현하고 있다. 이런 경우 별도의 연산로직을 추가함으로써 칩 제작 시 면적이 증가하게 되고 이에 따라 칩 가 격이 증가하고 소비전력도 증가하게 된다는 단점이 있다. 선행기술문헌 특허문헌 (특허문헌 0001) (선행기술 1) 한국공개특허공보 제10-2022-0009483호"}
{"patent_id": "10-2022-0134321", "section": "발명의_설명", "subsection": "해결하려는과제", "paragraph": 1, "content": "본 발명은 상기와 같은 문제점을 해결하기 위해 창안된 것으로서, 본 발명의 목적은 깊이방향 컨벌루션 로직을 추가하지 않고 종래의 MAC 어레이 프로세서 구조를 이용해 깊이방향 컨벌루션 가속장치를 구현하는 것이다."}
{"patent_id": "10-2022-0134321", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 1, "content": "이를 위해, 본 발명에 따른 MAC 어레이 프로세서 구조를 이용한 깊이방향 컨벌루션 가속장치는 데이터 버퍼로부 터 이미지의 각 로우(row)의 데이터를 입력받아 커널(kernel) 크기(N × N)에 따라 N-1번 시프트(shift) 시키면 서 컨벌루션 연산블록들로 데이터를 입력시키는 데이터 출력부와, 커널 버퍼로부터 커널 데이터를 입력받아 각 로우 컨벌루션 연산블록들에 커널 데이터를 구성하는 가중치를 순차적으로 입력시키되 로우가 증가하면서 계속 해서 N 클럭씩 늦게 입력시키는 가중치 출력부를 포함하는 것을 특징으로 한다. 본 발명에 따른 MAC 어레이 프로세서는, 동일한 컬럼에 있는 컨벌루션 연산블록들에 동일한 이미지 데이터가 동 시에 입력되고, 동일한 로우에 있는 컨벌루션 연산블록들에는 동일한 커널 데이터가 입력되되 각 로우에 있는 컨벌루션 연산블록들에는 커널 데이터가 이전 로우의 컨벌루션 연산블록들보다 커널(kernel) 크기(N × N)에 따른 N 클럭만큼 더 늦게 입력되는 것을 특징으로 한다."}
{"patent_id": "10-2022-0134321", "section": "발명의_설명", "subsection": "발명의효과", "paragraph": 1, "content": "상술한 바와 같이, 본 발명은 별도의 깊이방향 컨벌루션 로직을 추가하지 않고 기존의 MAC 어레이 프로세서 구 조를 이용하여 가속장치를 구현함으로써, 칩 면적을 줄이고 칩 가격을 낮출 수 있고 소비전력도 줄일 수 있는 효과가 있다. 또한 종래 별도의 프로세서로 구현한 깊이방향 컨벌루션 로직은 특정 크기의 커널에만 적용되었으나 본 발명은 커널 크기에 제한이 없이 깊이방향 컨벌루션을 구현할 수 있어서 성능 면에서 매우 우수함을 알 수 있다."}
{"patent_id": "10-2022-0134321", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 1, "content": "이하, 첨부된 도면을 참조하여 본 발명에 따른 실시예를 상세하게 설명한다. 본 발명의 구성 및 그에 따른 작용 효과는 이하의 상세한 설명을 통해 명확하게 이해될 것이다. 본 발명의 상세한 설명에 앞서, 동일한 구성요소에 대해서는 다른 도면상에 표시되더라도 가능한 동일한 부호로 표시하며, 공지된 구성에 대해서는 본 발명의 요지를 흐릴 수 있다고 판단되는 경우 구체적인 설명은 생략하기 로 함에 유의한다. 도 2는 본 발명에 따른 MAC 어레이 프로세서 구조를 이용한 깊이방향 컨벌루션 가속장치의 구성을 나타낸 것이다. 도 2를 참조하면, DMA(Direct Memory Access)는 메모리에 저장된 입력 이미지 및 커널 데이터를 호출 하여 각각 이미지 데이터 버퍼 및 커널 버퍼에 임시 저장시킨다. 컨벌루션의 입력 데이터로는 M개의 이미지 데이터와 N개의 커널 데이터가 있다. 커널 데이터가 하나의 이미지 전체에 대해 동일한 값을 유지하며, 예를 들어 3x3 커널로 컨벌루션을 수행한다면 커널 데이터는 9개의 가중치 를 가진다. 하나의 이미지에 대해 N개의 커널 데이터로 컨벌루션을 수행하는 방식이 일반적인 컨벌루션이라고 하면, 하나의 이미지와 이에 대응하는 하나의 커널에 대해서만 컨벌루션을 수행하는 것이 깊이방향 컨벌루션이다. 본 발명은 이러한 깊이방향 컨벌루션을 별도의 로직이 아닌 MAC 어레이 프로세서 구조를 사용하여 구현한다. 즉, MAC 어레이 프로세서의 컬럼(column)에 데이터 출력부를 배치하고, MAC 어레이 프로세서의 로 우(row)에 가중치 출력부를 배치하여 깊이방향 컨벌루션 가속장치를 구현할 수 있다. 데이터 출력부는 데이터 버퍼로부터 이미지의 각 로우(row)의 데이터를 입력받아 MAC 어레이 프로세서 의 컬럼 방향으로 픽셀값을 출력한다. 픽셀값을 출력할 때 데이터 출력부는 커널(kernel) 크기(N × N)에 따라 N-1번 이미지 데이터의 픽셀값을 시프트(shift) 시킨다. 가중치 출력부는 커널 버퍼로부터 커널 데이터를 입력받아 AC 어레이 프로세서의 로우 방향으로 가 중치를 출력한다. 가중치 출력부의 각 로우에서 가중치를 순차적으로 출력시킬 때 로우가 증가하면서 계속 해서 N 클럭씩 늦게 가중치를 출력시키게 된다. 도 3은 본 발명에 따른 MAC 어레이 프로세서 구조를 이용한 깊이방향 컨벌루션 가속장치에서 데이터 출력부 및 가중치 출력부의 구성을 나타낸 것이다. 도 3을 참조하면, 데이터 출력부는 컬럼별 배치되어 이미지의 각 로우의 데이터를 동시에 입력받아 시프트 시키는 복수의 시프트 레지스터(reg)로 구성되어 있고, 가중치 출력부는 로우별 배치되어 커널 데이터를 입 력받아 선입선출(FIFO) 방식으로 출력시키는 복수의 가중치 출력블록으로 구성되어 있다. MAC 어레이 프로세서는 복수의 컨벌루션 연산블록(PE)로 구성되어 동일한 컬럼에 있는 컨벌루션 연산블 록들에 동일한 이미지 데이터가 동시에 입력되고, 동일한 로우에 있는 컨벌루션 연산블록들에는 동일한 커널 데이터가 입력된다. 이때 각 로우에 있는 컨벌루션 연산블록들에는 커널 데이터가 이전 로우의 컨벌루션 연산블록들보다 커널 (kernel) 크기(N × N)에 따른 N 클럭만큼 더 늦게 입력된다. 본 발명에 따른 깊이방향 컨벌루션 가속장치의 동작을 구체적으로 살펴보면, 먼저 이미지의 각 로우의 데이터가 32개 단위(D0~D31)로 데이터 버퍼로부터 데이터 출력부의 시프트 레지스터(reg)에 로딩된다. 로딩된 데이터는 만약 커널 사이즈가 3x3인 경우에는 2번, 5x5인 경우에는 4, 7x7인 경우에는 6번 시프트되어 MAC 어레이 프로세서로 입력된다. 본 발명의 실시예서는 커널 사이즈가 3x3이므로 2번의 시프트가 수행될 수 있다. 이후에는 다음 로우의 데이터가 동일한 방법으로 입력되는데 3x3인 경우에는 3개의 로우 데이터, 5x5는 5개의 로우 데이터, 7x7은 7개 로우의 데이터가 입력될 수 있다. 본 발명의 실시예서는 커널 사이즈가 3x3이므로 3개 의 로우 데이터가 입력될 수 있다. 컨벌루션 연산블록(PE0)을 보면 데이터 출력부로부터 3개의 로우 데이터 입력과 각 로우 데이터마다 2번의 시프트를 통해 D1, .. D8 순서로 데이터가 입력되고, 가중치 출력부로부터 W0, W1, .. W8이 순차적으로 입 력되면서, PE0에서는 Dn x Wn 연산 및 누적이 수행되어 수학식 1과 같이 C0값을 저장하게 된다. 수학식 1"}
{"patent_id": "10-2022-0134321", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 2, "content": "동일한 방법으로 PE1부터 PE31에도 C1값 부터 C31값이 저장되어 첫 번째 로우에 대한 깊이방향 컨벌루션이 완성 된다. 다음 두 번째 로우의 PE0에서는 3 클럭 늦게 W0, W1,…W8이 순차적으로 입력되며 그 아래로 로우가 증가하면서 계속해서 3 클럭씩 늦게 가중치가 입력된다. 즉, 두 번째 로우의 PE0에서는 3 클럭 늦게, 세 번째 로우의 PE0에서는 6 클럭 늦게, 네 번째 로우의 PE0에서는 9 클럭 늦게 가중치가 입력된다. 만약 커널 사이즈가 5x5인 경우에는 5 클럭씩, 7x7이면 7 클럭씩 늦게 입력될 수 있다. 예를 들어, 커널 사이즈 가 5x5일 때 두 번째 로우의 PE0에서는 5 클럭 늦게, 세 번째 로우의 PE0에서는 10 클럭 늦게, 네 번째 로우의 PE0에서는 15 클럭 늦게 가중치가 입력된다. 그리고 각 PE에서 W0값이 입력되기 전이나 W8이 입력된 이후에는 0값이 입력되므로 PE 내부에 저장된 값에 영향 을 주지 않는다. 이렇게 이미지 데이터가 각 로우별로 순차적으로 입력되고, 가중치는 로우가 증가함에 따라 그만큼 지연되면서 입력이 모두 끝나면 각 PEn에는 누적 값(Cn) 저장되어 있고, 이후에는 Cn값을 시프트 출력하여 다시 데이터 버 퍼에 저장하면 32x32 깊이방향 컨벌루션이 완료된다. 도 4는 본 발명에 따른 가중치 출력부의 구체적인 내부 구성을 나타내고, 도 5는 본 발명에 따른 가중치 출력블 록의 내부 구성을 나타낸 것이다. 도 4를 참조하면, 커널 사이즈가 3x3일 때 커널 버퍼로부터 W0~W8 값이 로딩되어 시프트되면서 첫 번째 로 우의 가중치((Row0_w)로 출력된다. 첫 번째 로우에서 출력된 가중치는 지연부를 거쳐 3 클럭이 지연된 후에 두 번째 로우의 가중치(Row1_w)로 출력된다. 두 번째 로우에서 출력된 가중치는 다시 인접하는 지연부를 거쳐 3 클럭 지연되어 결과적으로 첫 번째 로우에 대해 6 클럭이 지연된다. 이러한 동작이 각 로우에서 반복되어 로우가 증가하면서 계속해서 3 클럭 씩 지연된 가중치가 출력된다. 도 5를 참고하면, 가중치 출력블록의 지연부는 멀티플렉서(MUX)와 시프트 레지스터(reg)로 구성된다. 이러한 구성을 통해 가중치는 3 클럭만큼 지연되어 출력된다. 만약 커널 사이즈가 5x5인 경우에는 도 5의 구성에서 시프트 레지스터가 2개 더 증가되며, 7x7인 경우에는 시프 트 레지스터가 4개 더 증가된다."}
{"patent_id": "10-2022-0134321", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 3, "content": "이상의 설명은 본 발명을 예시적으로 설명한 것에 불과하며, 본 발명이 속하는 기술분야에서 통상의 지식을 가 진 자에 의해 본 발명의 기술적 사상에서 벗어나지 않는 범위에서 다양한 변형이 가능할 것이다. 따라서 본 발명의 명세서에 개시된 실시예들은 본 발명을 한정하는 것이 아니다. 본 발명의 범위는 아래의 특허 청구범위에 의해 해석되어야 하며, 그와 균등한 범위 내에 있는 모든 기술도 본 발명의 범위에 포함되는 것으로 해석해야 할 것이다."}
{"patent_id": "10-2022-0134321", "section": "도면", "subsection": "도면설명", "item": 1, "content": "도 1은 일반적인 컨벌루션 연산을 설명하기 위한 도면. 도 2는 본 발명에 따른 MAC 어레이 프로세서 구조를 이용한 깊이방향 컨벌루션 가속장치의 구성을 나타낸 도면. 도 3은 본 발명에 따른 MAC 어레이 프로세서 구조를 이용한 깊이방향 컨벌루션 가속장치에서 데이터 출력부 및 가중치 출력부의 구성을 나타낸 도면. 도 4는 본 발명에 따른 가중치 출력부의 구체적인 내부 구성을 나타낸 도면. 도 5는 본 발명에 따른 가중치 출력블록의 내부 구성을 나타낸 도면."}
