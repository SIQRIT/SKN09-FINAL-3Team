{"patent_id": "10-2020-0156443", "section": "특허_기본정보", "subsection": "특허정보", "content": {"공개번호": "10-2022-0069385", "출원번호": "10-2020-0156443", "발명의 명칭": "고속 후처리가 가능한 딥러닝 장치", "출원인": "한국전자기술연구원", "발명자": "이상설"}}
{"patent_id": "10-2020-0156443", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_1", "content": "영상에서 객체들을 BB(Bounding Box)들로 검출하는 단계;검출된 BB들을 Soft-NMS(Non maximum suppression) 연산하여, 최종 BB들을 결정하는 단계;결정된 최종 BB들을 최종 객체 검출 결과로 출력하는 단계;를 포함하고,결정 단계는,대상 BB들의 스코어들을 계산하여 최종 BB들을 결정하되, 스코어 계산시 특정 조건을 만족하는 대상 BB에 대해서는 스코어 계산을 중단하는 것을 특징으로 하는 객체 검출 방법."}
{"patent_id": "10-2020-0156443", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_2", "content": "청구항 1에 있어서,스코어는,대상 BB와 동일 클래스로 분류된 다른 BB들 간의 IOU들로부터 계산하는 것을 특징으로 하는 객체 검출 방법."}
{"patent_id": "10-2020-0156443", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_3", "content": "청구항 2에 있어서,스코어는,다른 BB들과 IOU들이 작을수록 높은 값을 갖으며, 다른 BB들과 IOU들이 높을수록 작은 값을 갖는 것을 특징으로하는 객체 검출 방법."}
{"patent_id": "10-2020-0156443", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_4", "content": "청구항 3에 있어서,스코어는,다른 BB들과의 IOU들을 하나씩 반영하면서 업데이트 되되, 업데이트 중에 임계값 미만이 되면 업데이트가 중단되는 것을 특징으로 하는 객체 검출 방법."}
{"patent_id": "10-2020-0156443", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_5", "content": "청구항 4에 있어서,스코어에는,해당 BB가 해당 클래스일 확률이 반영되는 것을 특징으로 하는 객체 검출 방법."}
{"patent_id": "10-2020-0156443", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_6", "content": "청구항 5에 있어서,공개특허 10-2022-0069385-3-임계값은,대상 BB가 최종 BB로 선정되기 위한 임계 스코어인 것을 특징으로 하는 객체 검출 방법."}
{"patent_id": "10-2020-0156443", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_7", "content": "청구항 1에 있어서,결정 단계는,해상도가 각기 다른 레이어들에서 결정된 BB들을 Soft-NMS하여 최종 BB들을 결정하는 것을 특징으로 하는 객체검출 방법."}
{"patent_id": "10-2020-0156443", "section": "청구범위", "subsection": "청구항", "claim_number": "청구항_8", "content": "영상에서 객체들을 BB(Bounding Box)들로 검출하는 가속기;검출된 BB들을 Soft-NMS(Non maximum suppression) 연산하여, 최종 BB들을 결정하고, 결정된 최종 BB들을 최종객체 검출 결과로 출력하는 연산부;를 포함하고,연산부는,대상 BB들의 스코어들을 계산하여 최종 BB들을 결정하되, 스코어 계산시 특정 조건을 만족하는 대상 BB에 대해서는 스코어 계산을 중단하는 것을 특징으로 하는 객체 검출 장치."}
{"patent_id": "10-2020-0156443", "section": "발명의_설명", "subsection": "요약", "paragraph": 1, "content": "고속 후처리가 가능한 객체 검출 장치 및 방법이 제공된다. 본 발명의 실시예에 따른 객체 검출 방법은 영상에서 객체들을 BB들로 검출하고, 검출된 BB들을 Soft-NMS 연산하여 최종 BB들을 결정하며, 결정된 최종 BB들을 최종 객체 검출 결과로 출력하고, 대상 BB들의 스코어들을 계산하여 최종 BB들을 결정하되, 스코어 계산시 특정 조건 을 만족하는 대상 BB에 대해서는 스코어 계산을 중단한다. 이에 의해, 검출 객체들에 대한 Soft-NMS 연산을 통한 후처리 과정에서 최종 BB로 결정될 가능성이 없는 BB들에 대한 갱신 연산을 조기 종료 시킴으로써, 객체 검출의 고속화가 가능해진다."}
{"patent_id": "10-2020-0156443", "section": "발명의_설명", "subsection": "기술분야", "paragraph": 1, "content": "본 발명은 인공지능 기술 및 이를 적용한 SoC(System on Chip)에 관한 것으로, 더욱 상세하게는 딥러닝 가속 하 드웨어 장치의 최종단에서 후처리(Post-Processing)를 고속으로 수행할 수 있는 방법에 관한 것이다."}
{"patent_id": "10-2020-0156443", "section": "발명의_설명", "subsection": "배경기술", "paragraph": 1, "content": "종래의 기술은 영상 데이터로부터 추출한 객체의 정보를 이용하여 객체 검출, 차선검출, 도로 검출 등 수 많은 연구가 진행 중에 있다. 특히, 자율 주행 차량 및 CCTV 등에 적용하기 위하여 외부에 RGB 카메라, 스테레오 카 메라, ToF 센서, Lidar 등을 연동하여 영상 기반의 딥러닝 처리를 수행하고 있다. 영상을 입력받아 딥러닝 연산은 수행하는 고성능의 하드웨어 플랫폼 및 후처리를 위한 서버급의 시스템을 요구 한다. 후처리를 위하여 수많은 산술 및 비교 연산을 수행하는데, 최근 가속 하드웨어 개발 분야에서는 후처리 과정에 대한 연구가 미미한 상태이다. 후처리는 연산 성능이 충분한 환경에서 소프트웨어 상에서 구현됨에 따라 저사양의 하드웨어로 구현시 연산의 연산값의 손실, 정확도 저하, 많은 하드웨어 리소스 및 시간을 요구하게 되어 이를 최소화 개발할 수 있는 방법 이 필요하다."}
{"patent_id": "10-2020-0156443", "section": "발명의_설명", "subsection": "해결하려는과제", "paragraph": 1, "content": "본 발명은 상기와 같은 문제점을 해결하기 위하여 안출된 것으로서, 본 발명의 목적은, 검출 객체들에 대한 Soft-NMS 연산을 통한 후처리 과정을 고속화한 객체 검출 방법 및 장치를 제공함에 있다."}
{"patent_id": "10-2020-0156443", "section": "발명의_설명", "subsection": "과제의해결수단", "paragraph": 1, "content": "상기 목적을 달성하기 위한 본 발명의 일 실시예에 따른, 객체 검출 방법은, 영상에서 객체들을 BB(Bounding Box)들로 검출하는 단계; 검출된 BB들을 Soft-NMS(Non maximum suppression) 연산하여, 최종 BB들을 결정하는 단계; 결정된 최종 BB들을 최종 객체 검출 결과로 출력하는 단계;를 포함하고, 결정 단계는, 대상 BB들의 스코 어들을 계산하여 최종 BB들을 결정하되, 스코어 계산시 특정 조건을 만족하는 대상 BB에 대해서는 스코어 계산 을 중단한다. 스코어는, 대상 BB와 동일 클래스로 분류된 다른 BB들 간의 IOU들로부터 계산할 수 있다. 스코어는, 다른 BB들과 IOU들이 작을수록 높은 값을 갖으며, 다른 BB들과 IOU들이 높을수록 작은 값을 갖을 수 있다. 스코어는, 다른 BB들과의 IOU들을 하나씩 반영하면서 업데이트 되되, 업데이트 중에 임계값 미만이 되면 업데이 트가 중단될 수 있다. 스코어에는, 해당 BB가 해당 클래스일 확률이 반영될 수 있다. 임계값은, 대상 BB가 최종 BB로 선정되기 위한 임계 스코어일 수 있다. 결정 단계는, 해상도가 각기 다른 레이어들에서 결정된 BB들을 Soft-NMS하여 최종 BB들을 결정할 수 있다. 한편, 본 발명의 다른 실시예에 따른, 객체 검출 장치는, 영상에서 객체들을 BB(Bounding Box)들로 검출하는 가 속기; 검출된 BB들을 Soft-NMS(Non maximum suppression) 연산하여, 최종 BB들을 결정하고, 결정된 최종 BB들 을 최종 객체 검출 결과로 출력하는 연산부;를 포함하고, 연산부는, 대상 BB들의 스코어들을 계산하여 최종 BB 들을 결정하되, 스코어 계산시 특정 조건을 만족하는 대상 BB에 대해서는 스코어 계산을 중단한다."}
{"patent_id": "10-2020-0156443", "section": "발명의_설명", "subsection": "발명의효과", "paragraph": 1, "content": "이상 설명한 바와 같이, 본 발명의 실시예들에 따르면, 검출 객체들에 대한 Soft-NMS 연산을 통한 후처리 과정 에서 최종 BB로 결정될 가능성이 없는 BB들에 대한 갱신 연산을 조기 종료 시킴으로써, 객체 검출의 고속화가 가능해진다. 또한, 본 발명의 실시예들에 따르면, 연산 결과의 정확도를 위해 필요하던 고정밀도 연산기 및 많은 누적공간을 낮은 정밀도로 처리가 가능하여 낮은 복잡도의 하드웨어 설계가 가능해지고, 조기 종료 조건을 설정하여 유효한 스코어 만을 이용하기 때문에 반복연산으로 인한 시간을 줄일 수 있게 된다."}
{"patent_id": "10-2020-0156443", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 1, "content": "이하에서는 도면을 참조하여 본 발명을 보다 상세하게 설명한다. 도 1은 NMS(Non maximum suppression)의 개념 설명에 제공되는 도면이다. 도시된 바와 같이, 하나의 객체를 나 타내는 BB(Bounding Box)들 중 최적의 하나만을 남기고 나머지는 제거하여 주는 알고리즘이다. 하지만, 도 2의 좌측에 도시된 바와 같이, NMS는 별개의 객체들을 하나의 객체로 오검출함으로써 mAP가 낮아지 는 문제를 보인다. 이를 해결하기 위한 방안으로 도 2의 우측에 도시된 바와 같이 객체들을 정확하게 검출할 수 있는 Soft-NMS가 등장하였다. 하지만, Soft-NMS는 많은 연산을 요구한다는 점에서 문제가 된다. 본 발명의 실시예에서는 검출 객체들에 대한 Soft-NMS 연산을 통한 후처리(Post-Processing) 과정을 고속화하는 방법을 제시한다. 기존의 추론기에 집중된 딥러닝 장치 외에 경량의 후처리기를 적용한 딥러닝 하드웨어 장치로써, 엣지 및 모바 일 향 반도체에 적용 가능한 딥러닝 구조이며, 차량 뿐만 아니라 다양한 환경에 적용 가능한 확장 가능한 구조 이다. 도 3은 본 발명의 일 실시예에 따른 객체 검출 장치의 블럭도이다. 본 발명의 실시예에 따른 객체 검출 장치는, 도 3에 도시된 바와 같이, CNN 가속기, 정보 추출부, 정렬부, 대상 BB 획득부, 후보 BB 획득부 및 Soft-NMS 연산부를 포함하여 구성된다. CNN 가속기는 입력 영상에서 객체를 검출하고, 객체 검출 정보를 출력한다. 객체 검출 정보는 검출된 객체 들이 BB(Bounding Box)들로 나타나 있는 OFM(Output Feature Map)이다. 정보 추출부은 CNN 가속기에서 출력되는 OFM에서 BB들의 클래스 정보(분류 정보)와 확률 정보를 추출 /획득한다. 정렬부은 BB들을 정보 추출부에서 획득된 클래스 정보와 확률 정보를 기초로 BB들을 정렬 한다. 대상 BB 획득부는 CNN 가속기에서 출력되는 OFM에서 BB들을 하나씩 순차적으로 획득한다. 이를 위해, 대상 BB 획득부은 CNN 가속기에서 출력되는 OFM에서 BB들의 위치 정보를 추출/획득한다. 위치 정보에 는 BB의 중심 좌표, 너비 및 높이가 포함된다. 후보 BB 획득부는 대상 BB 획득부에서 획득된 BB들과 Soft-NMS 연산을 수행할 후보 BB들을 획득하는 데, OFM에 포함된 모든 BB들이 후보들이 된다. 따라서, 후보 BB 획득부에서는 OFM에 포함된 모든 BB들이 하나씩 순차적으로 획득된다. Soft-NMS 연산부는 대상 BB 획득부에서 획득되는 대상 BB와 후보 BB 획득부에서 획득되는 후보 BB에 대해 Soft-NMS 연산을 수행하여, 최종 BB들을 결정한다. Soft-NMS 연산부의 연산 과정에 대해 도 4와 도 5를 참조하여 상세히 설명한다. 도 4는 본 발명의 다른 실 시예에 따른 Soft-NMS 연산 방법의 설명에 제공되는 흐름도이고, 도 5는 Soft-NMS 연산 프로그램 코드이다. 본 발명의 실시예에 따른 Soft-NMS 연산에서는 CNN 가속기에 의해 검출된 BB들을 Soft-NMS 연산부가 NMS 연산하여 최종 BB들을 결정함에 있어 BB들의 스코어 계산이 보다 고속으로 이루어지도록 한다. 이를 위해, 도시된 바와 같이, 먼저 Soft-NMS 연산부는 대상 BB 획득부에서 획득한 대상 BB의 스코어 를 초기값으로 설정한다(S210). 스코어(ScoreBBox)의 초기값은 1.0이다. 다음, Soft-NMS 연산부는 대상 BB 획득부에서 획득한 대상 BB와 후보 BB 획득부에서 획득한 후 보 BB 간의 IOU를 계산한다(S220). 만약, 대상 BB와 후보 BB가 동일 클래스가 아닌 경우, IOU를 0으로 변경한다 (S230). 동일 클래스에 대해서만 스코어에 반영되도록 하기 위함이다. 그리고, Soft-NMS 연산부는 Soft-NMS 커널값을 다음의 수식을 통해 계산한다(S240). Soft_NMS_Kernel = Min(2.0×(1.0 - IOU), 1.0) 위 식을 통해 알 수 있는 바와 같이, Soft-NMS 커널값은 동일 클래스로 분류된 후보 BB와 IOU가 작을수록 높은 값을 갖게 되고, BB와 IOU가 클수록 작은 값을 갖게 되며, 최대값은 1.0이다. 다음, Soft-NMS 연산부는 대상 BB의 스코어에 Soft-NMS 커널값을 곱하여 갱신한다(S250). 이 과정은 다음 의 수식으로 나타낼 수 있다. ScoreBBox=ScoreBBox×Soft_NMS_Kernel 한편, S240단계에서 갱신된 대상 BB의 스코어가 임계 값(SOFT_NMS_EARLY_TH) 미만이면(S260-Y), Soft-NMS 연산 부는 대상 BB의 스코어 계산을 종료(Soft-NMS with early termination) 한다. 즉, 남아 있는 다른 후보 BB들을 이용한 스코어 갱신을 수행하지 않는다.Soft-NMS 커널값은 1이하의 값이므로, 대상 BB의 스코어는 갱신되면서 작아질 수 밖에 없는데, 임계값 미만으로 많이 작아지게 되면, 이를 테면, 최종 BB를 선정하는데 이용되는 최종 스코어의 임계치 보다 작아지게 되면, 최 종 BB로 결정될 수 없기 때문에, 이후의 갱신을 위한 연산을 종료하는 것이다. S210단계 내지 S260단계는, 모든 후보 BB들에 대해 완료될 때까지 계속된다(S270). 모든 후보 BB들에 대해 완료되면(S270-Y), Soft-NMS 연산부는 대상 BB의 최종 스코어를 산출한다(S280). 최종 스코어(Final_ConfidenceBbox)는 다음의 수식을 통해 산출할 수 있다. Final_ConfidenceBbox = ConfidenceBbox×ScoreBbox 위 수식을 통해 알 수 있는 바와 같이, 최종 스코어는 대상 BB의 스코어에 대상 BB의 확률이 곱해져 산출된다. 대상 BB의 확률은 대상 BB가 해당 클래스일 확률을 나타내는 정보로, 전술한 정보 추출부에 의해 추출/획 득된 것이다. S210단계 내지 S280단계는, 모든 대상 BB들에 대해 완료될 때까지 계속된다(S980). 모든 후보 BB들에 대해 완료되면(S290-Y), Soft-NMS 연산부는 대상 BB들 중 최종 스코어가 임계값 이상인 BB들을 최종 BB들로 결정하게 된다(S290). 지금까지, 개선된 Soft-NMS 연산 방법에 대해 바람직한 실시예를 들어 상세히 설명하였다. 본 발명의 실시예에서는, 빠른 동작과 낮은 하드웨어 복잡도 처리를 위해, 대상 BB의 스코어 갱신 중 스코어가 최종 스코어의 임계치 보다 낮아 대상 BB가 최종 BB로 결정될 수 없음이 확정되면, 바로 스코어 업데이트를 종 료하도록 하였다. 이에 의해, 성능 열화 없이도, 연산량을 줄이고 곱셈 누적 공간 리소스 문제를 해결할 수 있게 된다. 도 6에는 본 발명의 다른 실시예에 따른 Soft-NMS 연산 방법의 개념 설명에 제공되는 도면이다. 이 실시예에서는, 영상을 해상도가 다른 다수의 레이어들로 구성하고(도 6에서는 5개의 레이어(P3~P7)를 구성하 고, 각 레이어에서 최종 BB들을 결정한 후에, 결정된 BB들을 모두 모아 Soft-NMS 연산을 재수행하는 것이다. 예를 들면, P3~P7 레이어 별로 Soft-NMS를 수행하여 획득한 P3~P7 최종 BB들을 소팅한 결과, P3(500 → 300), P4(400 → 300), P5(448 → 300), P6(112 → 112), P7(28 → 28)가 되어, 총, 300 + 300 + 300 + 112 + 28 = 1040 개의 최종 BB들이 결정된 것을 상정한다. 이 경우, 1040개의 최종 BB들에 대해 다시 Soft-NMS를 수행하여 최종 BB들을 재선정하게 된다. 딥러닝 개발 및 테스트 환경에서 구현한 결과가 실제 경량 하드웨어로 구현시 결과 값의 손실로 영상에 따라 성 능이 저하되는 경우가 발생하는 바, 성능 저하를 막기위하여 연산 및 누적 연산 값을 보상해주는 로직으로 인한 하드웨어 리소스를 많이 요구한다. 이에, 본 발명의 실시예에서는 낮은 정밀도를 유지하여 하드웨어 복잡도를 감소시키고, 스코어를 순서대로 갱신 함에 있어 불필요한 반복 연산을 제거하여 빠른 동작이 가능한 모델을 제시하였다. 이에 의해, 연산결과의 정확도를 위해 필요하던 고정밀도 연산기 및 많은 누적공간을 낮은 정밀도로 처리가 가 능하여 낮은 복잡도의 하드웨어 설계가 가능하고, 조기 종료 조건을 설정하여 유효한 스코어만을 이용하기 때문 에 반복연산으로 인한 시간을 줄일 수 있어 고속 처리가 가능하게 된다. 한편, 본 실시예에 따른 장치와 방법의 기능을 수행하게 하는 컴퓨터 프로그램을 수록한 컴퓨터로 읽을 수 있는 기록매체에도 본 발명의 기술적 사상이 적용될 수 있음은 물론이다. 또한, 본 발명의 다양한 실시예에 따른 기 술적 사상은 컴퓨터로 읽을 수 있는 기록매체에 기록된 컴퓨터로 읽을 수 있는 코드 형태로 구현될 수도 있다. 컴퓨터로 읽을 수 있는 기록매체는 컴퓨터에 의해 읽을 수 있고 데이터를 저장할 수 있는 어떤 데이터 저장 장 치이더라도 가능하다. 예를 들어, 컴퓨터로 읽을 수 있는 기록매체는 ROM, RAM, CD-ROM, 자기 테이프, 플로피 디스크, 광디스크, 하드 디스크 드라이브, 등이 될 수 있음은 물론이다. 또한, 컴퓨터로 읽을 수 있는 기록매체 에 저장된 컴퓨터로 읽을 수 있는 코드 또는 프로그램은 컴퓨터간에 연결된 네트워크를 통해 전송될 수도 있다. 또한, 이상에서는 본 발명의 바람직한 실시예에 대하여 도시하고 설명하였지만, 본 발명은 상술한 특정의 실시"}
{"patent_id": "10-2020-0156443", "section": "발명의_설명", "subsection": "발명을실시하기위한구체적인내용", "paragraph": 2, "content": "예에 한정되지 아니하며, 청구범위에서 청구하는 본 발명의 요지를 벗어남이 없이 당해 발명이 속하는 기술분야 에서 통상의 지식을 가진자에 의해 다양한 변형실시가 가능한 것은 물론이고, 이러한 변형실시들은 본 발명의기술적 사상이나 전망으로부터 개별적으로 이해되어져서는 안될 것이다."}
{"patent_id": "10-2020-0156443", "section": "도면", "subsection": "도면설명", "item": 1, "content": "도 1은 NMS의 개념 설명에 제공되는 도면, 도 2는 NMS의 문제점과 Soft-NMS를 소개하기 위한 도면, 도 3은 본 발명의 일 실시예에 따른 객체 검출 장치의 블럭도, 도 4는 본 발명의 다른 실시예에 따른 Soft-NMS 연산 방법의 설명에 제공되는 흐름도, 도 5는 Soft-NMS 연산 프로그램 코드, 도 6은 본 발명의 다른 실시예에 따른 Soft-NMS 연산 방법의 개념 설명에 제공되는 도면이다."}
